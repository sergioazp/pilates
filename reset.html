<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Restablecer Contrase√±a - Marina Pilates</title>

    <script src="https://www.gstatic.com/firebasejs/10.10.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.10.0/firebase-auth-compat.js"></script>

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            min-height: 100dvh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .card {
            background: white;
            border-radius: 20px;
            padding: 40px;
            width: 100%;
            max-width: 420px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .logo {
            text-align: center;
            margin-bottom: 28px;
        }

        .logo-circle {
            width: 64px;
            height: 64px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 12px;
            font-size: 2rem;
        }

        .logo h1 {
            color: #667eea;
            font-size: 1.5rem;
            margin-bottom: 4px;
        }

        .logo p {
            color: #6c757d;
            font-size: 0.9rem;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #495057;
            font-size: 0.95rem;
        }

        .form-group input {
            width: 100%;
            padding: 14px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            font-size: 1rem;
            transition: border-color 0.2s;
            outline: none;
        }

        .form-group input:focus {
            border-color: #667eea;
        }

        .btn {
            width: 100%;
            padding: 14px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102,126,234,0.4);
        }

        .btn-primary:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .alert {
            padding: 14px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-size: 0.95rem;
            line-height: 1.4;
        }

        .alert-danger  { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .alert-success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .alert-info    { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }

        .back-link {
            display: block;
            text-align: center;
            margin-top: 20px;
            color: #667eea;
            text-decoration: none;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .back-link:hover { text-decoration: underline; }

        .password-wrap { position: relative; }

        .toggle-pw {
            position: absolute;
            right: 14px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            cursor: pointer;
            color: #6c757d;
            font-size: 1.1rem;
            padding: 4px;
        }

        .password-wrap input { padding-right: 44px; }

        @media (max-width: 480px) {
            body { padding: 0; align-items: flex-end; }
            .card { border-radius: 20px 20px 0 0; padding: 32px 24px 40px; }
        }
    </style>
</head>
<body>

<div class="card">
    <div class="logo">
        <svg viewBox="0 0 376 407.8" width="200" style="display:block;margin:0 auto 8px" xmlns="http://www.w3.org/2000/svg">
            <style>.L0{fill:#6C6B6B}.L4{fill:#9E55D8}.L5{fill:#823CC6}</style>
            <g><g><g>
            <path class="L0" d="M52.3,310.9h-7.7V276h-0.1l-2.8,6.8l-15.5,28.8H26l-15.5-29l-2.7-6.6H7.7v34.9H0v-51.6h6.6l17,32.1l2.5,6.1h0.1l2.5-6.1l17.1-32.1h6.4V310.9z"/>
            <path class="L0" d="M113.2,310.9h-8.3l-5.4-12l0.4-0.7H72.3l0.4,0.7l-5.4,12H59l23.4-51.6h7.5L113.2,310.9z M96.3,291.2l-0.8-0.8l-7.9-17.5l-1.5-4.7h-0.1l-1.5,4.6l-8,17.6l-0.8,0.8L96.3,291.2z"/>
            <path class="L0" d="M166,310.9h-8.5l-6.7-13.6c-2.4-4.8-5.9-7-12.4-7h-11.6l0.8,0.7v20h-7.7v-51.6h23.4c9.8,0,18.2,5.1,18.2,15.5c0,6.3-4.5,11.2-9.7,13v0.1c2.1,0.9,4.5,3.1,6,6.2L166,310.9z M143.3,266.4h-16.5l0.8,0.8v15.2l-0.8,0.8h15.9c7.1,0,11-3.6,11-8.4C153.6,268.7,149.4,266.4,143.3,266.4z"/>
            <path class="L0" d="M180.1,310.9h-7.7v-51.6h7.7V310.9z"/>
            <path class="L0" d="M235.8,310.9h-6.8l-25.9-33.4l-3.6-5.9h-0.1v39.3h-7.7v-51.6h6.8l26,33.5l3.4,5.8h0.1v-39.3h7.7L235.8,310.9z"/>
            <path class="L0" d="M296.8,310.9h-8.3l-5.4-12l0.4-0.7h-27.5l0.4,0.7l-5.4,12h-8.3l23.4-51.6h7.5L296.8,310.9z M279.9,291.2l-0.8-0.8l-7.9-17.5l-1.5-4.7h-0.1l-1.5,4.6l-8,17.6l-0.8,0.8L279.9,291.2z"/>
            </g></g></g>
            <g><g>
            <path class="L4" d="M80.5,407.8c-0.9,0-1.3-0.4-1.3-1.1c0-0.3,0.1-0.7,0.3-1.2c0.9-1.9,2.1-4.7,3.7-8.4s3.3-8,5.3-12.8c1.9-4.8,3.8-9.8,5.8-14.8c1.7-4.5,3.4-8.9,5-13.1s3-8.1,4.1-11.6s1.6-6.1,1.6-8c0-0.6,0.4-0.9,1.2-1c0.8-0.1,1.5-0.2,2.3-0.2c2.4,0,3.6,0.8,3.6,2.4c0,1.3-0.7,3-2.2,5.1c-1.3,2.1-2.4,4.2-3.4,6.5s-1.9,4.5-2.8,6.8c1.7-2.3,3.4-4.6,4.9-6.8c1.5-2.2,3.3-4.2,5.3-5.8c1.6-1.2,3.2-2.2,4.7-3s3.2-1.1,5-1.1c1.9,0,3.8,0.5,5.6,1.4s3,2.3,3.3,4.3c0.1,0.2,0.1,0.5,0.1,0.7c0,2.5-0.7,5-2.2,7.4c-1.5,2.4-3.2,4.6-5.3,6.5c-2,1.9-3.9,3.4-5.6,4.6c-1.5,0.9-3.2,1.8-5.3,2.8s-4.2,1.9-6.5,2.6s-4.5,1.1-6.6,1.1c-1.3,0-2.4-0.2-3.3-0.4c-0.9,2.2-2,5-3.3,8.4s-2.4,6.8-3.5,10.2c-0.5,1.5-0.7,2.6-0.5,3.5c0.2,0.9,0,2-0.5,3.4c-0.4,1.5-0.9,2.8-1.4,4.2c-0.5,1.3-1.1,2.6-1.7,3.8c-0.1,0.3-0.6,0.7-1.4,1.2s-1.6,0.9-2.6,1.3C82.1,407.6,81.2,407.8,80.5,407.8z M98.8,369.5c2.3,0,4.7-0.5,7.3-1.6c2.5-1.1,5-2.5,7.5-4.3c2.5-1.8,4.7-3.8,6.7-5.9c2-2.1,3.6-4.2,4.8-6.2c1.5-2.3,2.2-4.5,2.2-6.4c0-2.2-1-3.4-2.9-3.4c-0.5,0-1.1,0.1-1.8,0.3c-0.7,0.2-1.6,0.5-2.5,1c-3.8,2-7,4.4-9.4,7.1c-2.5,2.7-4.6,5.7-6.3,9C102.5,362.2,100.7,365.7,98.8,369.5z"/>
            <path class="L4" d="M308.1,372.3c-3.3,0-6.1-0.8-8.5-2.3c-2.4-1.5-3.6-3.8-3.6-7c0-1.7,0.5-3.7,1.5-6.1c0.7-1.7,2.1-3.6,4-5.8c2-2.2,4.2-4.3,6.8-6.3c2.6-2.1,5.2-3.8,7.9-5.1c2.7-1.3,5.1-2,7.3-2c0.8,0,1.5,0.1,2.2,0.3c1.2,0.4,2.1,1.1,2.5,2.1s0.7,1.9,0.7,2.9c0,0.9-0.2,1.8-0.4,2.7c-0.3,0.9-0.7,1.6-1.1,2.3c-1.3,2-3.2,3.7-5.6,5.2c-2.4,1.5-4.9,2.7-7.4,3.6s-4.5,1.4-6.1,1.5h-0.2c-0.9,0-1.4-0.3-1.4-0.9c0-0.4,0.3-0.5,0.9-0.5c1.7-0.1,3.9-1,6.6-2.4c2.6-1.5,5-3,7-4.6c0.9-0.7,1.9-1.7,3.1-3s1.8-2.6,1.8-3.8c0-1.3-0.6-2-1.8-2c-0.7,0-1.3,0.2-2,0.4c-0.7,0.3-1.2,0.5-1.7,0.7c-2.1,1-4.4,2.6-7,4.7c-2.5,2.1-4.8,4.5-6.9,7.2c-2.1,2.6-3.5,5.3-4.3,8c-0.2,0.6-0.4,1.1-0.4,1.7s-0.1,1.1-0.1,1.6c0,1.7,0.6,3,1.7,3.7c1.1,0.7,2.5,1.1,4.1,1.1c2.4,0,4.8-0.5,7.4-1.6s5-2.4,7.4-4.1c2.4-1.7,4.6-3.5,6.6-5.4s3.7-3.8,5-5.6c0.2-0.3,0.5-0.5,0.8-0.5c0.3,0.1,0.4,0.3,0.4,0.6c0,0.3-0.1,0.6-0.2,0.9c-2,2.8-4.5,5.6-7.3,8.2c-2.9,2.7-6,4.9-9.4,6.7C315.4,371.4,311.8,372.3,308.1,372.3z"/>
            </g></g>
            <g>
            <path class="L5" d="M154.3,0.1c0.4,1.3,0.9,2.6,1.1,3.9c1.1,9.4,1.1,18.6-0.3,28.1c-1,6.5-0.7,13.1-0.5,19.7c0.6,17,1.4,34,2.2,51c0.4,8.5,1.8,16.9,1.6,25.4c-0.2,9.9,0.6,19.6,2.2,29.3c0.3,1.9,1.2,3.2,2.8,4.3c9.4,6.5,18.8,13.1,28.3,19.5c3.3,2.2,6.9,4.1,10.5,5.8c5.4,2.5,7.9,6.9,8.8,12.4c0.9,5,1.8,10,2.8,15.1c0.1,0.4,0.3,0.7,0.9,1.1c0-1.4,0.1-2.9,0-4.3c-0.1-2-0.4-3.9-0.5-5.9c-0.1-1.7,0.7-2.5,2.5-2c1.4,0.4,2.4,0.2,3.7-1c1-0.9,3.1-1.2,4.6-1c1.3,0.2,1.7,0.1,2.1-1c1-2.6,1.7-2.7,3.9-0.9c2.3,1.9,4.7,3.1,7.8,3.6c4.8,0.7,9.5,2.1,12.1,6.9c1.9,3.5,2,7.2,1.3,11c-0.5,2.6,2.4,5,4.9,4.2c1.1-0.4,2.3-0.6,3.5-0.7c0.5,0,1.2,0.6,1.4,1.1c0.7,2.1,0.4,4-1.5,5.6c0.9,0.6,1.7,1.1,2.5,1.7c1.3,1.1,2.2,2.8,1.4,4.3c-0.5,0.9-2.1,1.7-3.2,1.8c-3.6,0.2-7.3,0.1-10.9,0.1c-5.9-0.1-11.9-0.4-17.8-0.6c-2.7-0.1-5.4,0-8-0.5c-2-0.4-4-1.2-5.7-2.3c-2-1.2-3.3-1.3-4.7,0.5c-1.3,1.6-3,1.5-4.8,1.7c-21.2,2.5-42.5,0.7-63.7,2c-1.5,0.1-3,0.2-4.4,0.5c-4.6,1-9,0.8-13.6-0.5c-5-1.4-10-0.5-14.8,1.3c-3.3,1.3-6.7,2.4-10.1,3.5c-7,2.1-14,1.7-20.8-0.7c-0.6-0.2-1.1-0.5-1.6-0.8c0-0.2-0.1-0.5-0.1-0.7c1.4-0.6,2.8-1.5,4.2-1.7c9.5-1.5,18.3-5,27-8.8c4.6-2.1,9.5-2.2,14.4-2.3c4,0,7.9-0.4,11.8-0.7c0-0.2,0.1-0.5,0.1-0.7c-0.4-0.2-0.7-0.5-1.1-0.6c-0.6-0.2-1.2-0.4-1.8-0.6c-5.6-2.6-11.1-2.8-16.7,0.3c-3,1.6-6.2,2.2-9.7,1.1c-1.7-0.5-3.8,0.2-5.6,0c-1.8-0.2-3.6-0.9-5.5-1.4c0-0.3,0.1-0.7,0.1-1c2.9-0.3,5.7-0.6,8.6-0.9c6.1-0.5,11-3.7,16.1-6.7c1-0.6,2.2-1.2,3.4-1.2c4,0,8,0.4,12,0.4c7.3,0,14.6-0.2,21.8-0.5c3.8-0.2,7.5-1,11.8-1.6c-4.4-7-7.8-13.8-13.7-18.9c-2.9-2.5-6-3.4-9.7-3.5c-8.2-0.2-16.5-0.5-24.2-4.3c-3.4-1.7-5.7-4.2-7.7-7.2c-1.7-2.5-3.2-5.1-4.9-7.6c-1.5-2.3-3.5-4-6.2-5.1c-7.1-2.8-14.1-5.9-21.1-8.8c-0.5-0.2-1-0.3-1.3-0.4c0.2,4.1,0.7,8,0.5,11.9c-0.4,9.1-2.7,17.8-5.3,26.5c-1.4,4.8-3,9.5-4.6,14.2c-0.6,1.8-0.2,2.7,1.6,3c1.2,0.3,2.5,0.5,3.7,0.9c3.2,1,4.2,3.2,2.1,5.9c-1.8,2.3-4.1,4.1-6.3,6.1c-1.9,1.8-4.1,3.3-5.6,5.3c-1.2,1.6-2,3.7-2.5,5.6c-0.6,2.2-1.5,4-3.6,5.2c-4.6,2.5-9.3,2.3-14,0.7c-0.5-0.2-0.9-0.6-1.8-1.2c1.6-1.1,2.9-2.1,4.3-2.9c2-1.2,4.8-1.8,6-3.5c1.2-1.7,0.6-4.5,1-6.7c0.7-4,1.8-7.9,2.4-11.9c0.6-3.8,1-7.6,1.3-11.5c0.6-9.6,0.8-19.2,1.5-28.8c0.8-10,1.8-20.1,3-30.1c0.6-5.1,3.5-8.2,8.7-9.8c10.9-3.4,21.6-2.6,32.3,0.3c6,1.6,12,3.4,18,5.1c1.2,0.4,1.9,0.3,2.4-1c2.9-8.1,5.9-16.2,8.8-24.3c1.8-5,1.2-10.1-0.2-14.9c-2.8-9.5-1.3-18.7,0.3-28c1.6-9,3.3-18,5-27c0.6-2.9,1.2-5.9,1.8-8.8c0.5-2.5-0.2-4.5-1.8-6.4c-2.9-3.1-2.8-4.8,0.2-7.9c1.2-1.2,2.5-2.5,3.9-3.5c2.9-1.9,4.1-4.7,4.2-8c0.1-2.6,0.1-5.1,1.9-7.3c0.8-1.1,0.7-2.9,1.1-4.4c0.2-0.8,0.8-1.5,1.1-2.2C153.8,0,154.1,0,154.3,0.1z"/>
            </g>
        </svg>
        <p style="color:#6c757d;font-size:0.85rem;margin-top:4px;">Cre√° tu nueva contrase√±a</p>
    </div>

    <div id="estado-cargando" class="alert alert-info">
        ‚è≥ Verificando enlace...
    </div>

    <div id="estado-error" class="alert alert-danger" style="display:none;"></div>

    <div id="formulario" style="display:none;">
        <div class="form-group">
            <label for="nueva">Nueva contrase√±a</label>
            <div class="password-wrap">
                <input type="password" id="nueva" placeholder="M√≠nimo 6 caracteres" autocomplete="new-password" />
                <button class="toggle-pw" onclick="toggleVer('nueva', this)" tabindex="-1">üëÅ</button>
            </div>
        </div>
        <div class="form-group">
            <label for="confirmar">Repetir contrase√±a</label>
            <div class="password-wrap">
                <input type="password" id="confirmar" placeholder="Repet√≠ la contrase√±a" autocomplete="new-password" />
                <button class="toggle-pw" onclick="toggleVer('confirmar', this)" tabindex="-1">üëÅ</button>
            </div>
        </div>
        <button class="btn btn-primary" id="btn-guardar" onclick="guardarPassword()">
            Guardar contrase√±a
        </button>
    </div>

    <div id="exito" style="display:none;">
        <div class="alert alert-success">
            ‚úÖ <strong>¬°Contrase√±a actualizada!</strong><br/>
            Ya pod√©s ingresar a la app con tu nueva contrase√±a.
        </div>
        <a href="/" class="btn btn-primary" style="display:block; text-align:center; text-decoration:none; margin-top:4px;">
            Ir a la app
        </a>
    </div>

    <a href="/" class="back-link">‚Üê Volver al inicio</a>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyA-Z0FfWzThmcHbk5YH2bh-Z60pIkPOLN4",
        authDomain: "marina-pilates-730fb.firebaseapp.com",
        projectId: "marina-pilates-730fb",
        storageBucket: "marina-pilates-730fb.firebasestorage.app",
        messagingSenderId: "392495630154",
        appId: "1:392495630154:web:735dca0f037ded59ad63b3"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();

    // Extraer oobCode de la URL
    const params = new URLSearchParams(window.location.search);
    const oobCode = params.get('oobCode');
    const mode    = params.get('mode');

    function mostrar(id) {
        ['estado-cargando','estado-error','formulario','exito']
            .forEach(el => document.getElementById(el).style.display = 'none');
        document.getElementById(id).style.display = 'block';
    }

    function mostrarError(msg) {
        document.getElementById('estado-error').innerHTML = msg;
        mostrar('estado-error');
    }

    function toggleVer(inputId, btn) {
        const input = document.getElementById(inputId);
        if (input.type === 'password') {
            input.type = 'text';
            btn.textContent = 'üôà';
        } else {
            input.type = 'password';
            btn.textContent = 'üëÅ';
        }
    }

    async function guardarPassword() {
        const nueva     = document.getElementById('nueva').value;
        const confirmar = document.getElementById('confirmar').value;
        const btn       = document.getElementById('btn-guardar');

        if (nueva.length < 6) {
            return mostrarError('‚ùå La contrase√±a debe tener al menos 6 caracteres.');
        }
        if (nueva !== confirmar) {
            return mostrarError('‚ùå Las contrase√±as no coinciden.');
        }

        btn.disabled = true;
        btn.textContent = '‚è≥ Guardando...';

        try {
            await auth.confirmPasswordReset(oobCode, nueva);
            mostrar('exito');
        } catch (e) {
            console.error(e);
            if (e.code === 'auth/expired-action-code') {
                mostrarError('‚ùå El enlace expir√≥. Ped√≠ uno nuevo desde la app.');
            } else if (e.code === 'auth/invalid-action-code') {
                mostrarError('‚ùå El enlace no es v√°lido o ya fue usado. Ped√≠ uno nuevo.');
            } else {
                mostrarError('‚ùå Error al guardar. Intent√° de nuevo.');
            }
            btn.disabled = false;
            btn.textContent = 'Guardar contrase√±a';
        }
    }

    // Verificar el c√≥digo al cargar
    (async () => {
        if (mode !== 'resetPassword' || !oobCode) {
            return mostrarError('‚ùå Enlace inv√°lido. Asegurate de usar el link del mail.');
        }
        try {
            await auth.verifyPasswordResetCode(oobCode);
            mostrar('formulario');
        } catch (e) {
            if (e.code === 'auth/expired-action-code') {
                mostrarError('‚ùå El enlace expir√≥. Ped√≠ uno nuevo desde la app.');
            } else {
                mostrarError('‚ùå Enlace inv√°lido o ya usado. Ped√≠ uno nuevo desde la app.');
            }
        }
    })();
</script>

</body>
</html>
