<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Marina Pilates - Sistema de Reservas</title>
    <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
    <link rel="manifest" href="site.webmanifest">
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.10.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.10.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.10.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.10.0/firebase-messaging-compat.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            min-height: 100dvh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            min-height: calc(100vh - 40px);
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 10px 20px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 2px solid #dee2e6;
            flex-wrap: wrap;
        }
        
        .tab {
            flex: 1;
            min-width: 150px;
            padding: 20px;
            background: none;
            border: none;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            color: #6c757d;
        }
        
        .tab:hover { background: rgba(102, 126, 234, 0.1); }
        
        .tab.active {
            background: white;
            color: #667eea;
            border-bottom: 3px solid #667eea;
        }
        
        .content {
            padding: 30px;
            flex: 1;
        }
        
        .footer {
            padding: 20px 30px;
            background: #f8f9fa;
            border-top: 2px solid #dee2e6;
            text-align: right;
        }
        
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .card {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s;
        }
        
        .card:hover {
            box-shadow: 0 8px 16px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }
        
        .card.clickable { cursor: pointer; }
        
        .card.clickable:hover {
            border-color: #667eea;
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
        }
        
        .card h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }
        
        .info-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #f1f3f5;
        }
        
        .info-row:last-child { border-bottom: none; }
        .label { font-weight: 600; color: #495057; }
        .value { color: #6c757d; }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            margin: 5px;
        }
        
        .btn-primary { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 8px 16px rgba(102, 126, 234, 0.3); }
        .btn-danger { background: #dc3545; color: white; }
        .btn-danger:hover { background: #c82333; }
        .btn-success { background: #28a745; color: white; }
        .btn-success:hover { background: #218838; }
        .btn-secondary { background: #6c757d; color: white; }
        .btn-secondary:hover { background: #5a6268; }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; }
        
        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            margin: 2px;
        }
        
        .badge-success { background: #d4edda; color: #155724; }
        .badge-warning { background: #fff3cd; color: #856404; }
        .badge-danger { background: #f8d7da; color: #721c24; }
        .badge-info { background: #d1ecf1; color: #0c5460; }
        
        .form-group { margin-bottom: 20px; }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #495057;
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1rem;
        }
        
        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .alert { padding: 15px; border-radius: 8px; margin-bottom: 20px; }
        .alert-success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .alert-danger { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .alert-info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        .alert-warning { background: #fff3cd; color: #856404; border: 1px solid #ffeeba; }
        
        .stat-card {
            text-align: center;
            padding: 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 12px;
        }
        
        .stat-number { font-size: 3rem; font-weight: bold; margin: 10px 0; }
        .stat-label { font-size: 1.1rem; opacity: 0.9; }
        
        .modal {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 20px;
        }
        
        .modal-content {
            background: white;
            border-radius: 12px;
            padding: 30px;
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e9ecef;
        }
        
        .modal-header h2 { color: #667eea; margin: 0; }
        
        .close-btn {
            background: none;
            border: none;
            font-size: 2rem;
            color: #6c757d;
            cursor: pointer;
            line-height: 1;
            padding: 0;
            width: 44px;
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .close-btn:hover { color: #dc3545; }
        
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #e9ecef; }
        th { background: #f8f9fa; font-weight: 600; color: #495057; }
        tr:hover { background: #f8f9fa; }
        
        .horario-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            margin: 5px 0;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .horario-item:hover { background: #e9ecef; }
        
        .loading {
            text-align: center;
            padding: 50px;
            font-size: 1.5rem;
            color: #667eea;
        }
        
        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(102, 126, 234, 0.2);
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin: 20px auto 0;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .password-wrapper {
            position: relative;
        }
        
        .password-wrapper input {
            padding-right: 48px !important;
        }
        
        .password-toggle {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            cursor: pointer;
            color: #adb5bd;
            padding: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: auto;
            line-height: 1;
        }
        
        .password-toggle:hover {
            color: #667eea;
        }
        
        /* ===================== MOBILE ===================== */
        @media (max-width: 768px) {
            body {
                padding: 0;
                background: white;
            }
            
            .container {
                border-radius: 0;
                box-shadow: none;
                min-height: 100vh;
                min-height: 100dvh;
            }
            
            .header {
                padding: 8px 12px;
            }
            
            .header h1 {
                font-size: 1.6rem;
                margin-bottom: 4px;
            }
            
            .header p {
                font-size: 0.9rem;
            }
            
            /* Tabs como bottom nav fija */
            .tabs {
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                z-index: 100;
                border-top: 1px solid #dee2e6;
                border-bottom: none;
                background: white;
                flex-wrap: nowrap;
                box-shadow: 0 -4px 12px rgba(0,0,0,0.08);
                padding-bottom: env(safe-area-inset-bottom);
            }
            
            .tab {
                min-width: unset;
                padding: 10px 4px 8px;
                font-size: 0.62rem;
                font-weight: 600;
                display: flex;
                flex-direction: column;
                align-items: center;
                gap: 3px;
                border-bottom: none !important;
                border-top: 3px solid transparent;
                color: #adb5bd;
            }
            
            .tab.active {
                background: white;
                color: #667eea;
                border-top: 3px solid #667eea;
                border-bottom: none;
            }
            
            .tab-icon {
                font-size: 1.3rem;
                line-height: 1;
            }
            
            /* Espacio para el bottom nav */
            .content {
                padding: 16px;
                padding-bottom: calc(80px + env(safe-area-inset-bottom));
            }
            
            .footer {
                padding: 16px;
                padding-bottom: calc(80px + env(safe-area-inset-bottom));
            }
            
            /* Cards en columna única */
            .grid {
                grid-template-columns: 1fr;
                gap: 12px;
                margin-top: 12px;
            }
            
            .card {
                padding: 16px;
            }
            
            /* Modal pantalla completa */
            .modal {
                padding: 0;
                align-items: flex-end;
            }
            
            .modal-content {
                border-radius: 20px 20px 0 0;
                padding: 20px 16px;
                max-height: 92vh;
                max-height: 92dvh;
            }
            
            /* Botones más grandes para touch */
            .btn {
                padding: 14px 20px;
                font-size: 0.95rem;
                min-height: 48px;
            }
            
            /* Inputs más grandes */
            .form-group input,
            .form-group select,
            .form-group textarea {
                padding: 14px 12px;
                font-size: 1rem;
            }
            
            /* Stat cards más compactas */
            .stat-number { font-size: 2rem; }
            .stat-card { padding: 20px; }
            
            /* Tabla responsive */
            .table-responsive {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }
            
            /* Calendario móvil: celdas más chicas */
            .cal-cell {
                min-height: 60px !important;
                padding: 4px !important;
                font-size: 0.7rem;
            }
            
            .cal-num {
                font-size: 0.8rem !important;
                margin-bottom: 2px !important;
            }
            
            .cal-pill {
                font-size: 0.65rem !important;
                padding: 2px 3px !important;
                margin-bottom: 1px !important;
            }
            
            .cal-cancel-btn {
                font-size: 0.6rem !important;
                padding: 2px 4px !important;
            }
            
            /* H2 más pequeño */
            h2 { font-size: 1.3rem; }
            h3 { font-size: 1.1rem; }
        }
        
        /* Pantallas muy pequeñas */
        @media (max-width: 380px) {
            .tab { font-size: 0.55rem; }
            .tab-icon { font-size: 1.15rem; }
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect } = React;
        
        // Configuración de Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyDJDMsiLBABUdPMNaRyfJ-s2MTwse-kX1w",
            authDomain: "marina-pilates-730fb.firebaseapp.com",
            projectId: "marina-pilates-730fb",
            storageBucket: "marina-pilates-730fb.firebasestorage.app",
            messagingSenderId: "392495630154",
            appId: "1:392495630154:web:735dca0f037ded59ad63b3",
            measurementId: "G-55DKQ56CH1"
        };
        
        // Inicializar Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();
        
      // ============================================================
        //  NOTIFICACIONES PUSH — FCM
        // ============================================================
        const FCM_VAPID_KEY   = 'BHWFxkD8noIP18REPNIuz5tfwrxcS305XL-AMfONlx-NDOuNxRqjkBnZO0WWcyJeu1R021XRAFPm-U-OBtGslh0';   
        // Eliminamos la FCM_SERVER_KEY porque ahora usamos Cloud Functions de forma segura.
        
        let messaging = null;
        try {
            if ('serviceWorker' in navigator) {
                messaging = firebase.messaging();
            }
        } catch(e) {
            console.warn('FCM no disponible:', e.message);
        }
        
        // Registra el Service Worker y guarda el token FCM del admin en Firestore
        const inicializarPushAdmin = async () => {
            if (!messaging) return;
            try {
                // 1. Registramos el Service Worker
                const reg = await navigator.serviceWorker.register('/firebase-messaging-sw.js');
                
                // 2. ESPERAMOS a que el Service Worker esté activo
                // Este es el truco para evitar el error "no active Service Worker"
                while (!reg.active) {
                    await new Promise(resolve => setTimeout(resolve, 100));
                }

                const permiso = await Notification.requestPermission();
                if (permiso !== 'granted') return;

                // 3. Ahora que está activo, pedimos el token
                const token = await messaging.getToken({ 
                    vapidKey: FCM_VAPID_KEY, 
                    serviceWorkerRegistration: reg 
                });

                if (token) {
                    await db.collection('configuracion').doc('notificaciones').set({ 
                        adminPushToken: token, 
                        updatedAt: new Date().toISOString() 
                    }, { merge: true });
                    console.log('✅ Push activado para admin y guardado correctamente');
                }
            } catch(e) {
                console.warn('Error al inicializar push:', e.message);
            }
        };
        
               
        // Feriados de Argentina 2026 + opción para custom
        const FERIADOS_FIJOS = [
            '2026-01-01', // Año Nuevo
            '2026-02-09', // Carnaval
            '2026-02-10', // Carnaval
            '2026-03-24', // Memorial de Malvinas
            '2026-04-02', // Día de Malvinas
            '2026-04-10', // Viernes Santo
            '2026-05-01', // Día del Trabajador
            '2026-05-25', // Revolución de Mayo
            '2026-06-17', // Guemes
            '2026-06-20', // Bandera
            '2026-07-09', // Independencia
            '2026-07-17', // Muerte del Gral Güemes
            '2026-08-17', // Muerte del Gral San Martín
            '2026-10-12', // Respeto a la Diversidad Cultural
            '2026-11-02', // Difuntos
            '2026-12-08', // Inmaculada Concepción
            '2026-12-25'  // Navidad
        ];
        
        // Helper para formatear fecha sin problemas de timezone
        const fechaLocal = (fecha) => {
            const y = fecha.getFullYear();
            const m = String(fecha.getMonth() + 1).padStart(2, '0');
            const d = String(fecha.getDate()).padStart(2, '0');
            return `${y}-${m}-${d}`;
        };
        
        // Logo Marina Pilates
        const LogoSVG = ({ width = 180, style = {} }) => (
            <svg viewBox="0 0 327 399.1" width={width} style={{display:'block', ...style}} xmlns="http://www.w3.org/2000/svg">
                <style>{`.L0{fill:#823CC6;}.L1{fill:#6C6B6B;}.L2{display:none;}.L3{display:inline;}.L4{fill:#B51385;}.L5{fill:#9E55D8;}`}</style>
                <g>
                <path className="L0" d="M162.2,0.1c0.4,1.3,0.9,2.6,1.1,3.9c1.1,9.4,1.1,18.6-0.3,28.1c-1,6.5-0.7,13.1-0.5,19.7c0.6,17,1.4,34,2.2,51
                c0.4,8.5,1.8,16.9,1.6,25.4c-0.2,9.9,0.6,19.6,2.2,29.3c0.3,1.9,1.2,3.2,2.8,4.3c9.4,6.5,18.8,13.1,28.3,19.5
                c3.3,2.2,6.9,4.1,10.5,5.8c5.4,2.5,7.9,6.9,8.8,12.4c0.9,5,1.8,10,2.8,15.1c0.1,0.4,0.3,0.7,0.9,1.1c0-1.4,0.1-2.9,0-4.3
                c-0.1-2-0.4-3.9-0.5-5.9c-0.1-1.7,0.7-2.5,2.5-2c1.4,0.4,2.4,0.2,3.7-1c1-0.9,3.1-1.2,4.6-1c1.3,0.2,1.7,0.1,2.1-1
                c1-2.6,1.7-2.7,3.9-0.9c2.3,1.9,4.7,3.1,7.8,3.6c4.8,0.7,9.5,2.1,12.1,6.9c1.9,3.5,2,7.2,1.3,11c-0.5,2.6,2.4,5,4.9,4.2
                c1.1-0.4,2.3-0.6,3.5-0.7c0.5,0,1.2,0.6,1.4,1.1c0.7,2.1,0.4,4-1.5,5.6c0.9,0.6,1.7,1.1,2.5,1.7c1.3,1.1,2.2,2.8,1.4,4.3
                c-0.5,0.9-2.1,1.7-3.2,1.8c-3.6,0.2-7.3,0.1-10.9,0.1c-5.9-0.1-11.9-0.4-17.8-0.6c-2.7-0.1-5.4,0-8-0.5c-2-0.4-4-1.2-5.7-2.3
                c-2-1.2-3.3-1.3-4.7,0.5c-1.3,1.6-3,1.5-4.8,1.7c-21.2,2.5-42.5,0.7-63.7,2c-1.5,0.1-3,0.2-4.4,0.5c-4.6,1-9,0.8-13.6-0.5
                c-5-1.4-10-0.5-14.8,1.3c-3.3,1.3-6.7,2.4-10.1,3.5c-7,2.1-14,1.7-20.8-0.7c-0.6-0.2-1.1-0.5-1.6-0.8c0-0.2-0.1-0.5-0.1-0.7
                c1.4-0.6,2.8-1.5,4.2-1.7c9.5-1.5,18.3-5,27-8.8c4.6-2.1,9.5-2.2,14.4-2.3c4,0,7.9-0.4,11.8-0.7c0-0.2,0.1-0.5,0.1-0.7
                c-0.4-0.2-0.7-0.5-1.1-0.6c-0.6-0.2-1.2-0.4-1.8-0.6c-5.6-2.6-11.1-2.8-16.7,0.3c-3,1.6-6.2,2.2-9.7,1.1c-1.7-0.5-3.8,0.2-5.6,0
                c-1.8-0.2-3.6-0.9-5.5-1.4c0-0.3,0.1-0.7,0.1-1c2.9-0.3,5.7-0.6,8.6-0.9c6.1-0.5,11-3.7,16.1-6.7c1-0.6,2.2-1.2,3.4-1.2
                c4,0,8,0.4,12,0.4c7.3,0,14.6-0.2,21.8-0.5c3.8-0.2,7.5-1,11.8-1.6c-4.4-7-7.8-13.8-13.7-18.9c-2.9-2.5-6-3.4-9.7-3.5
                c-8.2-0.2-16.5-0.5-24.2-4.3c-3.4-1.7-5.7-4.2-7.7-7.2c-1.7-2.5-3.2-5.1-4.9-7.6c-1.5-2.3-3.5-4-6.2-5.1
                c-7.1-2.8-14.1-5.9-21.1-8.8c-0.5-0.2-1-0.3-1.3-0.4c0.2,4.1,0.7,8,0.5,11.9c-0.4,9.1-2.7,17.8-5.3,26.5c-1.4,4.8-3,9.5-4.6,14.2
                c-0.6,1.8-0.2,2.7,1.6,3c1.2,0.3,2.5,0.5,3.7,0.9c3.2,1,4.2,3.2,2.1,5.9c-1.8,2.3-4.1,4.1-6.3,6.1c-1.9,1.8-4.1,3.3-5.6,5.3
                c-1.2,1.6-2,3.7-2.5,5.6c-0.6,2.2-1.5,4-3.6,5.2c-4.6,2.5-9.3,2.3-14,0.7c-0.5-0.2-0.9-0.6-1.8-1.2c1.6-1.1,2.9-2.1,4.3-2.9
                c2-1.2,4.8-1.8,6-3.5c1.2-1.7,0.6-4.5,1-6.7c0.7-4,1.8-7.9,2.4-11.9c0.6-3.8,1-7.6,1.3-11.5c0.6-9.6,0.8-19.2,1.5-28.8
                c0.8-10,1.8-20.1,3-30.1c0.6-5.1,3.5-8.2,8.7-9.8c10.9-3.4,21.6-2.6,32.3,0.3c6,1.6,12,3.4,18,5.1c1.2,0.4,1.9,0.3,2.4-1
                c2.9-8.1,5.9-16.2,8.8-24.3c1.8-5,1.2-10.1-0.2-14.9c-2.8-9.5-1.3-18.7,0.3-28c1.6-9,3.3-18,5-27c0.6-2.9,1.2-5.9,1.8-8.8
                c0.5-2.5-0.2-4.5-1.8-6.4c-2.9-3.1-2.8-4.8,0.2-7.9c1.2-1.2,2.5-2.5,3.9-3.5c2.9-1.9,4.1-4.7,4.2-8c0.1-2.6,0.1-5.1,1.9-7.3
                c0.8-1.1,0.7-2.9,1.1-4.4c0.2-0.8,0.8-1.5,1.1-2.2C161.7,0,162,0,162.2,0.1z"/>
                </g>
                <g>
                <g>
                <g>
                <g>
                <path className="L1" d="M52.3,302.2h-7.7v-34.9h-0.1l-2.8,6.8l-15.5,28.8H26l-15.5-29l-2.7-6.6H7.7v34.9H0v-51.6h6.6l17,32.1
                l2.5,6.1h0.1l2.5-6.1l17.1-32.1h6.4L52.3,302.2L52.3,302.2z"/>
                <path className="L1" d="M113.2,302.2h-8.3l-5.4-12l0.4-0.7H72.3l0.4,0.7l-5.4,12H59l23.4-51.6h7.5L113.2,302.2z M96.3,282.5
                l-0.8-0.8l-7.9-17.5l-1.5-4.7H86l-1.5,4.6l-8,17.6l-0.8,0.8H96.3L96.3,282.5z"/>
                <path className="L1" d="M166,302.2h-8.5l-6.7-13.6c-2.4-4.8-5.9-7-12.4-7h-11.6l0.8,0.7v20h-7.7v-51.6h23.4
                c9.8,0,18.2,5.1,18.2,15.5c0,6.3-4.5,11.2-9.7,13v0.1c2.1,0.9,4.5,3.1,6,6.2L166,302.2z M143.3,257.7h-16.5l0.8,0.8v15.2
                l-0.8,0.8h15.9c7.1,0,11-3.6,11-8.4C153.6,260,149.4,257.7,143.3,257.7z"/>
                <path className="L1" d="M180.1,302.2h-7.7v-51.6h7.7V302.2z"/>
                <path className="L1" d="M235.8,302.2H229l-25.9-33.4l-3.6-5.9h-0.1v39.3h-7.7v-51.6h6.8l26,33.5l3.4,5.8h0.1v-39.3h7.7L235.8,302.2
                L235.8,302.2z"/>
                <path className="L1" d="M296.8,302.2h-8.3l-5.4-12l0.4-0.7H256l0.4,0.7l-5.4,12h-8.3l23.4-51.6h7.5L296.8,302.2z M279.9,282.5
                l-0.8-0.8l-7.9-17.5l-1.5-4.7h-0.1l-1.5,4.6l-8,17.6l-0.8,0.8H279.9L279.9,282.5z"/>
                </g>
                </g>
                <g className="L2">
                <g className="L3">
                <path className="L4" d="M172.5,176.6c-2.7-1.8-3.6-3.8-3.8-6.6c0-0.5,0-1.1-0.1-1.7c-1.5-11.9-10.7-22.9-26.2-19.5
                c-3.1,0.7-5,0-6.9-1.9c-3.4-3.5-7.8-5.2-12.5-6.2c-5.6-1.2-10.7,0-15.2,3.5c-2.5,2-4.9,4.2-6.3,7c-1,1.9-2.3,2.4-4.2,2.5
                c-4.7,0.2-9.2,1.3-13.4,3.8c-7.3,4.5-11.4,12-9.6,20.4c1,4.5-0.2,7.4-2.9,11c-8.3,10.8-7.3,24.1,5.3,32.1c2,1.2,3.1,2.5,2.9,4.8
                c-0.1,0.8,0,1.7,0.1,2.5c1.5,11.8,10.4,23.4,26.4,19.7c3-0.7,4.7,0.1,6.5,1.9c4.6,4.5,10.2,6.4,15.3,6.7c8.1,0,14.3-3.3,18.3-10
                c1.6-2.6,3.3-3.8,6.2-3.6c1.2,0.1,2.5-0.2,3.7-0.5c12.6-2.1,20.4-12.9,17.8-25.3c-0.7-3.3-0.2-5.5,2-7.7c0.5-0.5,0.9-1,1.3-1.6
                C185.4,196.6,184,184.3,172.5,176.6z M133.4,158.3c4.3-4.1,13.8-4.7,19-1.6c4.5,2.8,7.4,6.5,8.5,11.7c0.3,1.4,1.1,3.1-0.6,4.1
                c-1.3,0.8-4.2-0.3-5.2-1.9c-1.5-2.4-3.4-4.3-6-5.6c-2.1-1.1-4.4-1.6-6.9-1.4c-0.5,0-1.1-0.2-1.6,0c-3.9,1.7-5.3-1.8-7.5-3.6
                C132.6,159.5,132.8,158.9,133.4,158.3z M121.6,179.9c-0.8,2.4-0.5,4.9-1.1,7.3c-0.3,1.1-0.4,2-1.3,2.8c-2.1,1.6-2.1,1.8-3.6-0.6
                c-1.2-1.8-2.4-3.7-3.3-5.7c-3-6.6,1-15.9,7.8-18.5c3.8-1.4,7.2-0.1,11.4,1.6C126.4,170.4,123.3,174.5,121.6,179.9z M144.7,171.9
                c3.6,1.9,5.6,5,6.6,8.9c-0.5,0.1-0.8,0.2-1,0.2c-7.9-1.1-14.6,1.3-20.4,6.7c-0.7,0.6-1.2,1.5-2.4,1.4c-2.8-0.2-3.7-1.1-3-3.9
                c0.6-2.4,1.6-4.6,2.4-7C129,171.9,140.1,169.5,144.7,171.9z M116.9,205.8c-2.4,2.2-5.4,3.5-8.3,4.9c-5.6,2.6-12-0.5-15.8-5
                c-3.2-3.9-3.5-8.2-0.2-14.3c3.4,4.5,7.2,7.8,12.3,9.4c2,0.6,4,1.1,6.1,1C113.9,201.6,115.9,202.7,116.9,205.8z M112.5,213.6
                c2.4-1.2,4.4-2.8,6.2-4.7c1.7-1.9,3.3-0.5,4.9-0.3c0.7,0.1,0.6,1.1,0.4,1.8c-0.8,2.6-1.3,5.4-2.3,7.9c-2.6,6.1-11.8,9.6-17.8,7
                c-3.8-1.7-5.7-4.9-7.2-9.4C102.7,216.8,107.7,216.1,112.5,213.6z M126.7,217.2c0.7-2.4,1.1-4.9,1-7.4c-0.1-2.4,1.8-2.9,3.2-3.8
                c0.7-0.5,1.2,0.3,1.6,0.9c1.6,2.5,3.2,5.2,4.2,8c1.8,5,0,9.3-3.2,13c-4.7,5.4-8.8,5.9-16.5,2.3
                C121.9,226.7,125.1,222.6,126.7,217.2z M131.4,191.2c2.3-2.2,5.4-3.5,8.3-4.9c7.3-3.5,15.8,2.8,17.8,7.9
                c1.5,3.9,0.4,7.5-1.7,11.6c-3.5-5-7.5-8.2-12.7-9.8c-1.7-0.5-3.4-1.1-5.2-0.9C134.8,195.5,132.6,194.4,131.4,191.2z
                M102.2,163.2c1.5-4.7,3.2-9.3,7.2-12.3c2.9-2.2,6.7-2.5,10.3-2.5c4.7,0,8.8,1.9,12.2,5.3c-2,3.1-4.1,3.8-7.3,3.2
                c-5.6-1-10.3,1-13.7,5.7c-0.7,1-1.1,2.4-2.7,2.4c-1.8,0-3.6,0.1-5.4-0.1C102,164.8,102,163.9,102.2,163.2z M106.7,171.3
                c-0.1,2.5-0.8,4.9-0.3,7.4c0.9,5.3,3,10,6.8,13.9c0.6,0.7,1.5,1.1,1.7,2.3c0.2,2.9-1,4-3.9,3.3c-2.1-0.5-4.2-1.3-6.2-2
                c-6.1-2-8.1-8.8-7.8-15C97.2,176.5,100.5,173,106.7,171.3z M80.5,174.3c1.8-6.1,6.2-10.7,12.8-12.4c0.4-0.1,0.8-0.2,1.2-0.2
                c1.3-0.2,2.7-1.1,3.8,0.3c0.7,0.9-0.5,4.8-1.6,5.5c-5.9,3.6-8.1,8.8-7.1,15.5c0.3,1.9-0.2,3.1-1.6,4.3c-1,0.9-1.8,2-3,3.4
                C81.3,185.3,78.8,180,80.5,174.3z M74.6,208c-1.3-5.3-0.4-10.1,2.5-14.6c0.7-1.1,1.4-3,3-2.1c1.4,0.8,3.1,2,2.8,4.4
                c-0.4,2.1-1,4.3-0.5,6.7c0.8,3.5,2.1,6.7,5.2,8.6c3.5,2.1,2.9,5.2,2.8,8.4c0,0.9-0.6,1.1-1.4,1.1C83,220.2,76,213.9,74.6,208z
                M101.8,242.6c-4.7-0.2-8-3.5-11-6.7c-2.1-2.3-3-5.2-3.6-8.3c-0.2-1-0.6-2.2,0.5-3.1c0.7-0.6,4.4,0,5,0.8
                c0.4,0.5,0.7,1.2,1.1,1.7c3.2,4.5,7.5,7.1,13.1,6.2c3.3-0.5,5.5,0.5,7.5,2.9c0.4,0.5,1.2,0.8,2.3,1.5
                C111.5,241.1,106.9,242.8,101.8,242.6z M134.7,247.9c-7,1.8-13,0.5-18.3-4.7c2-3,4.3-3.6,7.4-3c5.3,1.1,10.2-0.6,13-5.2
                c2.3-3.5,5.4-2.5,8.3-2.9c1-0.1,1,0.8,1,1.5C146.1,238.8,139.8,246.5,134.7,247.9z M141.5,225.8c1-5.7,0.3-10.8-2.1-15.6
                c-1.2-2.3-2.8-4.1-4.4-5.9c-0.9-1-1.5-1.8-1.2-3.2c0.5-2.5,0.7-2.7,3.3-2.1c2,0.4,4,0.9,6,1.6c6.8,2.4,10.8,11.8,7.9,18.5
                C149.7,221.8,146.5,224.3,141.5,225.8z M168,223.3c-3,6.3-7.4,10.9-14.5,12.2c-1.1,0.2-2.8,0.9-3.2-0.7
                c-0.3-1.5-0.8-3.3,0.6-4.7c0.7-0.7,1.6-1.1,2.4-1.6c4.4-3.3,6.6-7.8,5.8-13.3c-0.4-2.6-0.2-4.5,2-6c0.9-0.6,1.2-1.8,2.9-2.4
                c2.9,4.2,4.3,8.7,4.5,13.6C168.5,221.4,168.4,222.4,168,223.3z M171,204c-0.7,1-1.4,2.6-2.7,1.8s-2.8-1.9-2.9-3.7
                c0-0.7,0.4-1.3,0.5-2c0.9-5.9-0.5-10.9-5.6-14.6c-2.4-1.7-3.3-4.9-2.4-7.6c0.5-1.6,1.7-1.1,2.7-0.9c8.7,1.9,13.8,8.1,13.8,18
                C174.3,197.6,173,200.9,171,204z"/>
                <path className="L4" d="M71.8,223.7c-1.7-0.1-2.8,0.8-3,2.6c-0.2,1.9,1.3,3.7,3,3.7c1.6,0,3-1.5,3.1-3.2S73.7,223.8,71.8,223.7z"/>
                <path className="L4" d="M96.1,149.2c1.6,0,2.9-1.4,3-3.3c0-1.7-1-2.9-2.7-2.9c-1.8-0.1-3.6,1.6-3.6,3.2
                C92.8,147.8,94.4,149.3,96.1,149.2z"/>
                <path className="L4" d="M140.9,144.5c1.8,0.1,3.5-1.1,3.6-2.6c0.2-1.7-1.5-3.4-3.3-3.5c-1.7-0.1-2.9,1-3,2.7
                C138,142.9,139.2,144.4,140.9,144.5z"/>
                <path className="L4" d="M177.1,173.4c1.6-0.1,2.7-1.3,2.6-3.1c-0.1-1.7-1.6-3.3-3.1-3.3c-1.6,0-3,1.6-3.1,3.3
                C173.5,172.1,175.1,173.5,177.1,173.4z"/>
                <path className="L4" d="M67.4,184.4c1.7-0.2,2.9-1.4,2.8-2.9c0-1.8-1.5-3.4-3.1-3.3c-1.6,0.1-3,1.7-3.1,3.4
                C64.1,183.3,65.5,184.6,67.4,184.4z"/>
                <path className="L4" d="M152.3,247.8c-1.7,0-3.1,1.8-2.9,3.7c0.1,1.6,1.5,2.6,3.1,2.5c1.7-0.2,3.2-1.7,3.2-3.2
                C155.6,249.2,153.9,247.7,152.3,247.8z"/>
                <path className="L4" d="M107.5,252.5c-1.8-0.1-3.7,1.5-3.7,3s1.7,2.9,3.3,3c1.7,0.1,2.9-1,3-2.6
                C110.3,254.1,109.1,252.6,107.5,252.5z"/>
                <path className="L4" d="M181.5,212.6c-1.9-0.1-3.3,1.1-3.4,2.8c0,1.8,1.3,3.5,2.9,3.5c1.5,0,3-1.6,3.1-3.3
                C184.3,213.9,183.2,212.7,181.5,212.6z"/>
                </g>
                </g>
                </g>
                <g>
                <g>
                <path className="L5" d="M70.9,399.1c-0.9,0-1.3-0.4-1.3-1.1c0-0.3,0.1-0.7,0.3-1.2c0.9-1.9,2.1-4.7,3.7-8.4c1.6-3.7,3.3-8,5.3-12.8
                c1.9-4.8,3.8-9.8,5.8-14.8c1.7-4.5,3.4-8.9,5-13.1s3-8.1,4.1-11.6s1.6-6.1,1.6-8c0-0.6,0.4-0.9,1.2-1c0.8-0.1,1.5-0.2,2.3-0.2
                c2.4,0,3.6,0.8,3.6,2.4c0,1.3-0.7,3-2.2,5.1c-1.3,2.1-2.4,4.2-3.4,6.5s-1.9,4.5-2.8,6.8c1.7-2.3,3.4-4.6,4.9-6.8
                c1.5-2.2,3.3-4.2,5.3-5.8c1.6-1.2,3.2-2.2,4.7-3s3.2-1.1,5-1.1c1.9,0,3.8,0.5,5.6,1.4c1.8,0.9,3,2.3,3.3,4.3
                c0.1,0.2,0.1,0.5,0.1,0.7s0,0.5,0,0.7c0,2.5-0.7,5-2.2,7.4s-3.2,4.6-5.3,6.5c-2,1.9-3.9,3.4-5.6,4.6c-6.7,4-8.9,4.5-5.3,2.8
                c-2.1,1-4.2,1.9-6.5,2.6s-4.5,1.1-6.6,1.1c-1.3,0-2.4-0.2-3.3-0.4c-0.9,2.2-2,5-3.3,8.4s-2.4,6.8-3.5,10.2
                c-0.5,1.5-0.7,2.6-0.5,3.5s0,2-0.5,3.4c-0.4,1.5-0.9,2.8-1.4,4.2c-0.5,1.3-1.1,2.6-1.7,3.8c-0.1,0.3-0.6,0.7-1.4,1.2
                s-1.6,0.9-2.6,1.3C72.5,398.9,71.6,399.1,70.9,399.1z M89.2,360.8c2.3,0,4.7-0.5,7.3-1.6c2.5-1.1,5-2.5,7.5-4.3s4.7-3.8,6.7-5.9
                s3.6-4.2,4.8-6.2c1.5-2.3,2.2-4.5,2.2-6.4c0-2.2-1-3.4-2.9-3.4c-0.5,0-1.1,0.1-1.8,0.3c-0.7,0.2-1.6,0.5-2.5,1
                c-3.8,2-7,4.4-9.4,7.1c-2.5,2.7-4.6,5.7-6.3,9C92.9,353.5,91.1,357,89.2,360.8z"/>
                <path className="L5" d="M137.5,363.1c-1.3,0-2.5-0.3-3.5-0.9s-1.8-1.7-2.3-3.3c-0.1-0.2-0.1-0.4-0.2-0.7c0-0.2,0-0.5,0-0.8
                c0-1.5,0.3-3.3,1-5.4c0.7-2.2,1.5-4.3,2.4-6.3c-0.4,0.6-0.9,1.3-1.5,2.1s-1.4,1.9-2.5,3.2c-0.3,0.3-0.6,0.4-1,0.4
                c-0.5,0-0.8-0.3-0.8-0.9c0-0.4,0.1-0.8,0.4-1.1c1.9-2.4,3.6-4.5,5-6.4c1.5-1.9,2.6-3.5,3.3-4.8c0-0.1,0-0.1,0-0.2
                c0,0,0-0.1,0-0.2c0-0.2,0.1-0.5,0.3-1c0.6-1.7,1.2-3.2,1.8-4.4c0.6-1.2,1.3-1.9,2-2c0.1,0,0.3,0,0.4,0c0.1,0,0.3,0,0.4,0
                c0.8,0,1.5,0.2,2.2,0.5c0.7,0.4,1,0.9,1,1.6s-0.2,1.5-0.7,2.4s-1.1,2.1-1.8,3.5c-1.6,3.3-3,6.3-4.3,9.1c-1.3,2.7-2,4.9-2.1,6.7
                c-0.1,0.3-0.1,0.6-0.1,0.8s0,0.5,0,0.8c0,2.9,0.9,4.3,2.8,4.3c1.2,0,2.6-0.6,4.5-1.9s3.7-2.8,5.5-4.7c1.9-1.8,3.6-3.6,5.2-5.3
                s2.6-3,3.2-3.8c0.2-0.2,0.4-0.3,0.7-0.3s0.5,0.1,0.7,0.3c0.2,0.2,0.2,0.5,0,0.9c-0.7,1.2-1.8,2.8-3.3,4.6
                c-1.6,1.8-3.3,3.7-5.2,5.5s-3.8,3.4-5.6,4.7c-0.9,0.7-2.1,1.4-3.5,1.9C140.3,362.8,138.9,363.1,137.5,363.1z M149.3,324.2
                c-0.9,0-1.9-0.1-2.9-0.3s-1.5-0.8-1.5-2c0-0.2,0.5-0.7,1.5-1.5s2-1.6,3-2.4s1.7-1.3,1.9-1.5c1.2-1,2-1.5,2.3-1.5
                c0.4,0,0.4,0.5,0,1.4s-0.5,1.8-0.5,2.5c0,0.4-0.2,1-0.7,1.8c-0.4,0.9-0.9,1.7-1.5,2.4S149.7,324.2,149.3,324.2z"/>
                <path className="L5" d="M164.3,363.1c-3,0-5.2-0.8-6.3-2.3s-1.8-3.4-1.8-5.6c0-2.1,0.5-4.7,1.5-7.9c1-3.2,2.3-6.6,3.8-10.3
                c1.6-3.7,3.3-7.4,5.2-11c1.8-3.7,3.7-7,5.5-10.1s3.5-5.5,4.8-7.4c1.4-1.8,2.9-3.6,4.5-5.4s3.4-3.3,5.3-4.6c2-1.2,4.2-1.9,6.6-1.9
                c1.7,0,3.1,0.5,4.3,1.4s1.8,2.3,1.8,4.1c0,0.7-0.1,1.6-0.4,2.5s-0.7,1.9-1.2,2.9c-4.4,7.7-9.7,14.8-15.8,21.3
                s-12.6,12.5-19.4,18.1c-0.3,1.1-0.6,2.1-0.8,2.9s-0.5,1.6-0.6,2.1c-0.1,0.4-0.1,0.7-0.1,1.1s0,0.8,0,1.1c0,1.7,0.3,3.3,0.9,4.6
                s1.5,2,2.9,2c1.3,0,2.9-0.6,4.8-1.9c1.9-1.3,3.8-2.8,5.8-4.7c2-1.8,3.7-3.6,5.3-5.4c1.6-1.7,2.7-3.1,3.4-4
                c0.2-0.2,0.4-0.3,0.7-0.3s0.5,0.2,0.7,0.4c0.2,0.3,0.2,0.7,0,1.1c-0.7,1.2-1.9,2.8-3.5,4.6c-1.6,1.8-3.4,3.6-5.3,5.5
                c-2,1.8-3.8,3.5-5.6,4.8C168.9,362.3,166.6,363.1,164.3,363.1z M164.2,342.4c2.8-1.9,5.6-4.3,8.6-7.3s5.9-6.3,8.7-9.8
                s5.5-7.1,7.8-10.5c2.3-3.5,4.2-6.6,5.7-9.4c0.4-0.8,0.7-1.5,0.9-2.1s0.3-1.2,0.3-1.7c0-1.4-0.6-2.1-1.7-2.1c-1,0-2.3,0.5-3.8,1.6
                c-3.9,3-7.5,6.9-10.8,11.7c-3.3,4.7-6.3,9.7-8.9,14.9C168.3,332.9,166.1,337.8,164.2,342.4z"/>
                <path className="L5" d="M213,363.1c-1.2,0-2.4-0.3-3.4-0.9s-1.8-1.7-2.3-3.3c-0.2-0.7-0.3-1.5-0.3-2.7c0-1.6,0.2-3.4,0.7-5.3
                c0.4-2,0.9-3.6,1.4-5c-0.4,0.2-1,0.8-2,1.9s-2.2,2.5-3.6,4c-1.4,1.6-3,3.1-4.7,4.7s-3.5,2.8-5.3,3.8s-3.6,1.5-5.3,1.5
                c-1.2,0-2.4-0.3-3.7-1s-2.3-1.6-3.2-2.7c-1.1-1.5-1.6-2.9-1.6-4.5c0-2,0.7-4,2-6.1s3.1-4.1,5.2-6.1c2.1-2,4.4-3.8,6.8-5.4
                c2.4-1.6,4.7-3,7-4.1s4-1.9,5.4-2.2c1.5-0.4,3.1-0.7,4.9-0.7c1,0,2.1,0.1,3.2,0.4s2,0.7,2.7,1.2c0.6,0.3,1,0.7,1.4,1.2
                s0.5,1,0.5,1.6s-0.2,0.8-0.8,0.5c-0.6-0.9-1.4-1.4-2.3-1.7c-1-0.2-2-0.4-3-0.4c-2.9,0-6.1,0.9-9.5,2.8s-6.6,4.1-9.3,6.6
                c-0.9,0.7-2,2-3.5,3.8s-2.8,3.7-4.1,5.8s-1.8,4-1.8,5.8c0,0.9,0.2,1.8,0.8,2.5c0.3,0.5,0.8,0.8,1.4,0.8c1,0,2.4-0.5,4.1-1.6
                c1.7-1.1,3.5-2.4,5.3-4s3.5-3.1,4.9-4.5c1.5-1.5,2.5-2.5,3.2-3.2c0.4-0.4,1.1-1.1,2.1-2.2s2.2-2.3,3.4-3.6
                c1.2-1.3,2.3-2.4,3.3-3.4c1-0.9,1.6-1.4,1.9-1.4c0.4,0,1,0.1,1.8,0.3c0.8,0.2,1.5,0.5,2.1,0.8s0.7,0.8,0.3,1.4
                c-1.9,2.8-3.4,5.6-4.5,8.6s-1.8,5.4-2,7.1c-0.1,0.3-0.1,0.6-0.1,0.8s0,0.5,0,0.8c0,2.9,1,4.3,3,4.3c1.1,0,2.5-0.7,4.3-2
                s3.7-2.9,5.5-4.7c1.9-1.8,3.6-3.6,5.2-5.3c1.5-1.7,2.6-3,3.2-3.8c0.2-0.2,0.4-0.3,0.7-0.3c0.3,0,0.5,0.1,0.8,0.4
                c0.2,0.2,0.2,0.6,0,0.9c-0.8,1.3-2,2.9-3.5,4.7c-1.5,1.8-3.2,3.6-5.1,5.4s-3.7,3.4-5.5,4.7c-0.9,0.7-2.1,1.4-3.6,1.9
                C215.9,362.8,214.4,363.1,213,363.1z"/>
                <path className="L5" d="M237.5,363.1c-1.3,0-2.5-0.3-3.5-0.9s-1.8-1.7-2.3-3.3c-0.1-0.2-0.1-0.4-0.2-0.7c0-0.2,0-0.5,0-0.8
                c0-1.5,0.3-3.3,1-5.4s1.5-4.3,2.4-6.3c-0.4,0.6-0.9,1.3-1.5,2.1s-1.4,1.9-2.5,3.2c-0.3,0.3-0.6,0.4-1,0.4c-0.5,0-0.8-0.3-0.8-0.9
                c0-0.4,0.1-0.8,0.4-1.1c1.9-2.4,3.6-4.5,5-6.4c1.5-1.9,2.6-3.5,3.3-4.8c0-0.1,0.2-0.6,0.7-1.4c0.4-0.8,1-1.8,1.7-3.2
                c-0.6,0.1-1.1,0.1-1.5,0.2c-0.4,0-0.7,0-1,0c-0.5,0-0.9-0.2-1.3-0.7c-0.4-0.4-0.4-1-0.1-1.6c0.4-1,1.2-1.6,2.4-1.7
                c1.2-0.1,2.3-0.2,3.3-0.3c0.1-0.1,0.2-0.2,0.4-0.2c0.9-1.6,1.7-3.2,2.5-4.7s1.5-2.8,2-3.8s0.8-1.5,0.8-1.6
                c1.5-2.3,2.4-3.8,2.8-4.6s1-1.2,1.7-1.4c0.8-0.1,1.6,0,2.5,0.1c0.9,0.2,1.5,0.5,1.8,1c0.2,0.3,0.3,0.7,0.3,1.1
                c0,0.7-0.2,1.3-0.4,1.9c-0.3,0.6-0.6,1.1-0.9,1.5c-0.3,0.5-0.7,0.8-1.1,1c-0.5,0.2-0.9,0.6-1.2,1.4c-0.7,1.4-1.5,2.9-2.4,4.5
                s-1.8,3.1-2.7,4.6l1.3-0.1c1.7-0.1,3.4-0.3,4.9-0.5s3.3-0.3,5.4-0.2c0.4,0,0.7,0,1.1,0.2s0.6,0.3,0.6,0.5c0,0.3-0.9,0.7-2.8,1.2
                c-0.7,0.3-2.3,0.6-4.7,0.9c-2.4,0.3-4.9,0.6-7.4,0.9c-0.7,1.4-1.4,2.5-2,3.4s-1,1.6-1.2,2c-1.6,3.3-3,6.3-4.3,9.1
                c-1.3,2.7-2,4.9-2.1,6.7c-0.1,0.3-0.1,0.6-0.1,0.8s0,0.5,0,0.8c0,2.9,0.9,4.3,2.8,4.3c1.2,0,2.6-0.6,4.5-1.9s3.7-2.8,5.5-4.7
                c1.9-1.8,3.6-3.6,5.2-5.3s2.6-3,3.2-3.8c0.2-0.2,0.4-0.3,0.7-0.3c0.3,0,0.5,0.1,0.7,0.3c0.2,0.2,0.2,0.5,0,0.9
                c-0.7,1.2-1.8,2.8-3.3,4.6c-1.6,1.8-3.3,3.7-5.2,5.5c-1.9,1.8-3.8,3.4-5.6,4.7c-0.9,0.7-2.1,1.4-3.5,1.9
                C240.4,362.8,239,363.1,237.5,363.1z"/>
                <path className="L5" d="M266.2,363.6c-3.3,0-6.1-0.8-8.5-2.3s-3.6-3.8-3.6-7c0-1.7,0.5-3.7,1.5-6.1c0.7-1.7,2.1-3.6,4-5.8
                c2-2.2,4.2-4.3,6.8-6.3c2.6-2.1,5.2-3.8,7.9-5.1c2.7-1.3,5.1-2,7.3-2c0.8,0,1.5,0.1,2.2,0.3c1.2,0.4,2.1,1.1,2.5,2.1
                s0.7,1.9,0.7,2.9c0,0.9-0.2,1.8-0.4,2.7c-0.3,0.9-0.7,1.6-1.1,2.3c-1.3,2-3.2,3.7-5.6,5.2s-4.9,2.7-7.4,3.6s-4.5,1.4-6.1,1.5
                h-0.2c-0.9,0-1.4-0.3-1.4-0.9c0-0.4,0.3-0.5,0.9-0.5c1.7-0.1,3.9-1,6.6-2.4c2.6-1.5,5-3,7-4.6c0.9-0.7,1.9-1.7,3.1-3
                s1.8-2.6,1.8-3.8c0-1.3-0.6-2-1.8-2c-0.7,0-1.3,0.2-2,0.4c-0.7,0.3-1.2,0.5-1.7,0.7c-2.1,1-4.4,2.6-7,4.7
                c-2.5,2.1-4.8,4.5-6.9,7.2c-2.1,2.6-3.5,5.3-4.3,8c-0.2,0.6-0.4,1.1-0.4,1.7s-0.1,1.1-0.1,1.6c0,1.7,0.6,3,1.7,3.7
                s2.5,1.1,4.1,1.1c2.4,0,4.8-0.5,7.4-1.6s5-2.4,7.4-4.1s4.6-3.5,6.6-5.4s3.7-3.8,5-5.6c0.2-0.3,0.5-0.5,0.8-0.5s0.5,0,0.5,0.2
                c0.3,0.1,0.4,0.3,0.4,0.6c0,0.3-0.1,0.6-0.2,0.9c-2,2.8-4.5,5.6-7.3,8.2c-2.9,2.7-6,4.9-9.4,6.7
                C273.5,362.7,269.9,363.6,266.2,363.6z"/>
                <path className="L5" d="M292.2,367.7c-2.9,0-4.3-0.8-4.3-2.4c0-1.2,0.6-2.3,1.8-3.6c0.9-0.9,2-1.7,3.2-2.3c1.2-0.6,1.9-0.9,2.2-0.9
                c0.4,0,0.6,0.2,0.6,0.4c0,0.3-0.1,0.5-0.5,0.7c-0.7,0.4-1.5,1-2.4,1.8s-1.4,1.6-1.4,2.4c0,1.2,0.7,1.7,2.1,1.7
                c1.7,0,3.4-0.5,5.2-1.5s3.5-2.2,5-3.7s2.8-3.1,3.8-4.6s1.5-2.9,1.5-4.1c0-0.9-0.3-1.8-1-2.6c-0.7-0.8-2-1.7-4-2.8
                c-1.4-0.8-2.7-1.6-4-2.5s-2.2-1.9-2.9-3.2c-0.6,1-1.3,2.2-2.2,3.6c-0.9,1.4-2,2.9-3.2,4.4c-0.4,0.4-0.9,0.7-1.3,0.7
                s-0.7-0.2-0.7-0.5c0-0.2,0.2-0.6,0.5-1.1c2-2.3,3.4-4.5,4.3-6.4s1.6-3.4,2-4.5c0.3-2.1,1.3-4.1,2.9-6c1.7-1.9,3.7-3.5,6.1-4.9
                s4.8-2.5,7.3-3.3s4.7-1.2,6.7-1.2s3.7,0.4,5.2,1.1s2.3,1.9,2.3,3.5c0,0.9-0.2,1.8-0.8,2.8c-0.7,1.4-1.7,2.6-3.3,3.7
                c-0.1,0.1-0.2,0.1-0.3,0.1c-0.6,0-0.9-0.2-0.9-0.8c0-0.4,0.2-0.7,0.5-1.1c0.6-0.5,1-1.1,1.4-1.8c0.4-0.7,0.5-1.4,0.5-2.1
                c0-1.3-0.8-2-2.3-2c-1.6,0-3.7,0.4-6.2,1.3s-4.9,2-7.1,3.4c-2.5,1.6-4.5,3.3-6.2,5.2s-2.5,3.5-2.5,5c0,0.7,0.2,1.4,0.7,2
                s1.4,1.3,2.8,2.1c0.7,0.4,1.7,1,3,1.7s2.4,1.3,3.4,1.9c3,1.8,4.5,3.7,4.5,5.8c0,1.7-0.7,3.3-2.2,5s-3.3,3.3-5.6,4.7
                s-4.7,2.5-7.2,3.4C296.8,367.3,294.4,367.7,292.2,367.7z"/>
                <path className="L5" d="M132.6,348.8c-1,2.4-6.7,6.6-12.7,8.9c-5.8,2.2-17.2,2.4-19.1,2.9c-0.5,0.1,0.6-0.1,0.4-0.5l2.2-0.7
                c4.2-0.8,12.1-1.7,14.7-2.6c3.1-1,5.9-2.8,6.8-3.4c3.5-2.7,4.5-3.9,4.8-4.3"/>
                </g>
                </g>
                </g>
            </svg>
        );
        
                const HeaderLogoSVG = ({ width = 160, style = {} }) => (
            <svg viewBox="0 0 376 150.7" width={width} style={{display:'block', ...style}} xmlns="http://www.w3.org/2000/svg">
                <style>{`.H0{fill:#6C6B6B;}.H1{display:none;}.H2{display:inline;}.H3{fill:#B51385;}.H4{fill:#9E55D8;}`}</style>
                <g>
                <g>
                <g>
                <path className="H0" d="M52.3,53.8h-7.7V18.9h-0.1l-2.8,6.8L26.2,54.5H26l-15.5-29l-2.7-6.6H7.7v34.9H0V2.2h6.6l17,32.1l2.5,6.1h0.1
                l2.5-6.1L45.8,2.2h6.4L52.3,53.8L52.3,53.8z"/>
                <path className="H0" d="M113.2,53.8h-8.3l-5.4-12l0.4-0.7H72.3l0.4,0.7l-5.4,12H59L82.4,2.2h7.5L113.2,53.8z M96.3,34.1l-0.8-0.8
                l-7.9-17.5l-1.5-4.7H86l-1.5,4.6l-8,17.6l-0.8,0.8H96.3L96.3,34.1z"/>
                <path className="H0" d="M166,53.8h-8.5l-6.7-13.6c-2.4-4.8-5.9-7-12.4-7h-11.6l0.8,0.7v20h-7.7V2.3h23.4c9.8,0,18.2,5.1,18.2,15.5
                c0,6.3-4.5,11.2-9.7,13v0.1c2.1,0.9,4.5,3.1,6,6.2L166,53.8z M143.3,9.3h-16.5l0.8,0.8v15.2l-0.8,0.8h15.9c7.1,0,11-3.6,11-8.4
                C153.6,11.6,149.4,9.3,143.3,9.3z"/>
                <path className="H0" d="M180.1,53.8h-7.7V2.2h7.7V53.8z"/>
                <path className="H0" d="M235.8,53.8H229l-25.9-33.4l-3.6-5.9h-0.1v39.3h-7.7V2.2h6.8l26,33.5l3.4,5.8h0.1V2.2h7.7L235.8,53.8
                L235.8,53.8z"/>
                <path className="H0" d="M296.8,53.8h-8.3l-5.4-12l0.4-0.7H256l0.4,0.7l-5.4,12h-8.3l23.4-51.6h7.5L296.8,53.8z M279.9,34.1l-0.8-0.8
                l-7.9-17.5l-1.5-4.7h-0.1l-1.5,4.6l-8,17.6l-0.8,0.8H279.9L279.9,34.1z"/>
                </g>
                </g>
                <g className="H1">
                <g className="H2">
                <path className="H3" d="M172.5-71.8c-2.7-1.8-3.6-3.8-3.8-6.6c0-0.5,0-1.1-0.1-1.7c-1.5-11.9-10.7-22.9-26.2-19.5
                c-3.1,0.7-5,0-6.9-1.9c-3.4-3.5-7.8-5.2-12.5-6.2c-5.6-1.2-10.7,0-15.2,3.5c-2.5,2-4.9,4.2-6.3,7c-1,1.9-2.3,2.4-4.2,2.5
                c-4.7,0.2-9.2,1.3-13.4,3.8c-7.3,4.5-11.4,12-9.6,20.4c1,4.5-0.2,7.4-2.9,11c-8.3,10.8-7.3,24.1,5.3,32.1c2,1.2,3.1,2.5,2.9,4.8
                c-0.1,0.8,0,1.7,0.1,2.5C81.2-8.3,90.1,3.3,106.1-0.4c3-0.7,4.7,0.1,6.5,1.9c4.6,4.5,10.2,6.4,15.3,6.7c8.1,0,14.3-3.3,18.3-10
                c1.6-2.6,3.3-3.8,6.2-3.6c1.2,0.1,2.5-0.2,3.7-0.5c12.6-2.1,20.4-12.9,17.8-25.3c-0.7-3.3-0.2-5.5,2-7.7c0.5-0.5,0.9-1,1.3-1.6
                C185.4-51.8,184-64.1,172.5-71.8z M133.4-90.1c4.3-4.1,13.8-4.7,19-1.6c4.5,2.8,7.4,6.5,8.5,11.7c0.3,1.4,1.1,3.1-0.6,4.1
                c-1.3,0.8-4.2-0.3-5.2-1.9c-1.5-2.4-3.4-4.3-6-5.6c-2.1-1.1-4.4-1.6-6.9-1.4c-0.5,0-1.1-0.2-1.6,0c-3.9,1.7-5.3-1.8-7.5-3.6
                C132.6-88.9,132.8-89.5,133.4-90.1z M121.6-68.5c-0.8,2.4-0.5,4.9-1.1,7.3c-0.3,1.1-0.4,2-1.3,2.8c-2.1,1.6-2.1,1.8-3.6-0.6
                c-1.2-1.8-2.4-3.7-3.3-5.7c-3-6.6,1-15.9,7.8-18.5c3.8-1.4,7.2-0.1,11.4,1.6C126.4-78,123.3-73.9,121.6-68.5z M144.7-76.5
                c3.6,1.9,5.6,5,6.6,8.9c-0.5,0.1-0.8,0.2-1,0.2c-7.9-1.1-14.6,1.3-20.4,6.7c-0.7,0.6-1.2,1.5-2.4,1.4c-2.8-0.2-3.7-1.1-3-3.9
                c0.6-2.4,1.6-4.6,2.4-7C129-76.5,140.1-78.9,144.7-76.5z M116.9-42.6c-2.4,2.2-5.4,3.5-8.3,4.9c-5.6,2.6-12-0.5-15.8-5
                c-3.2-3.9-3.5-8.2-0.2-14.3c3.4,4.5,7.2,7.8,12.3,9.4c2,0.6,4,1.1,6.1,1C113.9-46.8,115.9-45.7,116.9-42.6z M112.5-34.8
                c2.4-1.2,4.4-2.8,6.2-4.7c1.7-1.9,3.3-0.5,4.9-0.3c0.7,0.1,0.6,1.1,0.4,1.8c-0.8,2.6-1.3,5.4-2.3,7.9c-2.6,6.1-11.8,9.6-17.8,7
                c-3.8-1.7-5.7-4.9-7.2-9.4C102.7-31.6,107.7-32.3,112.5-34.8z M126.7-31.2c0.7-2.4,1.1-4.9,1-7.4c-0.1-2.4,1.8-2.9,3.2-3.8
                c0.7-0.5,1.2,0.3,1.6,0.9c1.6,2.5,3.2,5.2,4.2,8c1.8,5,0,9.3-3.2,13c-4.7,5.4-8.8,5.9-16.5,2.3C121.9-21.7,125.1-25.8,126.7-31.2
                z M131.4-57.2c2.3-2.2,5.4-3.5,8.3-4.9c7.3-3.5,15.8,2.8,17.8,7.9c1.5,3.9,0.4,7.5-1.7,11.6c-3.5-5-7.5-8.2-12.7-9.8
                c-1.7-0.5-3.4-1.1-5.2-0.9C134.8-52.9,132.6-54,131.4-57.2z M102.2-85.2c1.5-4.7,3.2-9.3,7.2-12.3c2.9-2.2,6.7-2.5,10.3-2.5
                c4.7,0,8.8,1.9,12.2,5.3c-2,3.1-4.1,3.8-7.3,3.2c-5.6-1-10.3,1-13.7,5.7c-0.7,1-1.1,2.4-2.7,2.4c-1.8,0-3.6,0.1-5.4-0.1
                C102-83.6,102-84.5,102.2-85.2z M106.7-77.1c-0.1,2.5-0.8,4.9-0.3,7.4c0.9,5.3,3,10,6.8,13.9c0.6,0.7,1.5,1.1,1.7,2.3
                c0.2,2.9-1,4-3.9,3.3c-2.1-0.5-4.2-1.3-6.2-2c-6.1-2-8.1-8.8-7.8-15C97.2-71.9,100.5-75.4,106.7-77.1z M80.5-74.1
                c1.8-6.1,6.2-10.7,12.8-12.4c0.4-0.1,0.8-0.2,1.2-0.2c1.3-0.2,2.7-1.1,3.8,0.3c0.7,0.9-0.5,4.8-1.6,5.5
                c-5.9,3.6-8.1,8.8-7.1,15.5c0.3,1.9-0.2,3.1-1.6,4.3c-1,0.9-1.8,2-3,3.4C81.3-63.1,78.8-68.4,80.5-74.1z M74.6-40.4
                c-1.3-5.3-0.4-10.1,2.5-14.6c0.7-1.1,1.4-3,3-2.1c1.4,0.8,3.1,2,2.8,4.4c-0.4,2.1-1,4.3-0.5,6.7c0.8,3.5,2.1,6.7,5.2,8.6
                c3.5,2.1,2.9,5.2,2.8,8.4c0,0.9-0.6,1.1-1.4,1.1C83-28.2,76-34.5,74.6-40.4z M101.8-5.8c-4.7-0.2-8-3.5-11-6.7
                c-2.1-2.3-3-5.2-3.6-8.3c-0.2-1-0.6-2.2,0.5-3.1c0.7-0.6,4.4,0,5,0.8c0.4,0.5,0.7,1.2,1.1,1.7c3.2,4.5,7.5,7.1,13.1,6.2
                c3.3-0.5,5.5,0.5,7.5,2.9c0.4,0.5,1.2,0.8,2.3,1.5C111.5-7.3,106.9-5.6,101.8-5.8z M134.7-0.5c-7,1.8-13,0.5-18.3-4.7
                c2-3,4.3-3.6,7.4-3c5.3,1.1,10.2-0.6,13-5.2c2.3-3.5,5.4-2.5,8.3-2.9c1-0.1,1,0.8,1,1.5C146.1-9.6,139.8-1.9,134.7-0.5z
                M141.5-22.6c1-5.7,0.3-10.8-2.1-15.6c-1.2-2.3-2.8-4.1-4.4-5.9c-0.9-1-1.5-1.8-1.2-3.2c0.5-2.5,0.7-2.7,3.3-2.1
                c2,0.4,4,0.9,6,1.6c6.8,2.4,10.8,11.8,7.9,18.5C149.7-26.6,146.5-24.1,141.5-22.6z M168-25.1c-3,6.3-7.4,10.9-14.5,12.2
                c-1.1,0.2-2.8,0.9-3.2-0.7c-0.3-1.5-0.8-3.3,0.6-4.7c0.7-0.7,1.6-1.1,2.4-1.6c4.4-3.3,6.6-7.8,5.8-13.3c-0.4-2.6-0.2-4.5,2-6
                c0.9-0.6,1.2-1.8,2.9-2.4c2.9,4.2,4.3,8.7,4.5,13.6C168.5-27,168.4-26,168-25.1z M171-44.4c-0.7,1-1.4,2.6-2.7,1.8
                s-2.8-1.9-2.9-3.7c0-0.7,0.4-1.3,0.5-2c0.9-5.9-0.5-10.9-5.6-14.6c-2.4-1.7-3.3-4.9-2.4-7.6c0.5-1.6,1.7-1.1,2.7-0.9
                c8.7,1.9,13.8,8.1,13.8,18C174.3-50.8,173-47.5,171-44.4z"/>
                <path className="H3" d="M71.8-24.7c-1.7-0.1-2.8,0.8-3,2.6c-0.2,1.9,1.3,3.7,3,3.7c1.6,0,3-1.5,3.1-3.2S73.7-24.6,71.8-24.7z"/>
                <path className="H3" d="M96.1-99.2c1.6,0,2.9-1.4,3-3.3c0-1.7-1-2.9-2.7-2.9c-1.8-0.1-3.6,1.6-3.6,3.2
                C92.8-100.6,94.4-99.1,96.1-99.2z"/>
                <path className="H3" d="M140.9-103.9c1.8,0.1,3.5-1.1,3.6-2.6c0.2-1.7-1.5-3.4-3.3-3.5c-1.7-0.1-2.9,1-3,2.7
                C138-105.5,139.2-104,140.9-103.9z"/>
                <path className="H3" d="M177.1-75c1.6-0.1,2.7-1.3,2.6-3.1c-0.1-1.7-1.6-3.3-3.1-3.3c-1.6,0-3,1.6-3.1,3.3
                C173.5-76.3,175.1-74.9,177.1-75z"/>
                <path className="H3" d="M67.4-64c1.7-0.2,2.9-1.4,2.8-2.9c0-1.8-1.5-3.4-3.1-3.3c-1.6,0.1-3,1.7-3.1,3.4
                C64.1-65.1,65.5-63.8,67.4-64z"/>
                <path className="H3" d="M152.3-0.6c-1.7,0-3.1,1.8-2.9,3.7c0.1,1.6,1.5,2.6,3.1,2.5c1.7-0.2,3.2-1.7,3.2-3.2
                C155.6,0.8,153.9-0.7,152.3-0.6z"/>
                <path className="H3" d="M107.5,4.1c-1.8-0.1-3.7,1.5-3.7,3s1.7,2.9,3.3,3c1.7,0.1,2.9-1,3-2.6C110.3,5.7,109.1,4.2,107.5,4.1z"/>
                <path className="H3" d="M181.5-35.8c-1.9-0.1-3.3,1.1-3.4,2.8c0,1.8,1.3,3.5,2.9,3.5c1.5,0,3-1.6,3.1-3.3
                C184.3-34.5,183.2-35.7,181.5-35.8z"/>
                </g>
                </g>
                </g>
                <g>
                <g>
                <path className="H4" d="M80.5,150.7c-0.9,0-1.3-0.4-1.3-1.1c0-0.3,0.1-0.7,0.3-1.2c0.9-1.9,2.1-4.7,3.7-8.4c1.6-3.7,3.3-8,5.3-12.8
                c1.9-4.8,3.8-9.8,5.8-14.8c1.7-4.5,3.4-8.9,5-13.1s3-8.1,4.1-11.6s1.6-6.1,1.6-8c0-0.6,0.4-0.9,1.2-1c0.8-0.1,1.5-0.2,2.3-0.2
                c2.4,0,3.6,0.8,3.6,2.4c0,1.3-0.7,3-2.2,5.1c-1.3,2.1-2.4,4.2-3.4,6.5s-1.9,4.5-2.8,6.8c1.7-2.3,3.4-4.6,4.9-6.8
                c1.5-2.2,3.3-4.2,5.3-5.8c1.6-1.2,3.2-2.2,4.7-3s3.2-1.1,5-1.1c1.9,0,3.8,0.5,5.6,1.4c1.8,0.9,3,2.3,3.3,4.3
                c0.1,0.2,0.1,0.5,0.1,0.7s0,0.5,0,0.7c0,2.5-0.7,5-2.2,7.4s-3.2,4.6-5.3,6.5c-2,1.9-3.9,3.4-5.6,4.6c-1.5,0.9-3.2,1.8-5.3,2.8
                s-4.2,1.9-6.5,2.6s-4.5,1.1-6.6,1.1c-1.3,0-2.4-0.2-3.3-0.4c-0.9,2.2-2,5-3.3,8.4s-2.4,6.8-3.5,10.2c-0.5,1.5-0.7,2.6-0.5,3.5
                s0,2-0.5,3.4c-0.4,1.5-0.9,2.8-1.4,4.2c-0.5,1.3-1.1,2.6-1.7,3.8c-0.1,0.3-0.6,0.7-1.4,1.2s-1.6,0.9-2.6,1.3
                C82.1,150.5,81.2,150.7,80.5,150.7z M98.8,112.4c2.3,0,4.7-0.5,7.3-1.6c2.5-1.1,5-2.5,7.5-4.3s4.7-3.8,6.7-5.9s3.6-4.2,4.8-6.2
                c1.5-2.3,2.2-4.5,2.2-6.4c0-2.2-1-3.4-2.9-3.4c-0.5,0-1.1,0.1-1.8,0.3c-0.7,0.2-1.6,0.5-2.5,1c-3.8,2-7,4.4-9.4,7.1
                c-2.5,2.7-4.6,5.7-6.3,9C102.5,105.1,100.7,108.6,98.8,112.4z"/>
                <path className="H4" d="M151.3,114.7c-1.3,0-2.5-0.3-3.5-0.9s-1.8-1.7-2.3-3.3c-0.1-0.2-0.1-0.4-0.2-0.7c0-0.2,0-0.5,0-0.8
                c0-1.5,0.3-3.3,1-5.4c0.7-2.2,1.5-4.3,2.4-6.3c-0.4,0.6-0.9,1.3-1.5,2.1s-1.4,1.9-2.5,3.2c-0.3,0.3-0.6,0.4-1,0.4
                c-0.5,0-0.8-0.3-0.8-0.9c0-0.4,0.1-0.8,0.4-1.1c1.9-2.4,3.6-4.5,5-6.4c1.5-1.9,2.6-3.5,3.3-4.8c0-0.1,0-0.1,0-0.2c0,0,0-0.1,0-0.2
                c0-0.2,0.1-0.5,0.3-1c0.6-1.7,1.2-3.2,1.8-4.4c0.6-1.2,1.3-1.9,2-2c0.1,0,0.3,0,0.4,0c0.1,0,0.3,0,0.4,0c0.8,0,1.5,0.2,2.2,0.5
                c0.7,0.4,1,0.9,1,1.6s-0.2,1.5-0.7,2.4s-1.1,2.1-1.8,3.5c-1.6,3.3-3,6.3-4.3,9.1c-1.3,2.7-2,4.9-2.1,6.7c-0.1,0.3-0.1,0.6-0.1,0.8
                s0,0.5,0,0.8c0,2.9,0.9,4.3,2.8,4.3c1.2,0,2.6-0.6,4.5-1.9s3.7-2.8,5.5-4.7c1.9-1.8,3.6-3.6,5.2-5.3s2.6-3,3.2-3.8
                c0.2-0.2,0.4-0.3,0.7-0.3s0.5,0.1,0.7,0.3c0.2,0.2,0.2,0.5,0,0.9c-0.7,1.2-1.8,2.8-3.3,4.6c-1.6,1.8-3.3,3.7-5.2,5.5
                s-3.8,3.4-5.6,4.7c-0.9,0.7-2.1,1.4-3.5,1.9C154.1,114.4,152.7,114.7,151.3,114.7z M163.1,75.8c-0.9,0-1.9-0.1-2.9-0.3
                s-1.5-0.8-1.5-2c0-0.2,0.5-0.7,1.5-1.5s2-1.6,3-2.4s1.7-1.3,1.9-1.5c1.2-1,2-1.5,2.3-1.5c0.4,0,0.4,0.5,0,1.4s-0.5,1.8-0.5,2.5
                c0,0.4-0.2,1-0.7,1.8c-0.4,0.9-0.9,1.7-1.5,2.4S163.5,75.8,163.1,75.8z"/>
                <path className="H4" d="M184.6,114.7c-3,0-5.2-0.8-6.3-2.3s-1.8-3.4-1.8-5.6c0-2.1,0.5-4.7,1.5-7.9c1-3.2,2.3-6.6,3.8-10.3
                c1.6-3.7,3.3-7.4,5.2-11c1.8-3.7,3.7-7,5.5-10.1s3.5-5.5,4.8-7.4c1.4-1.8,2.9-3.6,4.5-5.4s3.4-3.3,5.3-4.6c2-1.2,4.2-1.9,6.6-1.9
                c1.7,0,3.1,0.5,4.3,1.4s1.8,2.3,1.8,4.1c0,0.7-0.1,1.6-0.4,2.5s-0.7,1.9-1.2,2.9c-4.4,7.7-9.7,14.8-15.8,21.3S189.8,92.9,183,98.5
                c-0.3,1.1-0.6,2.1-0.8,2.9s-0.5,1.6-0.6,2.1c-0.1,0.4-0.1,0.7-0.1,1.1s0,0.8,0,1.1c0,1.7,0.3,3.3,0.9,4.6s1.5,2,2.9,2
                c1.3,0,2.9-0.6,4.8-1.9c1.9-1.3,3.8-2.8,5.8-4.7c2-1.8,3.7-3.6,5.3-5.4c1.6-1.7,2.7-3.1,3.4-4c0.2-0.2,0.4-0.3,0.7-0.3
                s0.5,0.2,0.7,0.4c0.2,0.3,0.2,0.7,0,1.1c-0.7,1.2-1.9,2.8-3.5,4.6c-1.6,1.8-3.4,3.6-5.3,5.5c-2,1.8-3.8,3.5-5.6,4.8
                C189.2,113.9,186.9,114.7,184.6,114.7z M184.5,94c2.8-1.9,5.6-4.3,8.6-7.3s5.9-6.3,8.7-9.8s5.5-7.1,7.8-10.5
                c2.3-3.5,4.2-6.6,5.7-9.4c0.4-0.8,0.7-1.5,0.9-2.1s0.3-1.2,0.3-1.7c0-1.4-0.6-2.1-1.7-2.1c-1,0-2.3,0.5-3.8,1.6
                c-3.9,3-7.5,6.9-10.8,11.7c-3.3,4.7-6.3,9.7-8.9,14.9C188.6,84.5,186.4,89.4,184.5,94z"/>
                <path className="H4" d="M240.5,114.7c-1.2,0-2.4-0.3-3.4-0.9s-1.8-1.7-2.3-3.3c-0.2-0.7-0.3-1.5-0.3-2.7c0-1.6,0.2-3.4,0.7-5.3
                c0.4-2,0.9-3.6,1.4-5c-0.4,0.2-1,0.8-2,1.9s-2.2,2.5-3.6,4c-1.4,1.6-3,3.1-4.7,4.7s-3.5,2.8-5.3,3.8s-3.6,1.5-5.3,1.5
                c-1.2,0-2.4-0.3-3.7-1s-2.3-1.6-3.2-2.7c-1.1-1.5-1.6-2.9-1.6-4.5c0-2,0.7-4,2-6.1s3.1-4.1,5.2-6.1c2.1-2,4.4-3.8,6.8-5.4
                c2.4-1.6,4.7-3,7-4.1s4-1.9,5.4-2.2c1.5-0.4,3.1-0.7,4.9-0.7c1,0,2.1,0.1,3.2,0.4s2,0.7,2.7,1.2c0.6,0.3,1,0.7,1.4,1.2
                s0.5,1,0.5,1.6s-0.2,0.8-0.8,0.5c-0.6-0.9-1.4-1.4-2.3-1.7c-1-0.2-2-0.4-3-0.4c-2.9,0-6.1,0.9-9.5,2.8s-6.6,4.1-9.3,6.6
                c-0.9,0.7-2,2-3.5,3.8s-2.8,3.7-4.1,5.8s-1.8,4-1.8,5.8c0,0.9,0.2,1.8,0.8,2.5c0.3,0.5,0.8,0.8,1.4,0.8c1,0,2.4-0.5,4.1-1.6
                c1.7-1.1,3.5-2.4,5.3-4s3.5-3.1,4.9-4.5c1.5-1.5,2.5-2.5,3.2-3.2c0.4-0.4,1.1-1.1,2.1-2.2s2.2-2.3,3.4-3.6
                c1.2-1.3,2.3-2.4,3.3-3.4c1-0.9,1.6-1.4,1.9-1.4c0.4,0,1,0.1,1.8,0.3c0.8,0.2,1.5,0.5,2.1,0.8s0.7,0.8,0.3,1.4
                c-1.9,2.8-3.4,5.6-4.5,8.6s-1.8,5.4-2,7.1c-0.1,0.3-0.1,0.6-0.1,0.8s0,0.5,0,0.8c0,2.9,1,4.3,3,4.3c1.1,0,2.5-0.7,4.3-2
                s3.7-2.9,5.5-4.7c1.9-1.8,3.6-3.6,5.2-5.3c1.5-1.7,2.6-3,3.2-3.8c0.2-0.2,0.4-0.3,0.7-0.3c0.3,0,0.5,0.1,0.8,0.4
                c0.2,0.2,0.2,0.6,0,0.9c-0.8,1.3-2,2.9-3.5,4.7c-1.5,1.8-3.2,3.6-5.1,5.4s-3.7,3.4-5.5,4.7c-0.9,0.7-2.1,1.4-3.6,1.9
                C243.4,114.4,241.9,114.7,240.5,114.7z"/>
                <path className="H4" d="M271.8,114.7c-1.3,0-2.5-0.3-3.5-0.9s-1.8-1.7-2.3-3.3c-0.1-0.2-0.1-0.4-0.2-0.7c0-0.2,0-0.5,0-0.8
                c0-1.5,0.3-3.3,1-5.4s1.5-4.3,2.4-6.3c-0.4,0.6-0.9,1.3-1.5,2.1s-1.4,1.9-2.5,3.2c-0.3,0.3-0.6,0.4-1,0.4c-0.5,0-0.8-0.3-0.8-0.9
                c0-0.4,0.1-0.8,0.4-1.1c1.9-2.4,3.6-4.5,5-6.4c1.5-1.9,2.6-3.5,3.3-4.8c0-0.1,0.2-0.6,0.7-1.4c0.4-0.8,1-1.8,1.7-3.2
                c-0.6,0.1-1.1,0.1-1.5,0.2c-0.4,0-0.7,0-1,0c-0.5,0-0.9-0.2-1.3-0.7c-0.4-0.4-0.4-1-0.1-1.6c0.4-1,1.2-1.6,2.4-1.7
                c1.2-0.1,2.3-0.2,3.3-0.3c0.1-0.1,0.2-0.2,0.4-0.2c0.9-1.6,1.7-3.2,2.5-4.7s1.5-2.8,2-3.8s0.8-1.5,0.8-1.6
                c1.5-2.3,2.4-3.8,2.8-4.6s1-1.2,1.7-1.4c0.8-0.1,1.6,0,2.5,0.1c0.9,0.2,1.5,0.5,1.8,1c0.2,0.3,0.3,0.7,0.3,1.1
                c0,0.7-0.2,1.3-0.4,1.9c-0.3,0.6-0.6,1.1-0.9,1.5c-0.3,0.5-0.7,0.8-1.1,1c-0.5,0.2-0.9,0.6-1.2,1.4c-0.7,1.4-1.5,2.9-2.4,4.5
                s-1.8,3.1-2.7,4.6l1.3-0.1c1.7-0.1,3.4-0.3,4.9-0.5s3.3-0.3,5.4-0.2c0.4,0,0.7,0,1.1,0.2s0.6,0.3,0.6,0.5c0,0.3-0.9,0.7-2.8,1.2
                c-0.7,0.3-2.3,0.6-4.7,0.9c-2.4,0.3-4.9,0.6-7.4,0.9c-0.7,1.4-1.4,2.5-2,3.4s-1,1.6-1.2,2c-1.6,3.3-3,6.3-4.3,9.1
                c-1.3,2.7-2,4.9-2.1,6.7c-0.1,0.3-0.1,0.6-0.1,0.8s0,0.5,0,0.8c0,2.9,0.9,4.3,2.8,4.3c1.2,0,2.6-0.6,4.5-1.9s3.7-2.8,5.5-4.7
                c1.9-1.8,3.6-3.6,5.2-5.3s2.6-3,3.2-3.8c0.2-0.2,0.4-0.3,0.7-0.3c0.3,0,0.5,0.1,0.7,0.3c0.2,0.2,0.2,0.5,0,0.9
                c-0.7,1.2-1.8,2.8-3.3,4.6c-1.6,1.8-3.3,3.7-5.2,5.5c-1.9,1.8-3.8,3.4-5.6,4.7c-0.9,0.7-2.1,1.4-3.5,1.9
                C274.7,114.4,273.3,114.7,271.8,114.7z"/>
                <path className="H4" d="M308.1,115.2c-3.3,0-6.1-0.8-8.5-2.3s-3.6-3.8-3.6-7c0-1.7,0.5-3.7,1.5-6.1c0.7-1.7,2.1-3.6,4-5.8
                c2-2.2,4.2-4.3,6.8-6.3c2.6-2.1,5.2-3.8,7.9-5.1c2.7-1.3,5.1-2,7.3-2c0.8,0,1.5,0.1,2.2,0.3c1.2,0.4,2.1,1.1,2.5,2.1
                s0.7,1.9,0.7,2.9c0,0.9-0.2,1.8-0.4,2.7c-0.3,0.9-0.7,1.6-1.1,2.3c-1.3,2-3.2,3.7-5.6,5.2s-4.9,2.7-7.4,3.6s-4.5,1.4-6.1,1.5h-0.2
                c-0.9,0-1.4-0.3-1.4-0.9c0-0.4,0.3-0.5,0.9-0.5c1.7-0.1,3.9-1,6.6-2.4c2.6-1.5,5-3,7-4.6c0.9-0.7,1.9-1.7,3.1-3s1.8-2.6,1.8-3.8
                c0-1.3-0.6-2-1.8-2c-0.7,0-1.3,0.2-2,0.4c-0.7,0.3-1.2,0.5-1.7,0.7c-2.1,1-4.4,2.6-7,4.7c-2.5,2.1-4.8,4.5-6.9,7.2
                c-2.1,2.6-3.5,5.3-4.3,8c-0.2,0.6-0.4,1.1-0.4,1.7s-0.1,1.1-0.1,1.6c0,1.7,0.6,3,1.7,3.7s2.5,1.1,4.1,1.1c2.4,0,4.8-0.5,7.4-1.6
                s5-2.4,7.4-4.1s4.6-3.5,6.6-5.4s3.7-3.8,5-5.6c0.2-0.3,0.5-0.5,0.8-0.5s0.5,0,0.5,0.2c0.3,0.1,0.4,0.3,0.4,0.6
                c0,0.3-0.1,0.6-0.2,0.9c-2,2.8-4.5,5.6-7.3,8.2c-2.9,2.7-6,4.9-9.4,6.7C315.4,114.3,311.8,115.2,308.1,115.2z"/>
                <path className="H4" d="M341.2,119c-2.9,0-4.3-0.8-4.3-2.4c0-1.2,0.6-2.3,1.8-3.6c0.9-0.9,2-1.7,3.2-2.3c1.2-0.6,1.9-0.9,2.2-0.9
                c0.4,0,0.6,0.2,0.6,0.4c0,0.3-0.1,0.5-0.5,0.7c-0.7,0.4-1.5,1-2.4,1.8s-1.4,1.6-1.4,2.4c0,1.2,0.7,1.7,2.1,1.7
                c1.7,0,3.4-0.5,5.2-1.5s3.5-2.2,5-3.7s2.8-3.1,3.8-4.6s1.5-2.9,1.5-4.1c0-0.9-0.3-1.8-1-2.6c-0.7-0.8-2-1.7-4-2.8
                c-1.4-0.8-2.7-1.6-4-2.5s-2.2-1.9-2.9-3.2c-0.6,1-1.3,2.2-2.2,3.6c-0.9,1.4-2,2.9-3.2,4.4c-0.4,0.4-0.9,0.7-1.3,0.7
                s-0.7-0.2-0.7-0.5c0-0.2,0.2-0.6,0.5-1.1c2-2.3,3.4-4.5,4.3-6.4s1.6-3.4,2-4.5c0.3-2.1,1.3-4.1,2.9-6c1.7-1.9,3.7-3.5,6.1-4.9
                s4.8-2.5,7.3-3.3s4.7-1.2,6.7-1.2s3.7,0.4,5.2,1.1s2.3,1.9,2.3,3.5c0,0.9-0.2,1.8-0.8,2.8c-0.7,1.4-1.7,2.6-3.3,3.7
                c-0.1,0.1-0.2,0.1-0.3,0.1c-0.6,0-0.9-0.2-0.9-0.8c0-0.4,0.2-0.7,0.5-1.1c0.6-0.5,1-1.1,1.4-1.8c0.4-0.7,0.5-1.4,0.5-2.1
                c0-1.3-0.8-2-2.3-2c-1.6,0-3.7,0.4-6.2,1.3s-4.9,2-7.1,3.4c-2.5,1.6-4.5,3.3-6.2,5.2s-2.5,3.5-2.5,5c0,0.7,0.2,1.4,0.7,2
                s1.4,1.3,2.8,2.1c0.7,0.4,1.7,1,3,1.7s2.4,1.3,3.4,1.9c3,1.8,4.5,3.7,4.5,5.8c0,1.7-0.7,3.3-2.2,5s-3.3,3.3-5.6,4.7
                s-4.7,2.5-7.2,3.4C345.8,118.6,343.4,119,341.2,119z"/>
                </g>
                </g>
            </svg>
        );
        
        const FirebaseService = {
            // Inicializar datos de prueba si no existen
            async inicializarDatos() {
                try {
                    const testDoc = await db.collection('alumnos').doc('test').get();
                    if (!testDoc.exists) {
                        console.log('Inicializando datos de prueba...');
                        
                        // Alumnos de prueba
                        const alumnosPrueba = [
                            { id: '1', nombre: "Ailín", apellido: "Millas", email: "ailin.millas@gmail.com", abono: "2x_semana", clasesTotales: 8, clasesUsadas: 2, clasesPendientes: 0, horariosAsignados: ["Lunes-18:00", "Miércoles-19:00"], activo: true },
                            { id: '2', nombre: "Denise", apellido: "Ferdman", email: "denferd@gmail.com", abono: "3x_semana", clasesTotales: 12, clasesUsadas: 5, clasesPendientes: 1, horariosAsignados: ["Lunes-19:00", "Martes-08:00", "Jueves-09:00"], activo: true },
                            { id: '3', nombre: "Noelia", apellido: "Soria", email: "noeliaa.soriaa@gmail.com", abono: "1x_semana", clasesTotales: 4, clasesUsadas: 1, clasesPendientes: 0, horariosAsignados: ["Miércoles-18:00"], activo: true },
                            { id: '4', nombre: "Bettina", apellido: "Fernández", email: "bettinacefer@hotmail.com", abono: "4x_semana", clasesTotales: 16, clasesUsadas: 8, clasesPendientes: 0, horariosAsignados: ["Lunes-20:00", "Martes-19:00", "Miércoles-20:00", "Jueves-19:00"], activo: true },
                            { id: '5', nombre: "Paula", apellido: "Masquelet", email: "masqueletpaula@gmail.com", abono: "2x_semana", clasesTotales: 8, clasesUsadas: 3, clasesPendientes: 1, horariosAsignados: ["Martes-20:00", "Jueves-20:00"], activo: true },
                            { id: '6', nombre: "Sergio", apellido: "Azpeitia", email: "sergioazp@gmail.com", abono: "2x_semana", clasesTotales: 8, clasesUsadas: 0, clasesPendientes: 0, horariosAsignados: ["Lunes-18:00", "Viernes-19:00"], activo: true }
                        ];
                        
                        for (const alumno of alumnosPrueba) {
                            await db.collection('alumnos').doc(alumno.id).set(alumno);
                        }
                        
                        // Horarios
                        await db.collection('config').doc('horarios').set({
                            "Lunes": ["18:00", "19:00", "20:00"],
                            "Martes": ["08:00", "09:00", "18:00", "19:00", "20:00"],
                            "Miércoles": ["08:00", "09:00", "18:00", "19:00", "20:00"],
                            "Jueves": ["08:00", "09:00", "18:00", "19:00", "20:00"],
                            "Viernes": ["18:00", "19:00", "20:00"]
                        });
                        
                        // Precios - SOLO SI NO EXISTEN
                        const preciosDoc = await db.collection('config').doc('precios').get();
                        if (!preciosDoc.exists) {
                            await db.collection('config').doc('precios').set({
                                "1x_semana": 15000,
                                "2x_semana": 25000,
                                "3x_semana": 35000,
                                "4x_semana": 42000
                            });
                        }
                        
                        // Cancelaciones
                        await db.collection('cancelaciones').doc('1').set({
                            id: 1,
                            alumno: "Denise Ferdman",
                            dia: "Martes",
                            hora: "08:00",
                            fecha: "2025-02-18",
                            estado: "pendiente"
                        });
                        
                        await db.collection('cancelaciones').doc('2').set({
                            id: 2,
                            alumno: "Paula Masquelet",
                            dia: "Jueves",
                            hora: "20:00",
                            fecha: "2025-02-20",
                            estado: "pendiente"
                        });
                        
                        console.log('✅ Datos de prueba inicializados');
                    }
                } catch (error) {
                    console.error('Error al inicializar datos:', error);
                }
            },
            
            // Alumnos
            async obtenerAlumnos() {
                const snapshot = await db.collection('alumnos').get();
                return snapshot.docs.map(doc => ({ ...doc.data(), id: doc.id }));
            },
            
            async guardarAlumno(alumno) {
                if (alumno.id) {
                    // Obtener email anterior por si cambió
                    const docAnterior = await db.collection('alumnos').doc(alumno.id).get();
                    const emailAnterior = docAnterior.exists ? docAnterior.data().email : null;
                    
                    await db.collection('alumnos').doc(alumno.id).set(alumno);
                    
                    // Si el email cambió, actualizar alumnos_autorizados
                    if (emailAnterior && emailAnterior !== alumno.email) {
                        // Borrar el viejo
                        const viejoSnap = await db.collection('alumnos_autorizados').where('email', '==', emailAnterior).get();
                        viejoSnap.forEach(doc => doc.ref.delete());
                    }
                    
                    // Asegurar que el email actual esté en alumnos_autorizados
                    const existeSnap = await db.collection('alumnos_autorizados').where('email', '==', alumno.email).get();
                    if (existeSnap.empty) {
                        await db.collection('alumnos_autorizados').add({ email: alumno.email });
                    }
                } else {
                    const docRef = await db.collection('alumnos').add(alumno);
                    
                    // Agregar a alumnos_autorizados
                    const existeSnap = await db.collection('alumnos_autorizados').where('email', '==', alumno.email).get();
                    if (existeSnap.empty) {
                        await db.collection('alumnos_autorizados').add({ email: alumno.email });
                    }
                    
                    return docRef.id;
                }
            },
            
            async eliminarAlumno(alumnoId) {
                // Obtener email antes de borrar
                const alumnoDoc = await db.collection('alumnos').doc(alumnoId).get();
                const email = alumnoDoc.exists ? alumnoDoc.data().email : null;
                
                // Eliminar alumno
                await db.collection('alumnos').doc(alumnoId).delete();
                
                // Eliminar de alumnos_autorizados
                if (email) {
                    const autSnap = await db.collection('alumnos_autorizados').where('email', '==', email).get();
                    autSnap.forEach(doc => doc.ref.delete());
                }
                
                // Eliminar sus cancelaciones
                const cancelaciones = await db.collection('cancelacionesAlumno').where('alumnoId', '==', alumnoId).get();
                const batch = db.batch();
                cancelaciones.forEach(doc => batch.delete(doc.ref));
                await batch.commit();
            },
            
            // Horarios
            async obtenerHorarios() {
                const doc = await db.collection('config').doc('horarios').get();
                return doc.exists ? doc.data() : {};
            },
            
            async guardarHorarios(horarios) {
                await db.collection('config').doc('horarios').set(horarios);
            },
            
            // Precios
            async obtenerPrecios() {
                const doc = await db.collection('config').doc('precios').get();
                return doc.exists ? doc.data() : {};
            },
            
            async guardarPrecios(precios) {
                await db.collection('config').doc('precios').set(precios);
            },
            
            // Cancelaciones
            async obtenerCancelaciones() {
                const snapshot = await db.collection('cancelaciones').get();
                return snapshot.docs.map(doc => ({ ...doc.data(), id: doc.id }));
            },
            
            async guardarCancelacion(cancelacion) {
                if (cancelacion.id) {
                    await db.collection('cancelaciones').doc(cancelacion.id.toString()).set(cancelacion);
                } else {
                    const snapshot = await db.collection('cancelaciones').get();
                    const newId = snapshot.docs.length + 1;
                    await db.collection('cancelaciones').doc(newId.toString()).set({...cancelacion, id: newId});
                }
            },
            
            async eliminarCancelacion(id) {
                await db.collection('cancelaciones').doc(id.toString()).delete();
            },
            
            // Cancelaciones específicas por alumno/fecha
            async obtenerCancelacionesAlumno(alumnoId) {
                const snapshot = await db.collection('cancelacionesAlumno').where('alumnoId', '==', alumnoId).get();
                return snapshot.docs.map(doc => ({ ...doc.data(), id: doc.id }));
            },
            
            async obtenerTodasCancelacionesAlumno() {
                const snapshot = await db.collection('cancelacionesAlumno').get();
                return snapshot.docs.map(doc => ({ ...doc.data(), id: doc.id }));
            },
            
            async guardarCancelacionAlumno(cancelacionAlumno) {
                const docRef = await db.collection('cancelacionesAlumno').add({
                    ...cancelacionAlumno,
                    fechaCreacion: new Date().toISOString()
                });
                return docRef.id;
            },
            
            async eliminarCancelacionAlumno(id) {
                await db.collection('cancelacionesAlumno').doc(id).delete();
            },
            
            // Solicitudes
            async obtenerSolicitudes() {
                const snapshot = await db.collection('solicitudes').get();
                return snapshot.docs.map(doc => ({ ...doc.data(), id: doc.id }));
            },
            
            async guardarSolicitud(solicitud) {
                if (solicitud.id) {
                    // Actualizar documento existente
                    await db.collection('solicitudes').doc(solicitud.id.toString()).set(solicitud, { merge: true });
                } else {
                    // Crear nuevo documento
                    const newDoc = await db.collection('solicitudes').add(solicitud);
                    return newDoc.id;
                }
            },
            
            async eliminarSolicitud(id) {
                await db.collection('solicitudes').doc(id.toString()).delete();
            },
            
            // Recuperos (clases puntuales aprobadas)
            async obtenerRecuperos() {
                const snapshot = await db.collection('recuperos').get();
                return snapshot.docs.map(doc => ({ ...doc.data(), id: doc.id }));
            },
            
            async guardarRecupero(recupero) {
                const docRef = await db.collection('recuperos').add({
                    ...recupero,
                    fechaCreacion: new Date().toISOString()
                });
                return docRef.id;
            },
            
            async actualizarEstadoCancelacionAlumno(id, nuevoEstado) {
                await db.collection('cancelacionesAlumno').doc(id).update({ estado: nuevoEstado });
            },
            
            async resetearAlumno(alumnoId) {
                const batch = db.batch();
                
                // Borrar cancelacionesAlumno del alumno
                const cancelaciones = await db.collection('cancelacionesAlumno').where('alumnoId', '==', alumnoId).get();
                cancelaciones.docs.forEach(doc => batch.delete(doc.ref));
                
                // Borrar recuperos del alumno
                const recuperos = await db.collection('recuperos').where('alumnoId', '==', alumnoId).get();
                recuperos.docs.forEach(doc => batch.delete(doc.ref));
                
                // Borrar solicitudes del alumno
                const solicitudes = await db.collection('solicitudes').where('alumnoId', '==', alumnoId).get();
                solicitudes.docs.forEach(doc => batch.delete(doc.ref));
                
                await batch.commit();
                
                // Resetear contadores del alumno
                await db.collection('alumnos').doc(alumnoId).update({
                    clasesPendientes: 0,
                    clasesUsadas: 0
                });
            }
        };
        
        function App() {
            const [cargando, setCargando] = useState(true);
            const [userType, setUserType] = useState(null);
            const [usuarioActual, setUsuarioActual] = useState(null);
            const [authUser, setAuthUser] = useState(null);
            const [alumnos, setAlumnos] = useState([]);
            const [horarios, setHorarios] = useState({});
            const [precios, setPrecios] = useState({});
            const [cancelaciones, setCancelaciones] = useState([]);
            const [cancelacionesAlumno, setCancelacionesAlumno] = useState([]);
            const [solicitudes, setSolicitudes] = useState([]);
            const [recuperos, setRecuperos] = useState([]);
            
            // PASO 1: Detectar estado de autenticación (esto es lo ÚNICO que corre sin auth)
            useEffect(() => {
                const unsubscribe = firebase.auth().onAuthStateChanged((user) => {
                    console.log('🔑 Auth state changed:', user ? user.email : 'no user');
                    setAuthUser(user);
                    setCargando(false);
                });
                return () => unsubscribe();
            }, []);
            
            // PASO 2: Cuando hay usuario autenticado, arrancar TODOS los listeners
            useEffect(() => {
                if (!authUser) {
                    // Si no hay user, limpiar todo
                    setAlumnos([]);
                    setHorarios({});
                    setPrecios({});
                    setCancelaciones([]);
                    setCancelacionesAlumno([]);
                    setSolicitudes([]);
                    setRecuperos([]);
                    return;
                }
                
                console.log('📡 Usuario autenticado, iniciando listeners...');
                
                const unsubscribers = [];
                
                // Listener: Alumnos
                unsubscribers.push(
                    db.collection('alumnos').onSnapshot((snapshot) => {
                        const data = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                        console.log('📬 Alumnos actualizados:', data.length);
                        setAlumnos(data);
                    }, (error) => {
                        console.error('Error en listener de alumnos:', error);
                    })
                );
                
                // Listener: Solicitudes
                unsubscribers.push(
                    db.collection('solicitudes').onSnapshot((snapshot) => {
                        const data = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                        console.log('📬 Solicitudes actualizadas:', data.length);
                        setSolicitudes(data);
                    }, (error) => {
                        console.error('Error en listener de solicitudes:', error);
                    })
                );
                
                // Listener: Recuperos
                unsubscribers.push(
                    db.collection('recuperos').onSnapshot((snapshot) => {
                        const data = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                        console.log('📬 Recuperos actualizados:', data.length);
                        setRecuperos(data);
                    }, (error) => {
                        console.error('Error en listener de recuperos:', error);
                    })
                );
                
                // Listener: Precios
                unsubscribers.push(
                    db.collection('config').doc('precios').onSnapshot((doc) => {
                        if (doc.exists) {
                            console.log('📬 Precios actualizados');
                            setPrecios(doc.data());
                        }
                    }, (error) => {
                        console.error('Error en listener de precios:', error);
                    })
                );
                
                // Listener: Horarios
                unsubscribers.push(
                    db.collection('config').doc('horarios').onSnapshot((doc) => {
                        if (doc.exists) {
                            console.log('📬 Horarios actualizados');
                            setHorarios(doc.data());
                        }
                    }, (error) => {
                        console.error('Error en listener de horarios:', error);
                    })
                );
                
                // Listener: CancelacionesAlumno
                unsubscribers.push(
                    db.collection('cancelacionesAlumno').onSnapshot((snapshot) => {
                        const data = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                        console.log('📬 CancelacionesAlumno actualizadas:', data.length);
                        setCancelacionesAlumno(data);
                    }, (error) => {
                        console.error('Error en listener de cancelacionesAlumno:', error);
                    })
                );
                
                // Listener: Cancelaciones
                unsubscribers.push(
                    db.collection('cancelaciones').onSnapshot((snapshot) => {
                        const data = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                        setCancelaciones(data);
                    }, (error) => {
                        console.error('Error en listener de cancelaciones:', error);
                    })
                );
                
                // Cleanup: desuscribir todos los listeners
                return () => {
                    console.log('🔌 Limpiando todos los listeners');
                    unsubscribers.forEach(unsub => unsub());
                };
            }, [authUser]);
            
            // PASO 3: Cuando authUser cambia y tenemos alumnos, resolver vista
            // PASO 3: Resolver tipo de usuario según email
            useEffect(() => {
                if (!authUser) {
                    setUserType(null);
                    setUsuarioActual(null);
                    return;
                }
                
                const email = authUser.email;
                if (email === 'marinapilatesestudio@gmail.com') {
                    setUserType('admin');
                } else {
                    setUserType('alumno');
                    // Buscar perfil del alumno
                    const alumno = alumnos.find(a => a.email === email);
                    if (alumno) {
                        setUsuarioActual(alumno);
                    }
                }
            }, [authUser, alumnos]);
            
            // Actualizar usuarioActual cuando cambian los alumnos
            useEffect(() => {
                if (userType === 'alumno' && usuarioActual) {
                    const alumnoActualizado = alumnos.find(a => a.email === usuarioActual.email);
                    if (alumnoActualizado) {
                        setUsuarioActual(alumnoActualizado);
                    }
                }
            }, [alumnos]);
            
            const cargarDatos = async () => {
                try {
                    const [horariosData, preciosData, cancelacionesData, solicitudesData, recuperosData] = await Promise.all([
                        FirebaseService.obtenerHorarios(),
                        FirebaseService.obtenerPrecios(),
                        FirebaseService.obtenerCancelaciones(),
                        FirebaseService.obtenerSolicitudes(),
                        FirebaseService.obtenerRecuperos()
                    ]);
                    setHorarios(horariosData);
                    setPrecios(preciosData);
                    setCancelaciones(cancelacionesData);
                    setSolicitudes(solicitudesData);
                    setRecuperos(recuperosData);
                } catch (error) {
                    console.error('Error al cargar datos:', error);
                }
            };
            
            const handleLogin = async (tipo, email) => {
                // PASO 3 se encarga de setear userType y vista via authUser
                // Este handler solo es fallback por si onAuthStateChanged no alcanza
                setUserType(tipo);
            };
            
            const handleLogout = () => {
                firebase.auth().signOut();
                setUserType(null);
                setUsuarioActual(null);
            };
            
            // ── RENDERIZADO basado en estado de auth ──
            
            if (cargando) {
                return (
                    <div className="container">
                        <div className="loading">
                            <LogoSVG width={200} style={{margin: '0 auto'}} />
                            <p>Cargando...</p>
                            <div className="spinner"></div>
                        </div>
                    </div>
                );
            }
            
            // Sin usuario autenticado → Login
            if (!authUser) {
                return <LoginScreen onLogin={handleLogin} alumnos={alumnos} />;
            }
            
            // Admin autenticado
            if (userType === 'admin') {
                return <AdminDashboard 
                    alumnos={alumnos} 
                    setAlumnos={setAlumnos}
                    horarios={horarios}
                    setHorarios={setHorarios}
                    precios={precios}
                    setPrecios={setPrecios}
                    cancelaciones={cancelaciones}
                    setCancelaciones={setCancelaciones}
                    cancelacionesAlumno={cancelacionesAlumno}
                    solicitudes={solicitudes}
                    setSolicitudes={setSolicitudes}
                    recuperos={recuperos}
                    onLogout={handleLogout}
                    recargarDatos={cargarDatos}
                />;
            }
            
            // Alumno autenticado con datos cargados
            if (userType === 'alumno' && usuarioActual) {
                return <AlumnoDashboard 
                    alumno={usuarioActual}
                    alumnos={alumnos}
                    horarios={horarios}
                    precios={precios}
                    cancelaciones={cancelaciones}
                    setCancelaciones={setCancelaciones}
                    cancelacionesAlumno={cancelacionesAlumno}
                    setCancelacionesAlumno={setCancelacionesAlumno}
                    solicitudes={solicitudes}
                    recuperos={recuperos}
                    onLogout={handleLogout}
                    recargarDatos={cargarDatos}
                />;
            }
            
            // Estado transitorio: autenticado pero resolviendo tipo/datos
            return (
                <div className="container">
                    <div className="loading">
                        <LogoSVG width={200} style={{margin: '0 auto'}} />
                        <p>Cargando datos...</p>
                        <div className="spinner"></div>
                    </div>
                </div>
            );
        }
        
        function LoginScreen({ onLogin, alumnos }) {
            const [email, setEmail] = useState('');
            const [password, setPassword] = useState('');
            const [error, setError] = useState('');
            const [exito, setExito] = useState('');
            const [cargando, setCargando] = useState(false);
            const [vista, setVista] = useState('login'); // 'login', 'resetPassword', 'activarCuenta'
            const [resetEmail, setResetEmail] = useState('');
            const [activarEmail, setActivarEmail] = useState('');
            const [mostrarPassword, setMostrarPassword] = useState(false);
            
            const handleLogin = async (e) => {
                e.preventDefault();
                setError('');
                setCargando(true);
                
                try {
                    const resultado = await firebase.auth().signInWithEmailAndPassword(email, password);
                    const usuarioFirebase = resultado.user;
                    
                    let userType = 'alumno';
                    if (email === 'marinapilatesestudio@gmail.com') {
                        userType = 'admin';
                    }
                    
                    // Si es alumno, marcar como activo en el primer login
                    if (userType === 'alumno') {
                        try {
                            const alumnoSnap = await db.collection('alumnos').where('email', '==', email).get();
                            if (!alumnoSnap.empty) {
                                const alumnoDoc = alumnoSnap.docs[0];
                                if (!alumnoDoc.data().activo) {
                                    await alumnoDoc.ref.update({ activo: true });
                                    console.log('✅ Alumno marcado como activo en primer login');
                                }
                            }
                        } catch (err) {
                            console.error('Error al marcar activo:', err);
                        }
                    }
                    
                    onLogin(userType, email);
                } catch (error) {
                    console.error('Error en login:', error.code, error.message);
                    if (error.code === 'auth/user-not-found') {
                        setError('Email no registrado. Si es tu primer ingreso, activá tu cuenta primero.');
                    } else if (error.code === 'auth/wrong-password' || error.code === 'auth/invalid-credential') {
                        setError('Contraseña incorrecta');
                    } else if (error.code === 'auth/invalid-email') {
                        setError('Email inválido');
                    } else {
                        setError('Error al iniciar sesión. Intentá de nuevo.');
                    }
                }
                setCargando(false);
            };
            
            const handleActivarCuenta = async (e) => {
                e.preventDefault();
                setError('');
                setExito('');
                setCargando(true);
                
                const emailNormalizado = activarEmail.trim().toLowerCase();
                
                try {
                    // 1. Verificar que el email esté en alumnos_autorizados (colección pública de solo lectura)
                    const autorizadoSnap = await db.collection('alumnos_autorizados').where('email', '==', emailNormalizado).get();
                    
                    if (autorizadoSnap.empty) {
                        setError('❌ Este email no está autorizado. Contactá a Marina Pilates para que te registre.');
                        setCargando(false);
                        return;
                    }
                    
                    // 2. Crear usuario temporal en Firebase Auth con contraseña random
                    const passwordTemporal = crypto.randomUUID() + 'Aa1!';
                    let userCredential;
                    try {
                        userCredential = await firebase.auth().createUserWithEmailAndPassword(emailNormalizado, passwordTemporal);
                    } catch (createError) {
                        if (createError.code === 'auth/email-already-in-use') {
                            // El usuario ya existe en Auth, enviar reset directamente
                            await firebase.auth().sendPasswordResetEmail(emailNormalizado);
                            setExito('📧 Ya tenés una cuenta creada. Te reenviamos el email para que definas tu contraseña. Revisá tu bandeja de entrada y spam.');
                            setCargando(false);
                            return;
                        }
                        throw createError;
                    }
                    
                    // 3. Enviar email de reseteo de contraseña
                    await firebase.auth().sendPasswordResetEmail(emailNormalizado);
                    
                    // 4. Cerrar la sesión temporal
                    await firebase.auth().signOut();
                    
                    setExito('📧 ¡Listo! Te enviamos un email a ' + emailNormalizado + ' para que definas tu contraseña. Revisá tu bandeja de entrada y la carpeta de spam.');
                    
                } catch (error) {
                    console.error('Error al activar cuenta:', error);
                    if (error.code === 'auth/invalid-email') {
                        setError('El email ingresado no es válido.');
                    } else {
                        setError('Error al activar la cuenta. Intentá de nuevo o contactá a Marina Pilates.');
                    }
                }
                setCargando(false);
            };
            
            const handleResetPassword = async (e) => {
                e.preventDefault();
                setError('');
                setExito('');
                setCargando(true);
                
                try {
                    await firebase.auth().sendPasswordResetEmail(resetEmail.trim().toLowerCase());
                    setExito('📧 Email de recuperación enviado. Revisá tu bandeja de entrada o la carpeta de spam.');
                } catch (error) {
                    console.error('Error al resetear:', error);
                    if (error.code === 'auth/user-not-found') {
                        setError('Este email no tiene cuenta activa. ¿Necesitás activar tu cuenta?');
                    } else {
                        setError('Error: ' + error.message);
                    }
                }
                setCargando(false);
            };
            
            // ── Vista: Recuperar Contraseña ──
            if (vista === 'resetPassword') {
                return (
                    <div style={{maxWidth: '400px', margin: '50px auto', background: 'white', padding: '40px', borderRadius: '12px', boxShadow: '0 10px 30px rgba(0,0,0,0.2)'}}>
                        <div style={{textAlign: 'center', marginBottom: '20px'}}>
                            <svg width="50" height="50" viewBox="0 0 100 100" style={{margin: '0 auto'}}>
                                <circle cx="50" cy="50" r="48" fill="#667eea" opacity="0.1" stroke="#667eea" strokeWidth="2"/>
                                <text x="50" y="65" fontSize="50" fontWeight="bold" textAnchor="middle" fill="#667eea" fontFamily="Arial">M</text>
                            </svg>
                        </div>
                        <h2 style={{textAlign: 'center', marginBottom: '30px', color: '#667eea'}}>
                            Recuperar Contraseña
                        </h2>
                        
                        {error && <div className="alert alert-danger">{error}</div>}
                        {exito && <div className="alert alert-success">{exito}</div>}
                        
                        {!exito && (
                            <form onSubmit={handleResetPassword}>
                                <div className="form-group">
                                    <label>Email</label>
                                    <input 
                                        type="email"
                                        value={resetEmail}
                                        onChange={(e) => setResetEmail(e.target.value)}
                                        placeholder="tu@email.com"
                                        required
                                    />
                                </div>
                                
                                <button type="submit" className="btn btn-primary" style={{width: '100%'}} disabled={cargando}>
                                    {cargando ? '⏳ Enviando...' : 'Enviar Link de Recuperación'}
                                </button>
                            </form>
                        )}
                        
                        <button 
                            onClick={() => { setVista('login'); setError(''); setExito(''); setResetEmail(''); }}
                            className="btn btn-secondary" 
                            style={{width: '100%', marginTop: '10px'}}
                        >
                            Volver al Login
                        </button>
                    </div>
                );
            }
            
            // ── Vista: Activar Cuenta ──
            if (vista === 'activarCuenta') {
                return (
                    <div style={{maxWidth: '400px', margin: '50px auto', background: 'white', padding: '40px', borderRadius: '12px', boxShadow: '0 10px 30px rgba(0,0,0,0.2)'}}>
                        <div style={{textAlign: 'center', marginBottom: '20px'}}>
                            <svg width="50" height="50" viewBox="0 0 100 100" style={{margin: '0 auto'}}>
                                <circle cx="50" cy="50" r="48" fill="#667eea" opacity="0.1" stroke="#667eea" strokeWidth="2"/>
                                <text x="50" y="65" fontSize="50" fontWeight="bold" textAnchor="middle" fill="#667eea" fontFamily="Arial">M</text>
                            </svg>
                        </div>
                        <h2 style={{textAlign: 'center', marginBottom: '20px', color: '#667eea'}}>
                            Activar mi Cuenta
                        </h2>
                        
                        <div style={{marginBottom: '20px', padding: '12px', background: '#d1ecf1', borderRadius: '8px', fontSize: '0.85rem', color: '#0c5460', lineHeight: '1.5'}}>
                            Ingresá el email con el que te registró la profesora. Te enviaremos un link para que definas tu contraseña.
                        </div>
                        
                        {error && <div className="alert alert-danger">{error}</div>}
                        {exito && <div className="alert alert-success">{exito}</div>}
                        
                        {!exito && (
                            <form onSubmit={handleActivarCuenta}>
                                <div className="form-group">
                                    <label>Email</label>
                                    <input 
                                        type="email"
                                        value={activarEmail}
                                        onChange={(e) => setActivarEmail(e.target.value)}
                                        placeholder="tu@email.com"
                                        required
                                    />
                                </div>
                                
                                <button type="submit" className="btn btn-primary" style={{width: '100%'}} disabled={cargando}>
                                    {cargando ? '⏳ Verificando...' : 'Activar Cuenta'}
                                </button>
                            </form>
                        )}
                        
                        <button 
                            onClick={() => { setVista('login'); setError(''); setExito(''); setActivarEmail(''); }}
                            className="btn btn-secondary" 
                            style={{width: '100%', marginTop: '10px'}}
                        >
                            Volver al Login
                        </button>
                    </div>
                );
            }
            
            // ── Vista: Login principal ──
            return (
                <div style={{maxWidth: '400px', margin: '50px auto', background: 'white', padding: '40px', borderRadius: '12px', boxShadow: '0 10px 30px rgba(0,0,0,0.2)'}}>
                    <div style={{textAlign: 'center', marginBottom: '30px'}}>
                        <LogoSVG width={200} style={{margin: '0 auto'}} />
                    </div>
                    
                    {error && <div className="alert alert-danger">{error}</div>}
                    
                    <form onSubmit={handleLogin}>
                        <div className="form-group">
                            <label>Email</label>
                            <input 
                                type="email"
                                value={email}
                                onChange={(e) => setEmail(e.target.value)}
                                placeholder="tu@email.com"
                                required
                            />
                        </div>
                        
                        <div className="form-group">
                            <label>Contraseña</label>
                            <div className="password-wrapper">
                                <input 
                                    type={mostrarPassword ? "text" : "password"}
                                    value={password}
                                    onChange={(e) => setPassword(e.target.value)}
                                    placeholder="••••••••"
                                    required
                                />
                                <button 
                                    type="button"
                                    className="password-toggle"
                                    onClick={() => setMostrarPassword(!mostrarPassword)}
                                    tabIndex={-1}
                                >
                                    {mostrarPassword ? (<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round"><path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94"/><path d="M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19"/><path d="M14.12 14.12a3 3 0 1 1-4.24-4.24"/><line x1="1" y1="1" x2="23" y2="23"/></svg>) : (<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>)}
                                </button>
                            </div>
                        </div>
                        
                        <button type="submit" className="btn btn-primary" style={{width: '100%'}} disabled={cargando}>
                            {cargando ? '⏳ Ingresando...' : 'Ingresar'}
                        </button>
                    </form>
                    
                    <div style={{marginTop: '20px', textAlign: 'center'}}>
                        <button 
                            onClick={() => { setVista('resetPassword'); setError(''); }}
                            style={{background: 'none', border: 'none', color: '#667eea', cursor: 'pointer', textDecoration: 'underline', fontSize: '0.9rem'}}
                        >
                            ¿Olvidaste tu contraseña?
                        </button>
                    </div>
                    
                    <div style={{marginTop: '20px', padding: '15px', background: '#f0f7ff', borderRadius: '8px', fontSize: '0.85rem', color: '#0c5060', textAlign: 'center'}}>
                        <strong>¿Primer ingreso?</strong><br/>
                        <span style={{display: 'block', marginTop: '6px', marginBottom: '10px'}}>Si la profesora ya te registró, activá tu cuenta para recibir un email y crear tu contraseña.</span>
                        <button 
                            onClick={() => { setVista('activarCuenta'); setError(''); }}
                            className="btn btn-success"
                            style={{fontSize: '0.9rem', padding: '10px 20px'}}
                        >
                            Activar mi Cuenta
                        </button>
                    </div>
                </div>
            );
        }
        
        function AdminDashboard({ alumnos, setAlumnos, horarios, setHorarios, precios, setPrecios, cancelaciones, setCancelaciones, cancelacionesAlumno, solicitudes, setSolicitudes, recuperos, onLogout, recargarDatos }) {
            const [tabActiva, setTabActiva] = useState('cancelaciones');
            const [guardando, setGuardando] = useState(false);
            const [menuAbierto, setMenuAbierto] = useState(false);
            
            // Activar notificaciones push al entrar como admin
            useEffect(() => {
                inicializarPushAdmin();
            }, []);
            
            const guardarCambios = async (tipo, datos) => {
                try {
                    setGuardando(true);
                    if (tipo === 'alumno') {
                        await FirebaseService.guardarAlumno(datos);
                    } else if (tipo === 'horarios') {
                        await FirebaseService.guardarHorarios(datos);
                    } else if (tipo === 'precios') {
                        await FirebaseService.guardarPrecios(datos);
                    }
                    // Los listeners en tiempo real se encargan de actualizar automáticamente
                    alert('✅ Cambios guardados en Firebase');
                } catch (error) {
                    console.error('Error al guardar:', error);
                    alert('❌ Error al guardar. Verifica la consola.');
                } finally {
                    setGuardando(false);
                }
            };
            
            return (
                <div className="container">
                    <div className="header">
                        <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center', position: 'relative'}}>
                            <div style={{display: 'flex', alignItems: 'center', gap: '15px'}}>
                                {/* Botón Hamburguesa */}
                                <button 
                                    onClick={() => setMenuAbierto(!menuAbierto)}
                                    style={{
                                        background: 'none',
                                        border: 'none',
                                        color: 'white',
                                        cursor: 'pointer',
                                        padding: '8px',
                                        display: 'flex',
                                        flexDirection: 'column',
                                        justifyContent: 'center',
                                        gap: '5px',
                                        width: '40px',
                                        height: '40px',
                                        position: 'relative'
                                    }}
                                    title="Menú"
                                >
                                    <span style={{width: '24px', height: '3px', background: 'white', borderRadius: '2px', transition: 'all 0.3s'}}></span>
                                    <span style={{width: '24px', height: '3px', background: 'white', borderRadius: '2px', transition: 'all 0.3s'}}></span>
                                    <span style={{width: '24px', height: '3px', background: 'white', borderRadius: '2px', transition: 'all 0.3s'}}></span>
                                </button>
                                
                                <span style={{fontSize: '1.1rem', fontWeight: '600', color: 'white'}}>
                                    Panel Admin
                                </span>
                                {guardando && <span style={{marginLeft: '8px', fontSize: '0.8rem', opacity: 0.8, color: 'white'}}>💾 Guardando...</span>}
                            </div>
                            <HeaderLogoSVG width={120} style={{filter: 'brightness(0) invert(1)', opacity: 0.9}} />
                        </div>
                    </div>
                    
                    {/* MENÚ DESPLEGABLE */}
                    {menuAbierto && (
                        <div style={{
                            position: 'fixed',
                            top: 0,
                            left: 0,
                            right: 0,
                            bottom: 0,
                            background: 'rgba(0,0,0,0.5)',
                            zIndex: 999
                        }} onClick={() => setMenuAbierto(false)}>
                            <div style={{
                                position: 'fixed',
                                top: 0,
                                left: 0,
                                width: '280px',
                                height: '100vh',
                                background: 'white',
                                zIndex: 1000,
                                boxShadow: '0 4px 12px rgba(0,0,0,0.15)',
                                overflowY: 'auto',
                                display: 'flex',
                                flexDirection: 'column'
                            }} onClick={(e) => e.stopPropagation()}>
                                {/* Header del menú */}
                                <div style={{
                                    padding: '20px',
                                    background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
                                    color: 'white',
                                    display: 'flex',
                                    justifyContent: 'space-between',
                                    alignItems: 'center',
                                    minHeight: '60px'
                                }}>
                                    <span style={{fontSize: '1.2rem', fontWeight: 'bold'}}>Menú</span>
                                    <button 
                                        onClick={() => setMenuAbierto(false)}
                                        style={{
                                            background: 'rgba(255,255,255,0.2)',
                                            border: 'none',
                                            color: 'white',
                                            fontSize: '1.5rem',
                                            cursor: 'pointer',
                                            width: '44px',
                                            height: '44px',
                                            borderRadius: '8px',
                                            display: 'flex',
                                            alignItems: 'center',
                                            justifyContent: 'center'
                                        }}
                                    >×</button>
                                </div>
                                
                                {/* Items del menú */}
                                <div style={{flex: 1, padding: '0'}}>
                                    {[
                                        { id: 'calendario', icon: '📆', label: 'Calendario', color: '#667eea' },
                                        { id: 'cancelaciones', icon: '◎', label: 'Solicitudes de Recupero', count: solicitudes.filter(s => s.estado === 'pendiente').length, color: '#007bff' },
                                        { id: 'alumnos', icon: '◉', label: 'Alumnos', color: '#6c757d' },
                                        { id: 'horarios', icon: '⏱', label: 'Horarios', color: '#28a745' },
                                        { id: 'precios', icon: '◇', label: 'Precios', color: '#ffc107' },
                                        { id: 'resumen', icon: '▨', label: 'Resumen del Mes', color: '#dc3545' },
                                    ].map(item => (
                                        <button
                                            key={item.id}
                                            onClick={() => {
                                                setTabActiva(item.id);
                                                setMenuAbierto(false);
                                            }}
                                            style={{
                                                width: '100%',
                                                padding: '16px 20px',
                                                border: 'none',
                                                background: tabActiva === item.id ? 'rgba(102, 126, 234, 0.1)' : 'transparent',
                                                borderLeft: tabActiva === item.id ? `4px solid #667eea` : '4px solid transparent',
                                                color: tabActiva === item.id ? '#667eea' : '#333',
                                                cursor: 'pointer',
                                                fontSize: '1.05rem',
                                                fontWeight: tabActiva === item.id ? '600' : '500',
                                                textAlign: 'left',
                                                transition: 'all 0.2s',
                                                display: 'flex',
                                                alignItems: 'center',
                                                gap: '12px',
                                                borderBottom: '1px solid #f0f0f0'
                                            }}
                                            onMouseEnter={(e) => !tabActiva === item.id && (e.target.style.background = 'rgba(0,0,0,0.03)')}
                                            onMouseLeave={(e) => !tabActiva === item.id && (e.target.style.background = 'transparent')}
                                        >
                                            <span style={{fontSize: '1.3rem'}}>{item.icon}</span>
                                            <span style={{flex: 1}}>{item.label}</span>
                                            {item.count > 0 && (
                                                <span style={{
                                                    background: '#dc3545',
                                                    color: 'white',
                                                    borderRadius: '12px',
                                                    padding: '2px 8px',
                                                    fontSize: '0.8rem',
                                                    fontWeight: 'bold',
                                                    minWidth: '24px',
                                                    textAlign: 'center'
                                                }}>
                                                    {item.count}
                                                </span>
                                            )}
                                        </button>
                                    ))}
                                </div>
                                
                                {/* Footer del menú */}
                                <div style={{
                                    padding: '20px',
                                    borderTop: '2px solid #f0f0f0',
                                    background: '#f8f9fa'
                                }}>
                                    <button 
                                        onClick={() => {
                                            onLogout();
                                            setMenuAbierto(false);
                                        }}
                                        style={{
                                            width: '100%',
                                            padding: '14px 16px',
                                            background: '#dc3545',
                                            color: 'white',
                                            border: 'none',
                                            borderRadius: '8px',
                                            fontSize: '1rem',
                                            fontWeight: '600',
                                            cursor: 'pointer',
                                            transition: 'all 0.2s'
                                        }}
                                        onMouseEnter={(e) => e.target.style.background = '#c82333'}
                                        onMouseLeave={(e) => e.target.style.background = '#dc3545'}
                                    >
                                        → Cerrar Sesión
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}
                    
                    <div className="tabs">
                        <button className={`tab ${tabActiva === 'calendario' ? 'active' : ''}`} onClick={() => setTabActiva('calendario')}>
                            <span className="tab-icon">📆</span> <span>Calendario</span>
                        </button>
                        <button className={`tab ${tabActiva === 'cancelaciones' ? 'active' : ''}`} onClick={() => setTabActiva('cancelaciones')}>
                            <span className="tab-icon">◎</span> <span>Solicitudes {solicitudes.filter(s => s.estado === 'pendiente').length > 0 && `(${solicitudes.filter(s => s.estado === 'pendiente').length})`}</span>
                        </button>
                        <button className={`tab ${tabActiva === 'alumnos' ? 'active' : ''}`} onClick={() => setTabActiva('alumnos')}>
                            <span className="tab-icon">◉</span> <span>Alumnos</span>
                        </button>
                        <button className={`tab ${tabActiva === 'horarios' ? 'active' : ''}`} onClick={() => setTabActiva('horarios')}>
                            <span className="tab-icon">⏱</span> <span>Horarios</span>
                        </button>
                        <button className={`tab ${tabActiva === 'precios' ? 'active' : ''}`} onClick={() => setTabActiva('precios')}>
                            <span className="tab-icon">◇</span> <span>Precios</span>
                        </button>
                        <button className={`tab ${tabActiva === 'resumen' ? 'active' : ''}`} onClick={() => setTabActiva('resumen')}>
                            <span className="tab-icon">▨</span> <span>Resumen</span>
                        </button>
                    </div>
                    
                    <div className="content">
                        {tabActiva === 'calendario' && <CalendarioAdminTab alumnos={alumnos} cancelacionesAlumno={cancelacionesAlumno} horarios={horarios} recuperos={recuperos} />}
                        {tabActiva === 'cancelaciones' && <SolicitudesTab solicitudes={solicitudes} alumnos={alumnos} recargarDatos={recargarDatos} />}
                        {tabActiva === 'alumnos' && <AlumnosTab alumnos={alumnos} precios={precios} horarios={horarios} guardarCambios={guardarCambios} recargarDatos={recargarDatos} />}
                        {tabActiva === 'horarios' && <HorariosTab horarios={horarios} alumnos={alumnos} guardarCambios={guardarCambios} />}
                        {tabActiva === 'precios' && <PreciosTab precios={precios} guardarCambios={guardarCambios} />}
                        {tabActiva === 'resumen' && <ResumenTab alumnos={alumnos} cancelaciones={cancelaciones} />}
                    </div>
                    
                    <div className="footer">
                        <button onClick={onLogout} className="btn btn-secondary">
                            Cerrar Sesión
                        </button>
                    </div>
                </div>
            );
        }
        
        function CalendarioAdminTab({ alumnos, cancelacionesAlumno, horarios, recuperos }) {
            const [semanaSeleccionada, setSemanaSeleccionada] = useState(new Date());
            
            const obtenerNombreCorto = (alumno) => {
                if (!alumno) return '';
                const apellidoInicial = alumno.apellido ? alumno.apellido[0] : '';
                return `${alumno.nombre} ${apellidoInicial}.`;
            };
            
            const obtenerAlumnosEnHorario = (fecha, hora) => {
                const fechaStr = fechaLocal(fecha);
                const diaSemana = ['Domingo', 'Lunes', 'Martes', 'Miércoles', 'Jueves', 'Viernes', 'Sábado'][fecha.getDay()];
                
                // Alumnos con horario recurrente que no cancelaron
                const regulares = alumnos.filter(alumno => {
                    if (!(alumno.horariosAsignados || []).includes(`${diaSemana}-${hora}`)) return false;
                    const estaCancelada = cancelacionesAlumno.some(c => 
                        c.alumnoId === alumno.id && c.fecha === fechaStr && c.hora === hora
                    );
                    return !estaCancelada;
                });
                
                // Alumnos con recupero aprobado para esta fecha/hora
                const conRecupero = (recuperos || [])
                    .filter(r => r.fecha === fechaStr && r.hora === hora && r.estado === 'aprobado')
                    .map(r => ({ id: r.alumnoId, nombre: r.alumnoNombre?.split(' ')[0] || '', apellido: r.alumnoNombre?.split(' ')[1] || '', esRecupero: true }));
                
                return [...regulares, ...conRecupero];
            };
            
            const obtenerCancelacionesEnHorario = (fecha, hora) => {
                const fechaStr = fechaLocal(fecha);
                return cancelacionesAlumno.filter(c => c.fecha === fechaStr && c.hora === hora);
            };
            
            const obtenerDiasDeSemanConClases = () => {
                const diasSemana = [];
                const primerDia = new Date(semanaSeleccionada);
                // Arrancar en lunes
                const dia = primerDia.getDay();
                const diffLunes = dia === 0 ? -6 : 1 - dia;
                primerDia.setDate(primerDia.getDate() + diffLunes);
                
                for (let i = 0; i < 7; i++) {
                    const fecha = new Date(primerDia);
                    fecha.setDate(fecha.getDate() + i);
                    diasSemana.push(fecha);
                }
                return diasSemana;
            };
            
            const obtenerHorariosConClasesEnFecha = (fecha) => {
                const diaSemana = ['Domingo', 'Lunes', 'Martes', 'Miércoles', 'Jueves', 'Viernes', 'Sábado'][fecha.getDay()];
                const horariosDelDia = [...new Set(
                    alumnos
                        .filter(a => (a.horariosAsignados || []).some(h => h.split('-')[0] === diaSemana))
                        .flatMap(a => (a.horariosAsignados || []).filter(h => h.split('-')[0] === diaSemana).map(h => h.split('-')[1]))
                )].sort();
                return horariosDelDia;
            };
            
            const diasSemana = obtenerDiasDeSemanConClases();
            const meses = ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio', 'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'];
            const diasSemanaAbrev = ['Dom', 'Lun', 'Mar', 'Mié', 'Jue', 'Vie', 'Sáb'];
            
            // Obtener todos los horarios con clases en la semana (incluyendo recuperos)
            const horariosEnSemana = [...new Set([
                ...diasSemana.flatMap(fecha => obtenerHorariosConClasesEnFecha(fecha)),
                ...(recuperos || [])
                    .filter(r => r.estado === 'aprobado' && diasSemana.some(f => fechaLocal(f) === r.fecha))
                    .map(r => r.hora)
            ])].sort();
            
            if (horariosEnSemana.length === 0) {
                return (
                    <div>
                        <h2 style={{marginBottom: '20px'}}>Calendario - Semana de {diasSemana[0].getDate()} al {diasSemana[6].getDate()} de {meses[semanaSeleccionada.getMonth()]}</h2>
                        <div style={{display: 'flex', justifyContent: 'space-between', marginBottom: '20px'}}>
                            <button className="btn btn-secondary" onClick={() => setSemanaSeleccionada(new Date(semanaSeleccionada.getTime() - 7 * 24 * 60 * 60 * 1000))}>← Semana Anterior</button>
                            <button className="btn btn-secondary" onClick={() => setSemanaSeleccionada(new Date())}>Hoy</button>
                            <button className="btn btn-secondary" onClick={() => setSemanaSeleccionada(new Date(semanaSeleccionada.getTime() + 7 * 24 * 60 * 60 * 1000))}>Semana Siguiente →</button>
                        </div>
                        <div className="alert alert-info">No hay clases programadas esta semana.</div>
                    </div>
                );
            }
            
            return (
                <div>
                    <h2 style={{marginBottom: '20px'}}>Calendario - Semana de {diasSemana[0].getDate()} al {diasSemana[6].getDate()} de {meses[semanaSeleccionada.getMonth()]}</h2>
                    
                    <div style={{display: 'flex', justifyContent: 'space-between', marginBottom: '20px'}}>
                        <button className="btn btn-secondary" onClick={() => setSemanaSeleccionada(new Date(semanaSeleccionada.getTime() - 7 * 24 * 60 * 60 * 1000))}>
                            ← Semana Anterior
                        </button>
                        <button className="btn btn-secondary" onClick={() => setSemanaSeleccionada(new Date())}>
                            Hoy
                        </button>
                        <button className="btn btn-secondary" onClick={() => setSemanaSeleccionada(new Date(semanaSeleccionada.getTime() + 7 * 24 * 60 * 60 * 1000))}>
                            Semana Siguiente →
                        </button>
                    </div>
                    
                    <div className="table-responsive">
                        <table style={{width: '100%', borderCollapse: 'collapse', fontSize: '0.85rem'}}>
                            <thead>
                                <tr style={{background: '#667eea', color: 'white'}}>
                                    <th style={{padding: '10px', border: '1px solid #dee2e6', textAlign: 'left'}}>Hora</th>
                                    {diasSemana.map((fecha, i) => (
                                        <th key={i} style={{padding: '10px', border: '1px solid #dee2e6', textAlign: 'center', minWidth: '120px'}}>
                                            {diasSemanaAbrev[fecha.getDay()]} {fecha.getDate()}
                                        </th>
                                    ))}
                                </tr>
                            </thead>
                            <tbody>
                                {horariosEnSemana.map(hora => (
                                    <tr key={hora}>
                                        <td style={{padding: '10px', border: '1px solid #dee2e6', fontWeight: 'bold', background: '#f8f9fa'}}>
                                            {hora}
                                        </td>
                                        {diasSemana.map((fecha, i) => {
                                            const diaSemana = ['Domingo', 'Lunes', 'Martes', 'Miércoles', 'Jueves', 'Viernes', 'Sábado'][fecha.getDay()];
                                            const tieneHorarioEnDia = alumnos.some(a => (a.horariosAsignados || []).includes(`${diaSemana}-${hora}`)) ||
                                                (recuperos || []).some(r => r.fecha === fechaLocal(fecha) && r.hora === hora && r.estado === 'aprobado');
                                            
                                            if (!tieneHorarioEnDia) {
                                                return <td key={i} style={{padding: '10px', border: '1px solid #dee2e6', background: '#f5f5f5'}}></td>;
                                            }
                                            
                                            const alumnosHoy = obtenerAlumnosEnHorario(fecha, hora);
                                            const cancelacionesHoy = obtenerCancelacionesEnHorario(fecha, hora);
                                            const ocupados = alumnosHoy.length;
                                            const libres = 5 - ocupados;
                                            
                                            return (
                                                <td key={i} style={{padding: '10px', border: '1px solid #dee2e6', verticalAlign: 'top', background: cancelacionesHoy.length > 0 ? '#f0f0f0' : 'white'}}>
                                                    <div style={{fontSize: '0.75rem', fontWeight: 'bold', marginBottom: '5px', color: libres > 0 ? '#28a745' : '#dc3545'}}>
                                                        {libres} lugar{libres !== 1 ? 'es' : ''}
                                                    </div>
                                                    <div style={{marginBottom: '5px'}}>
                                                        {alumnosHoy.map((alumno, idx) => (
                                                            <div key={idx} style={{fontSize: '0.7rem', padding: '2px', background: alumno.esRecupero ? '#28a745' : '#667eea', color: 'white', borderRadius: '3px', marginBottom: '2px'}}>
                                                                {alumno.esRecupero ? '🔄 ' : ''}{obtenerNombreCorto(alumno)}
                                                            </div>
                                                        ))}
                                                    </div>
                                                    {cancelacionesHoy.length > 0 && (
                                                        <div>
                                                            <div style={{fontSize: '0.7rem', fontWeight: 'bold', color: '#ff9800', marginBottom: '3px'}}>Canceladas:</div>
                                                            {cancelacionesHoy.map((c, idx) => (
                                                                <div key={idx} style={{fontSize: '0.7rem', padding: '2px', background: '#ccc', color: '#666', borderRadius: '3px', marginBottom: '2px', textDecoration: 'line-through'}}>
                                                                    {c.alumnoNombre}
                                                                </div>
                                                            ))}
                                                        </div>
                                                    )}
                                                </td>
                                            );
                                        })}
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                    </div>
                </div>
            );
        }
        
        function ResumenTab({ alumnos, cancelaciones }) {
            const [modalPlan, setModalPlan] = useState(null);
            
            const totalAlumnos = alumnos.length;
            const alumnosActivos = alumnos.filter(a => a.activo && a.clasesUsadas > 0).length;
            const totalClasesDelMes = alumnos.reduce((sum, a) => sum + a.clasesUsadas, 0);
            const recuperacionesPendientes = cancelaciones.length;
            
            const alumnosPorPlan = (plan) => alumnos.filter(a => a.abono === plan);
            
            return (
                <div>
                    <h2 style={{marginBottom: '20px'}}>Resumen del Mes</h2>
                    <div className="grid">
                        <div className="stat-card">
                            <div className="stat-number">{totalAlumnos}</div>
                            <div className="stat-label">Total Alumnos</div>
                        </div>
                        <div className="stat-card">
                            <div className="stat-number">{alumnosActivos}</div>
                            <div className="stat-label">Alumnos Activos</div>
                        </div>
                        <div className="stat-card">
                            <div className="stat-number">{totalClasesDelMes}</div>
                            <div className="stat-label">Clases Dictadas</div>
                        </div>
                        <div className="stat-card">
                            <div className="stat-number">{recuperacionesPendientes}</div>
                            <div className="stat-label">Cancelaciones Pendientes</div>
                        </div>
                    </div>
                    
                    <h3 style={{marginTop: '40px', marginBottom: '20px'}}>Distribución por Plan (Click para ver detalle)</h3>
                    <div className="grid">
                        {['1x_semana', '2x_semana', '3x_semana', '4x_semana'].map(plan => {
                            const cantidad = alumnos.filter(a => a.abono === plan).length;
                            return (
                                <div key={plan} className="card clickable" onClick={() => setModalPlan(plan)}>
                                    <h3>{plan.replace('_', ' ').toUpperCase()}</h3>
                                    <div style={{fontSize: '2rem', fontWeight: 'bold', color: '#667eea', textAlign: 'center', marginTop: '10px'}}>
                                        {cantidad}
                                    </div>
                                    <div style={{textAlign: 'center', color: '#6c757d'}}>
                                        alumnos
                                    </div>
                                    <div style={{textAlign: 'center', marginTop: '10px', fontSize: '0.9rem', color: '#667eea'}}>
                                        👆 Click para ver lista
                                    </div>
                                </div>
                            );
                        })}
                    </div>
                    
                    {modalPlan && (
                        <Modal onClose={() => setModalPlan(null)}>
                            <h2>Alumnos con plan {modalPlan.replace('_', ' ').toUpperCase()}</h2>
                            <table>
                                <thead>
                                    <tr>
                                        <th>Nombre</th>
                                        <th>Email</th>
                                        <th>Clases</th>
                                        <th>Estado</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {alumnosPorPlan(modalPlan).map(a => (
                                        <tr key={a.id}>
                                            <td>{a.nombre} {a.apellido}</td>
                                            <td>{a.email}</td>
                                            <td>{a.clasesUsadas}/{a.clasesTotales}</td>
                                            <td>
                                                <span className={`badge ${a.activo ? 'badge-success' : 'badge-danger'}`}>
                                                    {a.activo ? 'Activo' : 'Inactivo'}
                                                </span>
                                            </td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </Modal>
                    )}
                </div>
            );
        }
        
        function AlumnosTab({ alumnos, precios, horarios, guardarCambios, recargarDatos }) {
            const [filtro, setFiltro] = useState('todos');
            const [busqueda, setBusqueda] = useState('');
            const [vistaLista, setVistaLista] = useState(false);
            const [alumnoEditando, setAlumnoEditando] = useState(null);
            const [mostrarNuevo, setMostrarNuevo] = useState(false);
            const [reseteando, setReseteando] = useState(null);
            
            const handleResetear = async (alumno) => {
                if (!window.confirm(`¿Resetear el historial de ${alumno.nombre} ${alumno.apellido}?\n\nEsto borrará todas sus cancelaciones, recuperos y solicitudes pendientes, y pondrá sus contadores en cero.`)) return;
                setReseteando(alumno.id);
                try {
                    await FirebaseService.resetearAlumno(alumno.id);
                    // Los listeners se encargan de actualizar automáticamente
                    alert(`✅ Historial de ${alumno.nombre} reseteado`);
                } catch(e) {
                    console.error(e);
                    alert('❌ Error al resetear. Revisá la consola.');
                } finally {
                    setReseteando(null);
                }
            };
            
            const alumnosFiltrados = alumnos
                .filter(a => filtro === 'todos' || a.abono === filtro)
                .filter(a => {
                    if (!busqueda) return true;
                    const q = busqueda.toLowerCase();
                    return (a.nombre + ' ' + a.apellido).toLowerCase().includes(q) || a.email.toLowerCase().includes(q);
                })
                .sort((a, b) => (a.apellido + a.nombre).localeCompare(b.apellido + b.nombre));
            
            
            return (
                <div>
                    <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '15px', flexWrap: 'wrap', gap: '10px'}}>
                        <h2>Gestión de Alumnos <span style={{fontSize: '1rem', color: '#6c757d', fontWeight: 'normal'}}>({alumnosFiltrados.length})</span></h2>
                        <button className="btn btn-primary" onClick={() => setMostrarNuevo(true)}>
                            + Nuevo Alumno
                        </button>
                    </div>
                    
                    {/* Barra de filtros */}
                    <div style={{display: 'flex', gap: '10px', marginBottom: '20px', flexWrap: 'wrap', alignItems: 'center'}}>
                        <input
                            type="text"
                            placeholder="🔍 Buscar por nombre o email..."
                            value={busqueda}
                            onChange={e => setBusqueda(e.target.value)}
                            style={{flex: 1, minWidth: '200px', padding: '10px', borderRadius: '8px', border: '2px solid #e9ecef', fontSize: '0.95rem'}}
                        />
                        <select value={filtro} onChange={(e) => setFiltro(e.target.value)} style={{padding: '10px', borderRadius: '8px', border: '2px solid #e9ecef'}}>
                            <option value="todos">Todos los planes</option>
                            <option value="1x_semana">1x Semana</option>
                            <option value="2x_semana">2x Semana</option>
                            <option value="3x_semana">3x Semana</option>
                            <option value="4x_semana">4x Semana</option>
                        </select>
                        {/* Toggle vista */}
                        <div style={{display: 'flex', border: '2px solid #e9ecef', borderRadius: '8px', overflow: 'hidden'}}>
                            <button
                                onClick={() => setVistaLista(false)}
                                style={{padding: '10px 16px', border: 'none', cursor: 'pointer', background: !vistaLista ? '#667eea' : 'white', color: !vistaLista ? 'white' : '#6c757d', fontWeight: 600, fontSize: '1rem'}}
                                title="Vista tarjetas"
                            >⊞</button>
                            <button
                                onClick={() => setVistaLista(true)}
                                style={{padding: '10px 16px', border: 'none', cursor: 'pointer', background: vistaLista ? '#667eea' : 'white', color: vistaLista ? 'white' : '#6c757d', fontWeight: 600, fontSize: '1rem'}}
                                title="Vista lista"
                            >☰</button>
                        </div>
                    </div>
                    
                    {/* VISTA TARJETAS */}
                    {!vistaLista && (
                        <div className="grid">
                            {alumnosFiltrados.map(alumno => (
                                <div key={alumno.id} className="card">
                                    <h3 style={{marginBottom: '8px'}}>{alumno.nombre} {alumno.apellido}</h3>
                                    <div style={{marginBottom: '8px'}}>
                                        <span className={`badge ${alumno.activo ? 'badge-success' : 'badge-danger'}`}>
                                            {alumno.activo ? 'Activo' : 'Inactivo'}
                                        </span>
                                        <span className="badge badge-info" style={{marginLeft: '5px'}}>{alumno.abono.replace('_', ' ')}</span>
                                    </div>
                                    <div className="info-row">
                                        <span className="label">Email:</span>
                                        <span className="value" style={{fontSize: '0.85rem'}}>{alumno.email}</span>
                                    </div>
                                    <div className="info-row">
                                        <span className="label">Clases:</span>
                                        <span className="value">{alumno.clasesUsadas}/{alumno.clasesTotales}</span>
                                    </div>
                                    {alumno.clasesPendientes > 0 && (
                                        <div className="info-row">
                                            <span className="label">Pendientes:</span>
                                            <span className="badge badge-warning">{alumno.clasesPendientes} a recuperar</span>
                                        </div>
                                    )}
                                    <div style={{marginTop: '10px', fontSize: '0.8rem', color: '#6c757d'}}>
                                        {(alumno.horariosAsignados || []).map(h => (
                                            <span key={h} style={{display: 'inline-block', background: '#e9ecef', borderRadius: '4px', padding: '2px 6px', margin: '2px', fontSize: '0.75rem'}}>{h.replace('-', ' ')}</span>
                                        ))}
                                    </div>
                                    <button className="btn btn-primary" style={{width: '100%', marginTop: '12px'}} onClick={() => setAlumnoEditando(alumno)}>
                                        ✎ Editar
                                    </button>
                                    <button 
                                        className="btn btn-danger" 
                                        style={{width: '100%', marginTop: '6px', fontSize: '0.85rem', padding: '8px'}} 
                                        onClick={() => handleResetear(alumno)}
                                        disabled={reseteando === alumno.id}
                                    >
                                        {reseteando === alumno.id ? '⏳ Reseteando...' : '↻ Resetear historial'}
                                    </button>
                                </div>
                            ))}
                        </div>
                    )}
                    
                    {/* VISTA LISTA */}
                    {vistaLista && (
                        <div style={{overflowX: 'auto'}}>
                            <table>
                                <thead>
                                    <tr>
                                        <th>Alumno</th>
                                        <th>Email</th>
                                        <th>Plan</th>
                                        <th>Clases</th>
                                        <th>Horarios</th>
                                        <th>Estado</th>
                                        <th></th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {alumnosFiltrados.map(alumno => (
                                        <tr key={alumno.id}>
                                            <td style={{fontWeight: 600}}>{alumno.apellido}, {alumno.nombre}</td>
                                            <td style={{fontSize: '0.85rem', color: '#6c757d'}}>{alumno.email}</td>
                                            <td><span className="badge badge-info">{alumno.abono.replace('_', ' ')}</span></td>
                                            <td>
                                                <span style={{fontWeight: 600}}>{alumno.clasesUsadas}/{alumno.clasesTotales}</span>
                                                {alumno.clasesPendientes > 0 && <span className="badge badge-warning" style={{marginLeft: '5px'}}>{alumno.clasesPendientes} pend.</span>}
                                            </td>
                                            <td style={{fontSize: '0.8rem', color: '#6c757d', maxWidth: '200px'}}>
                                                {(alumno.horariosAsignados || []).join(' · ')}
                                            </td>
                                            <td>
                                                <span className={`badge ${alumno.activo ? 'badge-success' : 'badge-danger'}`}>
                                                    {alumno.activo ? 'Activo' : 'Inactivo'}
                                                </span>
                                            </td>
                                            <td>
                                                <button className="btn btn-primary" style={{padding: '6px 14px', fontSize: '0.85rem'}} onClick={() => setAlumnoEditando(alumno)}>
                                                    ✎ Editar
                                                </button>
                                                <button 
                                                    className="btn btn-danger" 
                                                    style={{padding: '6px 10px', fontSize: '0.85rem', marginLeft: '5px'}} 
                                                    onClick={() => handleResetear(alumno)}
                                                    disabled={reseteando === alumno.id}
                                                    title="Resetear historial"
                                                >
                                                    {reseteando === alumno.id ? '⏳' : '🔄'}
                                                </button>
                                            </td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>
                    )}
                    
                    {alumnosFiltrados.length === 0 && (
                        <div className="alert alert-info">No se encontraron alumnos con ese criterio.</div>
                    )}
                    
                    {alumnoEditando && (
                        <FormularioAlumno 
                            alumno={alumnoEditando}
                            horarios={horarios}
                            onClose={() => setAlumnoEditando(null)}
                            onSave={async (alumnoActualizado) => {
                                await guardarCambios('alumno', alumnoActualizado);
                                setAlumnoEditando(null);
                            }}
                            precios={precios}
                        />
                    )}
                    
                    {mostrarNuevo && (
                        <FormularioAlumno 
                            alumno={null}
                            horarios={horarios}
                            onClose={() => setMostrarNuevo(false)}
                            onSave={async (nuevoAlumno) => {
                                const maxId = Math.max(...alumnos.map(a => parseInt(a.id)), 0) + 1;
                                await guardarCambios('alumno', {...nuevoAlumno, id: maxId.toString()});
                                setMostrarNuevo(false);
                            }}
                            precios={precios}
                        />
                    )}
                </div>
            );
        }
        
        function FormularioAlumno({ alumno, onClose, onSave, precios, horarios }) {
            const [datos, setDatos] = useState(alumno || {
                nombre: '',
                apellido: '',
                email: '',
                abono: '2x_semana',
                clasesTotales: 8,
                clasesUsadas: 0,
                clasesPendientes: 0,
                horariosAsignados: [],
                activo: true
            });
            
            const clasesMap = {
                '1x_semana': 4,
                '2x_semana': 8,
                '3x_semana': 12,
                '4x_semana': 16
            };
            
            const handlePlanChange = (plan) => {
                setDatos({...datos, abono: plan, clasesTotales: clasesMap[plan]});
            };
            
            const toggleHorario = (dia, hora) => {
                const clave = `${dia}-${hora}`;
                const actuales = datos.horariosAsignados || [];
                if (actuales.includes(clave)) {
                    setDatos({...datos, horariosAsignados: actuales.filter(h => h !== clave)});
                } else {
                    setDatos({...datos, horariosAsignados: [...actuales, clave]});
                }
            };
            
            const handleSubmit = (e) => {
                e.preventDefault();
                onSave(datos);
            };
            
            const handleEliminar = async () => {
                if (!window.confirm(`⚠️ ¿ELIMINAR a ${datos.nombre} ${datos.apellido}?\n\nEsto borrará permanentemente al alumno, sus horarios se liberarán y no se podrá recuperar la información.\n\nEscribí "ELIMINAR" para confirmar.`)) return;
                
                const respuesta = prompt('Escribe "ELIMINAR" para confirmar:');
                if (respuesta !== 'ELIMINAR') {
                    alert('❌ Cancelado. No se eliminó nada.');
                    return;
                }
                
                try {
                    await FirebaseService.eliminarAlumno(datos.id);
                    alert(`✅ ${datos.nombre} ${datos.apellido} ha sido eliminado permanentemente.`);
                    onClose();
                } catch (error) {
                    console.error('Error al eliminar:', error);
                    alert('❌ Error al eliminar. Verifica la consola.');
                }
            };
            
            const diasOrden = ['Lunes', 'Martes', 'Miércoles', 'Jueves', 'Viernes', 'Sábado', 'Domingo'];
            const diasConHorarios = diasOrden.filter(d => horarios[d] && horarios[d].length > 0);
            
            return (
                <Modal onClose={onClose}>
                    <h2>{alumno ? 'Editar Alumno' : 'Nuevo Alumno'}</h2>
                    <form onSubmit={handleSubmit}>
                        <div style={{display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '15px'}}>
                            <div className="form-group">
                                <label>Nombre</label>
                                <input value={datos.nombre} onChange={(e) => setDatos({...datos, nombre: e.target.value})} required />
                            </div>
                            <div className="form-group">
                                <label>Apellido</label>
                                <input value={datos.apellido} onChange={(e) => setDatos({...datos, apellido: e.target.value})} required />
                            </div>
                        </div>
                        
                        <div className="form-group">
                            <label>Email</label>
                            <input type="email" value={datos.email} onChange={(e) => setDatos({...datos, email: e.target.value})} required />
                        </div>
                        
                        <div style={{display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '15px'}}>
                            <div className="form-group">
                                <label>Plan</label>
                                <select value={datos.abono} onChange={(e) => handlePlanChange(e.target.value)}>
                                    <option value="1x_semana">1x Semana — ${precios['1x_semana']?.toLocaleString()}</option>
                                    <option value="2x_semana">2x Semana — ${precios['2x_semana']?.toLocaleString()}</option>
                                    <option value="3x_semana">3x Semana — ${precios['3x_semana']?.toLocaleString()}</option>
                                    <option value="4x_semana">4x Semana — ${precios['4x_semana']?.toLocaleString()}</option>
                                </select>
                            </div>
                            <div className="form-group">
                                <label>Clases usadas este mes</label>
                                <input type="number" min="0" value={datos.clasesUsadas} onChange={(e) => setDatos({...datos, clasesUsadas: parseInt(e.target.value) || 0})} />
                            </div>
                        </div>
                        
                        {/* Selector de horarios */}
                        <div className="form-group">
                            <label style={{marginBottom: '10px', display: 'block'}}>
                                Días y horarios asignados
                                <span style={{fontWeight: 'normal', color: '#6c757d', marginLeft: '8px', fontSize: '0.85rem'}}>
                                    ({(datos.horariosAsignados || []).length} seleccionados)
                                </span>
                            </label>
                            
                            {diasConHorarios.length === 0 && (
                                <div className="alert alert-info">No hay horarios configurados. Configurá los horarios primero en la pestaña "Horarios".</div>
                            )}
                            
                            <div style={{display: 'flex', flexDirection: 'column', gap: '12px'}}>
                                {diasConHorarios.map(dia => (
                                    <div key={dia}>
                                        <div style={{fontWeight: 600, color: '#495057', marginBottom: '6px', fontSize: '0.9rem'}}>{dia}</div>
                                        <div style={{display: 'flex', flexWrap: 'wrap', gap: '8px'}}>
                                            {horarios[dia].map(hora => {
                                                const clave = `${dia}-${hora}`;
                                                const seleccionado = (datos.horariosAsignados || []).includes(clave);
                                                return (
                                                    <button
                                                        key={hora}
                                                        type="button"
                                                        onClick={() => toggleHorario(dia, hora)}
                                                        style={{
                                                            padding: '8px 16px',
                                                            borderRadius: '8px',
                                                            border: `2px solid ${seleccionado ? '#667eea' : '#dee2e6'}`,
                                                            background: seleccionado ? '#667eea' : 'white',
                                                            color: seleccionado ? 'white' : '#495057',
                                                            cursor: 'pointer',
                                                            fontWeight: seleccionado ? 700 : 400,
                                                            fontSize: '0.9rem',
                                                            transition: 'all 0.2s'
                                                        }}
                                                    >
                                                        {seleccionado ? '✓ ' : ''}{hora}
                                                    </button>
                                                );
                                            })}
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>
                        
                        <div className="form-group">
                            <label style={{display: 'flex', alignItems: 'center', gap: '8px', cursor: 'pointer'}}>
                                <input type="checkbox" checked={datos.activo} onChange={(e) => setDatos({...datos, activo: e.target.checked})} style={{width: 'auto'}} />
                                Alumno Activo
                            </label>
                        </div>
                        
                        <div style={{display: 'flex', gap: '10px', marginTop: '20px'}}>
                            <button type="submit" className="btn btn-primary" style={{flex: 1}}>
                                ↓ Guardar
                            </button>
                            <button type="button" className="btn btn-secondary" onClick={onClose} style={{flex: 1}}>
                                Cancelar
                            </button>
                            {alumno && (
                                <button type="button" className="btn btn-danger" onClick={handleEliminar} style={{flex: 1}}>
                                    ✗ Eliminar
                                </button>
                            )}
                        </div>
                    </form>
                </Modal>
            );
        }
        
        function HorariosTab({ horarios, alumnos, guardarCambios }) {
            const [editando, setEditando] = useState(false);
            const [horariosTemp, setHorariosTemp] = useState({...horarios});
            
            // Actualizar horariosTemp cuando cambia horarios (listener)
            useEffect(() => {
                if (!editando) {
                    setHorariosTemp({...horarios});
                }
            }, [horarios, editando]);
            
            const dias = ["Lunes", "Martes", "Miércoles", "Jueves", "Viernes", "Sábado", "Domingo"];
            
            const agregarHorario = (dia, hora) => {
                const nuevosHorarios = {...horariosTemp};
                if (!nuevosHorarios[dia]) nuevosHorarios[dia] = [];
                if (!nuevosHorarios[dia].includes(hora)) {
                    nuevosHorarios[dia] = [...nuevosHorarios[dia], hora].sort();
                    setHorariosTemp(nuevosHorarios);
                }
            };
            
            const eliminarHorario = (dia, hora) => {
                if (window.confirm(`¿Eliminar el horario ${dia} ${hora}?`)) {
                    const nuevosHorarios = {...horariosTemp};
                    nuevosHorarios[dia] = nuevosHorarios[dia].filter(h => h !== hora);
                    setHorariosTemp(nuevosHorarios);
                }
            };
            
            const guardar = async () => {
                await guardarCambios('horarios', horariosTemp);
                setEditando(false);
            };
            
            const cancelar = () => {
                setHorariosTemp({...horarios});
                setEditando(false);
            };
            
            return (
                <div>
                    <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '20px'}}>
                        <h2>Configuración de Horarios</h2>
                        {!editando ? (
                            <button className="btn btn-primary" onClick={() => setEditando(true)}>
                                ✎ Editar Horarios
                            </button>
                        ) : (
                            <div>
                                <button className="btn btn-success" onClick={guardar}>
                                    ↓ Guardar
                                </button>
                                <button className="btn btn-secondary" onClick={cancelar}>
                                    Cancelar
                                </button>
                            </div>
                        )}
                    </div>
                    
                    {editando && <EditorHorarios dias={dias} horarios={horariosTemp} onAgregar={agregarHorario} />}
                    
                    <div className="grid">
                        {dias.map(dia => (
                            <div key={dia} className="card">
                                <h3>{dia}</h3>
                                {(editando ? horariosTemp[dia] : horarios[dia]) && (editando ? horariosTemp[dia] : horarios[dia]).length > 0 ? (
                                    (editando ? horariosTemp[dia] : horarios[dia]).map(hora => (
                                        <div key={hora} className="horario-item">
                                            <span style={{fontWeight: 'bold'}}>{hora}</span>
                                            {editando && (
                                                <button 
                                                    className="btn btn-danger" 
                                                    style={{padding: '5px 10px', fontSize: '0.8rem'}}
                                                    onClick={() => eliminarHorario(dia, hora)}
                                                >
                                                    ✗
                                                </button>
                                            )}
                                        </div>
                                    ))
                                ) : (
                                    <p style={{color: '#6c757d', fontStyle: 'italic'}}>Sin horarios</p>
                                )}
                            </div>
                        ))}
                    </div>
                </div>
            );
        }
        
        function EditorHorarios({ dias, horarios, onAgregar }) {
            const [diaSeleccionado, setDiaSeleccionado] = useState('Lunes');
            const [horaSeleccionada, setHoraSeleccionada] = useState('08:00');
            
            const horasPosibles = [];
            for (let h = 6; h <= 22; h++) {
                horasPosibles.push(`${h.toString().padStart(2, '0')}:00`);
                if (h < 22) horasPosibles.push(`${h.toString().padStart(2, '0')}:30`);
            }
            
            return (
                <div className="card" style={{marginBottom: '20px', background: '#f8f9fa'}}>
                    <h3>Agregar Nuevo Horario</h3>
                    <div style={{display: 'flex', gap: '10px', alignItems: 'end', flexWrap: 'wrap'}}>
                        <div className="form-group" style={{flex: 1, minWidth: '150px', marginBottom: 0}}>
                            <label>Día</label>
                            <select value={diaSeleccionado} onChange={(e) => setDiaSeleccionado(e.target.value)}>
                                {dias.map(d => <option key={d} value={d}>{d}</option>)}
                            </select>
                        </div>
                        <div className="form-group" style={{flex: 1, minWidth: '150px', marginBottom: 0}}>
                            <label>Hora</label>
                            <select value={horaSeleccionada} onChange={(e) => setHoraSeleccionada(e.target.value)}>
                                {horasPosibles.map(h => <option key={h} value={h}>{h}</option>)}
                            </select>
                        </div>
                        <button 
                            className="btn btn-success" 
                            onClick={() => onAgregar(diaSeleccionado, horaSeleccionada)}
                        >
                            ➕ Agregar
                        </button>
                    </div>
                </div>
            );
        }
        
        function PreciosTab({ precios, guardarCambios }) {
            const [editando, setEditando] = useState(false);
            const [preciosTemp, setPreciosTemp] = useState({...precios});
            
            const guardar = async () => {
                await guardarCambios('precios', preciosTemp);
                setEditando(false);
            };
            
            const cancelar = () => {
                setPreciosTemp({...precios});
                setEditando(false);
            };
            
            return (
                <div>
                    <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '20px'}}>
                        <h2>Gestión de Precios</h2>
                        {!editando ? (
                            <button className="btn btn-primary" onClick={() => setEditando(true)}>
                                ✎ Editar Precios
                            </button>
                        ) : (
                            <div>
                                <button className="btn btn-success" onClick={guardar}>
                                    ↓ Guardar
                                </button>
                                <button className="btn btn-secondary" onClick={cancelar}>
                                    Cancelar
                                </button>
                            </div>
                        )}
                    </div>
                    
                    <div className="grid">
                        {Object.keys(precios).sort((a, b) => {
                            const numA = parseInt(a.match(/\d+/)?.[0]) || 0;
                            const numB = parseInt(b.match(/\d+/)?.[0]) || 0;
                            return numA - numB;
                        }).map(plan => (
                            <div key={plan} className="card">
                                <h3>{plan.replace('_', ' ').toUpperCase()}</h3>
                                <div style={{fontSize: '2rem', fontWeight: 'bold', color: '#667eea', textAlign: 'center', margin: '20px 0'}}>
                                    ${editando ? (
                                        <input 
                                            type="number"
                                            value={preciosTemp[plan]}
                                            onChange={(e) => setPreciosTemp({...preciosTemp, [plan]: parseInt(e.target.value)})}
                                            style={{fontSize: '2rem', width: '100%', textAlign: 'center', padding: '10px'}}
                                        />
                                    ) : (
                                        precios[plan].toLocaleString()
                                    )}
                                </div>
                                <div style={{textAlign: 'center', color: '#6c757d'}}>
                                    por mes
                                </div>
                            </div>
                        ))}
                    </div>
                </div>
            );
        }
        
        function SolicitudesTab({ solicitudes, alumnos, recargarDatos }) {
            const formatearFecha = (fechaISO) => {
                const fecha = new Date(fechaISO + 'T00:00:00');
                const dias = ['Domingo', 'Lunes', 'Martes', 'Miércoles', 'Jueves', 'Viernes', 'Sábado'];
                const dia = dias[fecha.getDay()];
                const numero = fecha.getDate();
                const mes = fecha.getMonth() + 1;
                const año = fecha.getFullYear().toString().slice(-2);
                return `${dia} ${numero}/${mes}/${año}`;
            };
            
            const handleAprobar = async (solicitud) => {
                try {
                    // 1. Encontrar el alumno
                    const alumno = alumnos.find(a => a.id === solicitud.alumnoId);
                    if (!alumno) {
                        alert('Error: Alumno no encontrado');
                        return;
                    }
                    
                    // 2. Guardar el recupero como clase puntual (NO modifica horariosAsignados)
                    await FirebaseService.guardarRecupero({
                        alumnoId: solicitud.alumnoId,
                        alumnoNombre: solicitud.alumnoNombre,
                        alumnoEmail: solicitud.alumnoEmail,
                        fecha: solicitud.fecha,
                        dia: solicitud.dia,
                        hora: solicitud.hora,
                        estado: 'aprobado'
                    });
                    
                    // 3. Decrementar clasesPendientes del alumno
                    const alumnoActualizado = {
                        ...alumno,
                        clasesPendientes: Math.max(0, alumno.clasesPendientes - 1)
                    };
                    await FirebaseService.guardarAlumno(alumnoActualizado);
                    
                    // 4. Marcar la cancelacionAlumno original como "recuperado"
                    try {
                        await FirebaseService.actualizarEstadoCancelacionAlumno(solicitud.cancelacionId, 'recuperado');
                    } catch(e) {
                        console.warn('No se pudo actualizar cancelacionAlumno:', e);
                    }
                    
                    // 5. Eliminar la solicitud
                    await FirebaseService.eliminarSolicitud(solicitud.id);
                    
                    // Los listeners se encargan de actualizar automáticamente
                    alert(`✅ Recupero aprobado! ${solicitud.alumnoNombre} tiene clase el ${solicitud.dia} ${solicitud.fecha} a las ${solicitud.hora}`);
                } catch (error) {
                    console.error('Error al aprobar solicitud:', error);
                    alert('❌ Error al aprobar solicitud');
                }
            };
            
            const handleRechazar = async (solicitudId) => {
                if (window.confirm('¿Rechazar esta solicitud?')) {
                    try {
                        // 1. Obtener la solicitud para saber de quién es
                        const solicitud = solicitudes.find(s => s.id === solicitudId);
                        if (!solicitud) {
                            alert('❌ No se encontró la solicitud');
                            return;
                        }
                        
                        // 2. Obtener el alumno
                        const alumno = alumnos.find(a => a.id === solicitud.alumnoId);
                        if (!alumno) {
                            alert('❌ No se encontró el alumno');
                            return;
                        }
                        
                        // 3. Restaurar clasesPendientes (incrementar en 1)
                        const alumnoActualizado = {
                            ...alumno,
                            clasesPendientes: (alumno.clasesPendientes || 0) + 1
                        };
                        
                        // 4. Marcar solicitud como rechazada (no eliminarla)
                        const solicitudActualizada = {
                            ...solicitud,
                            estado: 'rechazada'
                        };
                        
                        // 5. Guardar cambios en Firebase
                        await FirebaseService.guardarAlumno(alumnoActualizado);
                        await FirebaseService.guardarSolicitud(solicitudActualizada);
                        
                        // Los listeners se encargan de actualizar automáticamente
                        alert(`✅ Solicitud rechazada. Se restauró 1 clase a recuperar para ${solicitud.alumnoNombre}`);
                    } catch (error) {
                        console.error('Error al rechazar solicitud:', error);
                        alert('❌ Error al rechazar solicitud');
                    }
                }
            };
            
            const solicitudesPendientes = solicitudes.filter(s => s.estado === 'pendiente');
            
            if (solicitudesPendientes.length === 0) {
                return (
                    <div className="alert alert-info">
                        <strong>✅ No hay solicitudes pendientes</strong>
                        <p style={{marginTop: '10px'}}>Todas las solicitudes han sido procesadas.</p>
                    </div>
                );
            }
            
            return (
                <div>
                    <h2 style={{marginBottom: '20px'}}>Solicitudes de Recuperación ({solicitudesPendientes.length})</h2>
                    
                    <div className="grid">
                        {solicitudesPendientes.map(solicitud => (
                            <div key={solicitud.id} className="card">
                                <h3 style={{color: '#667eea', marginBottom: '15px'}}>
                                    {solicitud.alumnoNombre}
                                </h3>
                                <div style={{fontSize: '1.2rem', fontWeight: 'bold', textAlign: 'center', color: '#667eea', marginBottom: '10px'}}>
                                    {formatearFecha(solicitud.fecha)}
                                </div>
                                <div style={{fontSize: '1.8rem', fontWeight: 'bold', textAlign: 'center', color: '#667eea', margin: '10px 0'}}>
                                    {solicitud.hora}
                                </div>
                                <div className="info-row">
                                    <span className="label">Email:</span>
                                    <span className="value" style={{fontSize: '0.85rem'}}>{solicitud.alumnoEmail}</span>
                                </div>
                                <div className="info-row">
                                    <span className="label">Solicitado:</span>
                                    <span className="value">{new Date(solicitud.fechaSolicitud).toLocaleString('es-AR', {
                                        day: '2-digit',
                                        month: '2-digit',
                                        hour: '2-digit',
                                        minute: '2-digit'
                                    })}</span>
                                </div>
                                
                                <div style={{display: 'flex', gap: '10px', marginTop: '20px'}}>
                                    <button 
                                        className="btn btn-success" 
                                        style={{flex: 1}}
                                        onClick={() => handleAprobar(solicitud)}
                                    >
                                        ✅ Aprobar
                                    </button>
                                    <button 
                                        className="btn btn-danger" 
                                        style={{flex: 1}}
                                        onClick={() => handleRechazar(solicitud.id)}
                                    >
                                        ❌ Rechazar
                                    </button>
                                </div>
                            </div>
                        ))}
                    </div>
                </div>
            );
        }
        
        function AlumnoDashboard({ alumno, alumnos, horarios, precios, cancelaciones, setCancelaciones, cancelacionesAlumno, setCancelacionesAlumno, solicitudes, recuperos, onLogout, recargarDatos }) {
            const [tabActiva, setTabActiva] = useState('misClases');
            const [mesSeleccionado, setMesSeleccionado] = useState(new Date());
            const [clasesCanceladas, setClasesCanceladas] = useState({}); // {fecha-horario: true}
            
            // Función para formatear fecha como "Viernes 13/2/26"
            const formatearFecha = (fechaISO) => {
                const fecha = new Date(fechaISO + 'T00:00:00');
                const dias = ['Domingo', 'Lunes', 'Martes', 'Miércoles', 'Jueves', 'Viernes', 'Sábado'];
                const dia = dias[fecha.getDay()];
                const numero = fecha.getDate();
                const mes = fecha.getMonth() + 1;
                const año = fecha.getFullYear().toString().slice(-2);
                return `${dia} ${numero}/${mes}/${año}`;
            };
            
            // Función para obtener las clases del alumno en formato de fecha
            const obtenerClasesDelMes = (fecha) => {
                const fechaStr = fechaLocal(fecha);
                const diaSemana = ['Domingo', 'Lunes', 'Martes', 'Miércoles', 'Jueves', 'Viernes', 'Sábado'][fecha.getDay()];
                
                // Clases regulares (horarios recurrentes)
                const clasesRegulares = alumno.horariosAsignados
                    .filter(h => h.split('-')[0] === diaSemana)
                    .map(h => {
                        const [dia, hora] = h.split('-');
                        const estaCancelada = cancelacionesAlumno.some(c => 
                            c.alumnoId === alumno.id && 
                            c.fecha === fechaStr && 
                            c.hora === hora
                        );
                        return { fecha: fechaStr, dia, hora, horario: h, cancelada: estaCancelada, tipo: 'regular' };
                    });
                
                // Recuperos aprobados para esta fecha
                const clasesRecupero = (recuperos || [])
                    .filter(r => r.fecha === fechaStr && r.alumnoId === alumno.id && r.estado === 'aprobado')
                    .map(r => ({
                        fecha: fechaStr, dia: r.dia, hora: r.hora,
                        horario: `${r.dia}-${r.hora}`, cancelada: false, tipo: 'recupero'
                    }));
                
                // Solicitudes pendientes de recupero para esta fecha
                const clasesPendientes = (solicitudes || [])
                    .filter(s => s.fecha === fechaStr && s.alumnoId === alumno.id && s.estado === 'pendiente')
                    .map(s => ({
                        fecha: fechaStr, dia: s.dia, hora: s.hora,
                        horario: `${s.dia}-${s.hora}`, cancelada: false, tipo: 'pendiente'
                    }));
                
                return [...clasesRegulares, ...clasesRecupero, ...clasesPendientes];
            };
            
            // Función para obtener todos los días del mes con sus clases
            const obtenerDiasDelMes = (mesActual) => {
                const año = mesActual.getFullYear();
                const mes = mesActual.getMonth();
                const primerDia = new Date(año, mes, 1);
                const ultimoDia = new Date(año, mes + 1, 0);
                const diasDelMes = [];
                
                for (let d = 1; d <= ultimoDia.getDate(); d++) {
                    const fecha = new Date(año, mes, d);
                    const esFeriado = FERIADOS_FIJOS.includes(fechaLocal(fecha));
                    // Si es feriado, no mostrar clases
                    const clases = esFeriado ? [] : obtenerClasesDelMes(fecha);
                    diasDelMes.push({
                        fecha,
                        numero: d,
                        clases,
                        esHoy: fecha.toDateString() === new Date().toDateString(),
                        esFeriado: esFeriado
                    });
                }
                
                return diasDelMes;
            };
            
            // Función para renderizar el calendario
            const renderizarCalendario = () => {
                const diasDelMes = obtenerDiasDelMes(mesSeleccionado);
                const primerDia = new Date(mesSeleccionado.getFullYear(), mesSeleccionado.getMonth(), 1).getDay();
                // Ajustar para que empiece en lunes: si lunes=1, entonces diasVacios = primerDia - 1
                const diasVaciosCalculado = primerDia === 0 ? 6 : primerDia - 1;
                const diasVacios = Array(diasVaciosCalculado).fill(null);
                const meses = ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio', 'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'];
                const diasSemana = ['Lun', 'Mar', 'Mié', 'Jue', 'Vie', 'Sáb', 'Dom'];
                
                return (
                    <div>
                        <h2 style={{marginBottom: '20px'}}>Mis Clases - {meses[mesSeleccionado.getMonth()]} {mesSeleccionado.getFullYear()}</h2>
                        
                        <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '20px'}}>
                            <button className="btn btn-secondary" onClick={() => setMesSeleccionado(new Date(mesSeleccionado.getFullYear(), mesSeleccionado.getMonth() - 1, 1))}>
                                ← Mes Anterior
                            </button>
                            <button className="btn btn-secondary" onClick={() => setMesSeleccionado(new Date())}>
                                Hoy
                            </button>
                            <button className="btn btn-secondary" onClick={() => setMesSeleccionado(new Date(mesSeleccionado.getFullYear(), mesSeleccionado.getMonth() + 1, 1))}>
                                Mes Siguiente →
                            </button>
                        </div>
                        
                        <div style={{display: 'grid', gridTemplateColumns: 'repeat(7, 1fr)', gap: '5px'}}>
                            {/* Cabecera días */}
                            {diasSemana.map(dia => (
                                <div key={dia} style={{textAlign: 'center', fontWeight: 'bold', color: '#667eea', padding: '10px', background: '#f8f9fa', borderRadius: '8px'}}>
                                    {dia}
                                </div>
                            ))}
                            {/* Días vacíos de inicio */}
                            {diasVacios.map((_, idx) => (
                                <div key={`vacio-${idx}`} className="cal-cell" style={{minHeight: '100px'}}></div>
                            ))}
                            {diasDelMes.map((dia, idx) => (
                                <div 
                                    key={idx}
                                    className="cal-cell"
                                    style={{
                                        minHeight: '100px',
                                        padding: '10px',
                                        border: '1px solid #dee2e6',
                                        borderRadius: '8px',
                                        background: dia.esFeriado ? '#fff3cd' : dia.esHoy ? '#e7f3ff' : 'white',
                                    }}
                                >
                                    <div className="cal-num" style={{fontWeight: 'bold', color: dia.esHoy ? '#667eea' : '#495057', marginBottom: '5px'}}>
                                        {dia.numero}
                                    </div>
                                    {dia.esFeriado && (
                                        <div style={{fontSize: '0.75rem', color: '#ff9800', fontWeight: 'bold', marginBottom: '5px'}}>
                                            Fer.
                                        </div>
                                    )}
                                    {dia.clases.map((clase, idx) => {
                                        const estaCancelada = clase.cancelada;
                                        const esRecupero = clase.tipo === 'recupero';
                                        const esPendiente = clase.tipo === 'pendiente';
                                        const fechaClaseObj = new Date(`${clase.fecha}T${clase.hora}:00`);
                                        const yaPaso = fechaClaseObj < new Date();
                                        const bgColor = estaCancelada ? '#ccc' : esRecupero ? '#28a745' : esPendiente ? '#ff9800' : '#667eea';
                                        
                                        return (
                                            <div key={idx} style={{marginBottom: '3px'}}>
                                                <div className="cal-pill" style={{
                                                    fontSize: '0.75rem',
                                                    background: bgColor,
                                                    color: estaCancelada ? '#666' : 'white',
                                                    padding: '3px 5px',
                                                    borderRadius: '4px',
                                                    marginBottom: '2px',
                                                    textDecoration: estaCancelada ? 'line-through' : 'none'
                                                }}>
                                                    {clase.hora}{esRecupero ? ' 🔄' : esPendiente ? ' ⏳' : ''}
                                                </div>
                                                {!estaCancelada && !yaPaso && !esRecupero && !esPendiente && (
                                                    <button
                                                        className="cal-cancel-btn"
                                                        style={{
                                                            fontSize: '0.7rem', padding: '2px 6px',
                                                            background: '#dc3545', color: 'white',
                                                            border: 'none', borderRadius: '3px',
                                                            cursor: 'pointer', width: '100%'
                                                        }}
                                                        onClick={() => {
                                                            const fechaStr = fechaLocal(new Date(mesSeleccionado.getFullYear(), mesSeleccionado.getMonth(), dia.numero));
                                                            handleCancelar(clase.horario, fechaStr);
                                                        }}
                                                    >
                                                        ✕
                                                    </button>
                                                )}
                                            </div>
                                        );
                                    })}
                                </div>
                            ))}
                        </div>
                        
                        <div style={{marginTop: '15px', display: 'flex', gap: '15px', flexWrap: 'wrap', fontSize: '0.8rem'}}>
                            <span><span style={{display:'inline-block', width:'12px', height:'12px', background:'#667eea', borderRadius:'3px', marginRight:'4px'}}></span>Clase regular</span>
                            <span><span style={{display:'inline-block', width:'12px', height:'12px', background:'#28a745', borderRadius:'3px', marginRight:'4px'}}></span>Recupero aprobado 🔄</span>
                            <span><span style={{display:'inline-block', width:'12px', height:'12px', background:'#ff9800', borderRadius:'3px', marginRight:'4px'}}></span>Recupero pendiente ⏳</span>
                            <span><span style={{display:'inline-block', width:'12px', height:'12px', background:'#ccc', borderRadius:'3px', marginRight:'4px'}}></span>Cancelada</span>
                        </div>
                        
                        <div className="alert alert-info" style={{marginTop: '15px'}}>
                            ℹ️ Podés cancelar hasta 3 horas antes del horario de clase.
                        </div>
                    </div>
                );
            };
            
            const handleSolicitarCupo = async (slot) => {
                try {
                    const nuevaSolicitud = {
                        alumnoId: alumno.id,
                        alumnoNombre: `${alumno.nombre} ${alumno.apellido}`,
                        alumnoEmail: alumno.email,
                        cancelacionId: null,
                        dia: slot.dia,
                        hora: slot.hora,
                        fecha: slot.fecha,
                        estado: 'pendiente',
                        fechaSolicitud: new Date().toISOString()
                    };
                    
                    await FirebaseService.guardarSolicitud(nuevaSolicitud);
                    
                    
                    // Los listeners se encargan de actualizar automáticamente
                    alert('✅ Solicitud enviada! La profesora te confirmará pronto.');
                } catch (error) {
                    console.error('Error al solicitar cupo:', error);
                    alert('❌ Error al enviar solicitud');
                }
            };
            
            // Verificar si ya solicitó este cupo
            const yaSolicito = (cancelacionId) => {
                return solicitudes.some(s => 
                    s.cancelacionId === cancelacionId && 
                    s.alumnoId === alumno.id &&
                    s.estado === 'pendiente'
                );
            };
            
            // Función para ordenar cupos por fecha y hora
            const ordenarCupos = (cupos) => {
                return cupos.sort((a, b) => {
                    // Primero por fecha
                    const fechaA = new Date(a.fecha).getTime();
                    const fechaB = new Date(b.fecha).getTime();
                    if (fechaA !== fechaB) {
                        return fechaA - fechaB;
                    }
                    // Si la fecha es igual, por hora (de temprano a tarde)
                    const horaA = a.hora.split(':').map(Number);
                    const horaB = b.hora.split(':').map(Number);
                    const minutosA = horaA[0] * 60 + horaA[1];
                    const minutosB = horaB[0] * 60 + horaB[1];
                    return minutosA - minutosB;
                });
            };
            
            // Función para ir al mes anterior
            const irMesAnterior = () => {
                setMesSeleccionado(new Date(mesSeleccionado.getFullYear(), mesSeleccionado.getMonth() - 1, 1));
            };
            
            // Función para ir al mes siguiente
            const irMesSiguiente = () => {
                setMesSeleccionado(new Date(mesSeleccionado.getFullYear(), mesSeleccionado.getMonth() + 1, 1));
            };
            
            // Función para filtrar cupos del mes seleccionado
            const filtrarCuposMes = (cupos) => {
                return cupos.filter(cupo => {
                    const fecha = new Date(cupo.fecha);
                    return fecha.getMonth() === mesSeleccionado.getMonth() && 
                           fecha.getFullYear() === mesSeleccionado.getFullYear();
                });
            };
            
            // Función para obtener nombre del mes
            const obtenerNombreMes = () => {
                const meses = ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio', 
                              'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'];
                return `${meses[mesSeleccionado.getMonth()]} ${mesSeleccionado.getFullYear()}`;
            };
            
            const handleCancelar = async (horario, fechaStr) => {
                try {
                    // Validar que no sea una clase pasada
                    const [dia, hora] = horario.split('-');
                    const [año, mes, día] = fechaStr.split('-');
                    
                    // Crear fecha de la clase correctamente
                    const [horaNum, minNum] = hora.split(':').map(Number);
                    const fechaClase = new Date(parseInt(año), parseInt(mes) - 1, parseInt(día), horaNum, minNum, 0);
                    const ahora = new Date();
                    
                    if (fechaClase < ahora) {
                        alert('❌ No podés cancelar una clase que ya pasó');
                        return;
                    }
                    
                    // Calcular si quedan más de 3 horas
                    const horasRestantes = (fechaClase - ahora) / (1000 * 60 * 60);
                    const puedeRecuperar = horasRestantes >= 3;
                    
                    if (!window.confirm(`¿Confirmar cancelación de ${horario}?`)) {
                        return;
                    }
                    
                    // Guardar cancelación específica (fecha + alumno + horario)
                    const nuevaCancelacionAlumno = {
                        alumnoId: alumno.id,
                        alumnoNombre: `${alumno.nombre} ${alumno.apellido}`,
                        alumnoEmail: alumno.email,
                        fecha: fechaStr,
                        dia,
                        hora,
                        estado: 'pendiente',
                        puedeRecuperar: puedeRecuperar,
                        fechaCancelacion: new Date().toISOString()
                    };
                    
                    await FirebaseService.guardarCancelacionAlumno(nuevaCancelacionAlumno);
                    
                                        
                    // Agregar a cancelacionesAlumno local
                    setCancelacionesAlumno([...cancelacionesAlumno, nuevaCancelacionAlumno]);
                    
                    // Incrementar clasesPendientes solo si puede recuperar
                    let alumnoActualizado = { ...alumno };
                    if (puedeRecuperar) {
                        alumnoActualizado.clasesPendientes = alumno.clasesPendientes + 1;
                    }
                    
                    await FirebaseService.guardarAlumno(alumnoActualizado);
                    
                    // Los listeners se encargan de actualizar automáticamente
                    
                    alert('✅ Clase cancelada.');
                } catch (error) {
                    console.error('❌ ERROR en handleCancelar:', error);
                    alert('❌ Error al cancelar clase: ' + error.message);
                }
            };
            
            return (
                <div className="container">
                    <div className="header">
                        <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center'}}>
                            <span style={{fontSize: '1.1rem', fontWeight: '600'}}>
                                Hola, {alumno?.nombre || 'Alumno'}!
                            </span>
                            <HeaderLogoSVG width={120} style={{filter: 'brightness(0) invert(1)', opacity: 0.9}} />
                        </div>
                    </div>
                    
                    <div className="tabs">
                        <button className={`tab ${tabActiva === 'misClases' ? 'active' : ''}`} onClick={() => setTabActiva('misClases')}>
                            <span className="tab-icon">📆</span> <span>Mis Clases</span>
                        </button>
                        <button className={`tab ${tabActiva === 'recuperar' ? 'active' : ''}`} onClick={() => setTabActiva('recuperar')}>
                            <span className="tab-icon">↻</span> <span>Recuperar</span>
                        </button>
                        <button className={`tab ${tabActiva === 'miInfo' ? 'active' : ''}`} onClick={() => setTabActiva('miInfo')}>
                            <span className="tab-icon">◉</span> <span>Mi Info</span>
                        </button>
                    </div>
                    
                    <div className="content">
                        {tabActiva === 'misClases' && renderizarCalendario()}
                        
                        {tabActiva === 'recuperar' && (
                            <TabRecuperar
                                alumno={alumno}
                                alumnos={alumnos}
                                horarios={horarios}
                                cancelacionesAlumno={cancelacionesAlumno}
                                recuperos={recuperos}
                                solicitudes={solicitudes}
                                onSolicitarCupo={handleSolicitarCupo}
                                formatearFecha={formatearFecha}
                            />
                        )}
                        
                        {tabActiva === 'miInfo' && alumno && (
                            <div>
                                <h2 style={{marginBottom: '20px'}}>Mi Información</h2>
                                <div className="card">
                                    <h3>{alumno?.nombre || ''} {alumno?.apellido || ''}</h3>
                                    <div className="info-row">
                                        <span className="label">Email:</span>
                                        <span className="value">{alumno?.email || 'N/A'}</span>
                                    </div>
                                    <div className="info-row">
                                        <span className="label">Abono:</span>
                                        <span className="badge badge-info">{alumno?.abono?.replace('_', ' ').toUpperCase() || 'N/A'}</span>
                                    </div>
                                    <div className="info-row">
                                        <span className="label">Precio:</span>
                                        <span className="value" style={{fontWeight: 'bold', color: '#667eea', fontSize: '1.1rem'}}>
                                            {precios && alumno?.abono && precios[alumno.abono] ? '$' + precios[alumno.abono].toLocaleString('es-AR') : 'Cargando...'}
                                        </span>
                                    </div>
                                    {alumno?.clasesPendientes > 0 && (
                                        <div className="info-row">
                                            <span className="label">Clases a recuperar:</span>
                                            <span className="badge badge-warning">{alumno.clasesPendientes}</span>
                                        </div>
                                    )}
                                </div>
                            </div>
                        )}
                    </div>
                    
                    <div className="footer">
                        <button onClick={onLogout} className="btn btn-secondary">
                            Cerrar Sesión
                        </button>
                    </div>
                </div>
            );
        }
        
        function TabRecuperar({ alumno, alumnos, horarios, cancelacionesAlumno, recuperos, solicitudes, onSolicitarCupo, formatearFecha }) {
            const CAPACIDAD_MAX = 5;
            const [semanas, setSemanas] = useState(2); // cuántas semanas mostrar hacia adelante
            
            // Calcular ocupados en un slot fecha+hora específico
            const calcularOcupados = (fechaStr, diaSemana, hora) => {
                // Alumnos con ese horario recurrente
                const conHorario = alumnos.filter(a => 
                    (a.horariosAsignados || []).includes(`${diaSemana}-${hora}`)
                );
                // Menos los que cancelaron ese día específico
                const cancelados = cancelacionesAlumno.filter(c => 
                    c.fecha === fechaStr && c.hora === hora && c.estado !== 'recuperado'
                ).map(c => c.alumnoId);
                
                const regulares = conHorario.filter(a => !cancelados.includes(a.id)).length;
                
                // Más los recuperos aprobados para esa fecha/hora
                const conRecupero = (recuperos || []).filter(r => 
                    r.fecha === fechaStr && r.hora === hora && r.estado === 'aprobado'
                ).length;
                
                return regulares + conRecupero;
            };
            
            // Generar todos los slots disponibles en los próximos N días
            const generarSlotsDisponibles = () => {
                const slots = [];
                const hoy = new Date();
                hoy.setHours(0, 0, 0, 0);
                const diasAdelante = semanas * 7;
                const diasSemana = ['Domingo', 'Lunes', 'Martes', 'Miércoles', 'Jueves', 'Viernes', 'Sábado'];
                
                for (let i = 0; i <= diasAdelante; i++) {
                    const fecha = new Date(hoy);
                    fecha.setDate(hoy.getDate() + i);
                    const fechaStr = fechaLocal(fecha);
                    
                    // Saltar feriados
                    if (FERIADOS_FIJOS.includes(fechaStr)) continue;
                    
                    const diaSemana = diasSemana[fecha.getDay()];
                    const horariosDelDia = horarios[diaSemana] || [];
                    
                    for (const hora of horariosDelDia) {
                        // Verificar que la clase no haya pasado (con al menos 3hs de anticipación)
                        const fechaHoraClase = new Date(`${fechaStr}T${hora}:00`);
                        const horasRestantes = (fechaHoraClase - new Date()) / (1000 * 60 * 60);
                        if (horasRestantes < 3) continue;
                        
                        // Calcular ocupados
                        const ocupados = calcularOcupados(fechaStr, diaSemana, hora);
                        const libres = CAPACIDAD_MAX - ocupados;
                        
                        if (libres <= 0) continue;
                        
                        // El alumno ya tiene clase ahí ese día (regular o recupero)
                        const yaTimeneClase = (alumno.horariosAsignados || []).includes(`${diaSemana}-${hora}`) &&
                            !cancelacionesAlumno.some(c => c.alumnoId === alumno.id && c.fecha === fechaStr && c.hora === hora);
                        const yaTimeneRecupero = (recuperos || []).some(r => 
                            r.alumnoId === alumno.id && r.fecha === fechaStr && r.hora === hora && r.estado === 'aprobado'
                        );
                        if (yaTimeneClase || yaTimeneRecupero) continue;
                        
                        // Ya tiene solicitud pendiente para ese slot
                        const yaSolicito = solicitudes.some(s => 
                            s.alumnoId === alumno.id && s.fecha === fechaStr && s.hora === hora && s.estado === 'pendiente'
                        );
                        
                        slots.push({ fecha: fechaStr, dia: diaSemana, hora, libres, yaSolicito });
                    }
                }
                
                // Ordenar por fecha y hora
                return slots.sort((a, b) => {
                    if (a.fecha !== b.fecha) return a.fecha.localeCompare(b.fecha);
                    return a.hora.localeCompare(b.hora);
                });
            };
            
            const slots = generarSlotsDisponibles();
            
            // Solicitudes rechazadas del alumno
            const solicitudesRechazadas = (solicitudes || []).filter(s => 
                s.alumnoId === alumno.id && s.estado === 'rechazada'
            );
            
            if (alumno.clasesPendientes === 0) {
                return (
                    <div>
                        <h2 style={{marginBottom: '20px'}}>Recuperar Clases</h2>
                        <div className="alert alert-success">
                            ✅ No tenés clases pendientes de recuperar
                        </div>
                    </div>
                );
            }
            
            return (
                <div>
                    <h2 style={{marginBottom: '10px'}}>Recuperar Clases</h2>
                    
                    {solicitudesRechazadas.length > 0 && (
                        <div className="alert alert-danger" style={{marginBottom: '20px'}}>
                            <strong>⚠️ Solicitudes rechazadas</strong>
                            <p style={{marginTop: '8px', marginBottom: '0'}}>Las siguientes solicitudes fueron rechazadas por la profesora. Podés solicitar otro horario:</p>
                            {solicitudesRechazadas.map(s => (
                                <div key={s.id} style={{fontSize: '0.9rem', marginTop: '8px', paddingTop: '8px', borderTop: '1px solid rgba(114, 28, 36, 0.3)'}}>
                                    {formatearFecha(s.fecha)} a las {s.hora} — {s.razon || 'Sin motivo especificado'}
                                </div>
                            ))}
                        </div>
                    )}
                    
                    <div className="alert alert-warning" style={{marginBottom: '20px'}}>
                        Tenés <strong>{alumno.clasesPendientes}</strong> clase(s) para recuperar. Elegí un horario disponible:
                    </div>
                    
                    <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '20px', padding: '12px 16px', background: '#f8f9fa', borderRadius: '8px'}}>
                        <span style={{color: '#6c757d', fontSize: '0.9rem'}}>Mostrando próximos {semanas * 7} días</span>
                        <div style={{display: 'flex', gap: '8px'}}>
                            <button className="btn btn-secondary" style={{padding: '6px 14px', fontSize: '0.85rem'}} 
                                onClick={() => setSemanas(Math.max(1, semanas - 1))} disabled={semanas <= 1}>
                                − Menos
                            </button>
                            <button className="btn btn-secondary" style={{padding: '6px 14px', fontSize: '0.85rem'}}
                                onClick={() => setSemanas(semanas + 1)}>
                                + Más semanas
                            </button>
                        </div>
                    </div>
                    
                    {slots.length === 0 ? (
                        <div className="alert alert-info">
                            No hay lugares disponibles en los próximos {semanas * 7} días. Probá expandir el período o consultá con la profesora.
                        </div>
                    ) : (
                        <div className="grid">
                            {slots.map(slot => (
                                <div key={`${slot.fecha}-${slot.hora}`} className="card" style={{borderColor: slot.yaSolicito ? '#ffc107' : '#e9ecef'}}>
                                    <div style={{fontSize: '1.1rem', fontWeight: 'bold', color: '#667eea', textAlign: 'center', marginBottom: '6px'}}>
                                        {formatearFecha(slot.fecha)}
                                    </div>
                                    <div style={{fontSize: '2rem', fontWeight: 'bold', color: '#667eea', textAlign: 'center', margin: '8px 0'}}>
                                        {slot.hora}
                                    </div>
                                    {slot.yaSolicito ? (
                                        <div className="alert alert-warning" style={{textAlign: 'center', margin: 0, padding: '8px'}}>
                                            ⏳ Solicitud enviada<br/>
                                            <small>Esperando confirmación</small>
                                        </div>
                                    ) : (
                                        <button 
                                            className="btn btn-success" 
                                            style={{width: '100%'}}
                                            onClick={() => onSolicitarCupo(slot)}
                                        >
                                            Solicitar este lugar
                                        </button>
                                    )}
                                </div>
                            ))}
                        </div>
                    )}
                </div>
            );
        }
        
        function Modal({ children, onClose }) {
            return (
                <div className="modal" onClick={onClose}>
                    <div className="modal-content" onClick={(e) => e.stopPropagation()}>
                        <div className="modal-header">
                            <div></div>
                            <button className="close-btn" onClick={onClose}>×</button>
                        </div>
                        {children}
                    </div>
                </div>
            );
        }
        
        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
    
    <!--
    ================================================================
     INSTRUCCIONES PARA ACTIVAR LAS NOTIFICACIONES PUSH (10 min)
    ================================================================
    
    Necesitás hacer 3 cosas:
    
    ─────────────────────────────────────────────────────────────
    PASO 1 — Obtener la VAPID KEY (para que el navegador confíe)
    ─────────────────────────────────────────────────────────────
    1. Entrá a https://console.firebase.google.com
    2. Seleccioná tu proyecto "marina-pilates-730fb"
    3. Click en el ícono de engranaje ⚙️ → "Configuración del proyecto"
    4. Ir a la pestaña "Cloud Messaging"
    5. En la sección "Configuración de Web", buscá "Certificados push de la web"
    6. Si no ves ninguna clave, click en "Generar par de claves"
    7. Copiá el valor del campo "Key pair" (empieza con "BN..." o similar)
    8. En este index.html, reemplazá:
          FCM_VAPID_KEY = 'REEMPLAZAR_CON_TU_VAPID_KEY'
       por:
          FCM_VAPID_KEY = 'LA_CLAVE_QUE_COPIASTE'
    
    ─────────────────────────────────────────────────────────────
    PASO 2 — Obtener la SERVER KEY (para enviar los pushes)
    ─────────────────────────────────────────────────────────────
    1. En la misma pantalla "Cloud Messaging"
    2. Buscá la sección "Cloud Messaging API (Legacy)"
       (puede que necesites habilitarla haciendo click en el ícono externo)
    3. Copiá el "Server key" (empieza con "AAAA...")
    4. En este index.html, reemplazá:
          FCM_SERVER_KEY = 'REEMPLAZAR_CON_TU_SERVER_KEY'
       por:
          FCM_SERVER_KEY = 'LA_CLAVE_QUE_COPIASTE'
    
    ─────────────────────────────────────────────────────────────
    PASO 3 — Subir los archivos a GitHub
    ─────────────────────────────────────────────────────────────
    Subí al repositorio (en la raíz, al mismo nivel que index.html):
    • Este index.html (con las claves ya reemplazadas)
    • El archivo firebase-messaging-sw.js (adjunto en este chat)
    
    ─────────────────────────────────────────────────────────────
    PASO 4 — Activar en tu teléfono
    ─────────────────────────────────────────────────────────────
    1. Abrí la webapp en Chrome de tu Android
    2. Iniciá sesión como admin
    3. Chrome te preguntará "¿Permitir notificaciones?" → Aceptar
    4. Listo. Desde ese momento recibís push aunque tengas Chrome cerrado.
    
    Si instalaste la app (acceso directo en pantalla de inicio), las
    notificaciones llegan igual que cualquier app nativa.
    ================================================================
    -->
</body>
</html>
